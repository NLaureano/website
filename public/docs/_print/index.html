<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="canonical" type="text/html" href="https://kubefleet-dev.github.io/website/docs/">
<link rel="alternate" type="application/rss&#43;xml" href="https://kubefleet-dev.github.io/website/docs/index.xml">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/website/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/website/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/website/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/website/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/website/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/website/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/website/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/website/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/website/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/website/favicons/android-192x192.png" sizes="192x192">

<title>Welcome to KubeFleet Documentation | KubeFleet</title>
<meta name="description" content="Learn more about KubeFleet, a CNCF sandbox project for simplified Kubernetes multi-cluster management at scale.">
<meta property="og:url" content="https://kubefleet-dev.github.io/website/docs/">
  <meta property="og:site_name" content="KubeFleet">
  <meta property="og:title" content="Welcome to KubeFleet Documentation">
  <meta property="og:description" content="Welcome ✨ This documentation can help you learn more about the KubeFleet project, get started with a KubeFleet deployment of your own, and complete common KubeFleet related tasks.
WIP We are actively working on the documentation site. About KubeFleet KubeFleet is a CNCF sandbox project that aims to simplify Kubernetes multi-cluster management . It can greatly enhance your multi-cluster management experience; specifically, with the help of KubeFleet, one is able to easily:">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="website">

  <meta itemprop="name" content="Welcome to KubeFleet Documentation">
  <meta itemprop="description" content="Welcome ✨ This documentation can help you learn more about the KubeFleet project, get started with a KubeFleet deployment of your own, and complete common KubeFleet related tasks.
WIP We are actively working on the documentation site. About KubeFleet KubeFleet is a CNCF sandbox project that aims to simplify Kubernetes multi-cluster management . It can greatly enhance your multi-cluster management experience; specifically, with the help of KubeFleet, one is able to easily:">
  <meta itemprop="wordCount" content="262">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Welcome to KubeFleet Documentation">
  <meta name="twitter:description" content="Welcome ✨ This documentation can help you learn more about the KubeFleet project, get started with a KubeFleet deployment of your own, and complete common KubeFleet related tasks.
WIP We are actively working on the documentation site. About KubeFleet KubeFleet is a CNCF sandbox project that aims to simplify Kubernetes multi-cluster management . It can greatly enhance your multi-cluster management experience; specifically, with the help of KubeFleet, one is able to easily:">




<link rel="preload" href="/website/scss/main.min.5118d334f4d49e78b43432d75232dda13144ff70fc9d784048f9c31c8751ea0f.css" as="style">
<link href="/website/scss/main.min.5118d334f4d49e78b43432d75232dda13144ff70fc9d784048f9c31c8751ea0f.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.7.1.min.js"
  integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
  crossorigin="anonymous"></script>
<script defer
  src="https://unpkg.com/lunr@2.3.9/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>

  </head>
  <body class="td-section">
    <header>
      <nav class="td-navbar js-navbar-scroll" data-bs-theme="dark">
<div class="container-fluid flex-column flex-md-row">
  <a class="navbar-brand" href="/website/"><span class="navbar-brand__logo navbar-logo"></span><span class="navbar-brand__name">KubeFleet</span></a>
  <div class="td-navbar-nav-scroll ms-md-auto" id="main_navbar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link active" href="/website/docs/"><span>Docs</span></a>
      </li>
      <li class="nav-item dropdown d-none d-lg-block">
        <div class="dropdown">
  <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">English</a>
  <ul class="dropdown-menu">
    <li><a class="dropdown-item" href="/website/zh-cn/docs/">中文（简体）</a></li>
    </ul>
</div></li>
      </ul>
  </div>
  <div class="d-none d-lg-block">
    <div class="td-search td-search--offline">
  <div class="td-search__icon"></div>
  <input
    type="search"
    class="td-search__input form-control"
    placeholder="Search this site…"
    aria-label="Search this site…"
    autocomplete="off"
    
    data-offline-search-index-json-src="/website/offline-search-index.dd67057b4ad81463d4109f31fe4d63d8.json"
    data-offline-search-base-href="/"
    data-offline-search-max-results="10"
  >
</div>
  </div>
</div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 ps-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/website/docs/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Welcome to KubeFleet Documentation</h1>





    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-dd948255948d6b59b32c471abcb62997">Concepts</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>1.1: <a href="#pg-2ecea0175c088acdaad228a415895bd0">ClusterResourcePlacement</a></li>


    
  
    
    
	
<li>1.2: <a href="#pg-490f2b78db8fecdc0bed1e8d68c8c706">Fleet components</a></li>


    
  
    
    
	
<li>1.3: <a href="#pg-b62b5665dfb021b8bec0a6ab728a3a54">MemberCluster</a></li>


    
  
    
    
	
<li>1.4: <a href="#pg-bd269a3c0871a350c7f51b81d2a79af9">Scheduler</a></li>


    
  
    
    
	
<li>1.5: <a href="#pg-e149527fa64d0c3eacbb2ff5e7b6ffea">Scheduling Framework</a></li>


    
  
    
    
	
<li>1.6: <a href="#pg-716d7f944c3423c5dfa17047db699aed">Properties and Property Provides</a></li>


    
  
    
    
	
<li>1.7: <a href="#pg-057b31916d61f2f113de30f88397f691">Safe Rollout</a></li>


    
  
    
    
	
<li>1.8: <a href="#pg-f14a979ac0ba3b2cbfcab451b17d9e7a">Override</a></li>


    
  
    
    
	
<li>1.9: <a href="#pg-8ddd4e0ab9f151e89ec11f8f8feb3f69">Staged Update</a></li>


    
  
    
    
	
<li>1.10: <a href="#pg-4289eaa321cf089fdf9ee9aab7a3ade8">Eviction and Placement Disruption Budget</a></li>


    
  

    </ul>
    
  
    
    
	
<li>2: <a href="#pg-17b09a9dc5200475d8a306f18e63a0f9">Getting Started</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>2.1: <a href="#pg-b2dc1a1b66163662e5965b95ed325462">Getting started with Fleet using KinD clusters</a></li>


    
  
    
    
	
<li>2.2: <a href="#pg-7d7f0216d2307a9e20af121afa63dd3e">Getting started with Fleet using on-premises clusters</a></li>


    
  

    </ul>
    
  
    
    
	
<li>3: <a href="#pg-8688845c6027fb5b07b8644ad7348d4a">How-To Guides</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.1: <a href="#pg-4072dca0095c74b9490cd7c99ea027d9">Managing clusters</a></li>


    
  
    
    
	
<li>3.2: <a href="#pg-7461dbc76e53ff75d54dd11074048123">Using the ClusterResourcePlacement API</a></li>


    
  
    
    
	
<li>3.3: <a href="#pg-dae736fee36bb429124e070c298551ea">Using Affinity to Pick Clusters</a></li>


    
  
    
    
	
<li>3.4: <a href="#pg-ccbad31a9eb5ff37ffc3f405928edd58">Using Topology Spread Constraints to Spread Resources</a></li>


    
  
    
    
	
<li>3.5: <a href="#pg-8f6885002eeb6f5c362b9414ff970412">Using Property-Based Scheduling</a></li>


    
  
    
    
	
<li>3.6: <a href="#pg-06445baf57d9bbc7fde02bf249b4a0fa">Using Taints and Tolerations</a></li>


    
  
    
    
	
<li>3.7: <a href="#pg-f53861fa149aba83d55219c600a493a6">Using the ClusterResourceOverride API</a></li>


    
  
    
    
	
<li>3.8: <a href="#pg-4f07136e38cf9fb330102a16c2742234">Using the ResourceOverride API</a></li>


    
  
    
    
	
<li>3.9: <a href="#pg-b44fd8dfb69a651370335b35322594c6">Using Envelope Objects to Place Resources</a></li>


    
  

    </ul>
    
  
    
    
	
<li>4: <a href="#pg-4588103fb9a692533044ee756a5f863f">Frequently Asked Questions</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>5: <a href="#pg-b5568d681972077a2a3f45e40a59d61a">API Reference</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  

    </ul>


<div class="content">
      <p>Welcome ✨ This documentation can help you learn more about the KubeFleet project,
get started with a KubeFleet deployment of your own, and complete common KubeFleet related tasks.</p>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">WIP</h4>

    We are actively working on the documentation site.

</div>

<h2 id="about-kubefleet">About KubeFleet</h2>
<p>KubeFleet is a CNCF sandbox project that aims to simplify Kubernetes multi-cluster management .
It can greatly enhance your multi-cluster management experience; specifically,
with the help of KubeFleet, one is able to easily:</p>
<ul>
<li>manage clusters through one unified portal; and</li>
<li>place Kubernetes resources across a group of clusters with advanced scheduling capabilities; and</li>
<li>roll out changes progressively; and</li>
<li>perform administrative tasks easily, such as observing application status, detecting configuration drifts, migrating workloads across clusters, etc.</li>
</ul>
<h2 id="is-kubefleet-right-for-my-multi-cluster-setup">Is KubeFleet right for my multi-cluster setup?</h2>
<ul>
<li>
<p>✅ KubeFleet can work with any Kubernetes clusters running supported Kubernetes versions, regardless of where they are set up.</p>
<p>You can set up KubeFleet with an on-premises cluster, a cluster hosted on public clouds such as
Azure, or even a local kind cluster.</p>
</li>
<li>
<p>✅ KubeFleet can manage Kubernetes cluster groups of various sizes.</p>
<p>KubeFleet is designed with performance and scalablity in mind. It functions well with both
smaller Kubernetes cluster groups and those with up to hundreds of Kubernetes clusters and
thousands of nodes.</p>
</li>
<li>
<p>🚀 KubeFleet is evolving fast.</p>
<p>We are actively developing new features and functionalities for KubeFleet. If you have any questions, suggestions, or feedbacks, please <a href="https://github.com/azure/fleet/issues">let us know</a>.</p>
</li>
</ul>
<h2 id="get-started">Get started</h2>
<p>Find out how to deploy KubeFleet with one of our <a href="/website/docs/getting-started/">Getting Started</a> tutorials. You can use a local setup to experiment with KubeFleet&rsquo;s features, and explore its UX.</p>

</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-dd948255948d6b59b32c471abcb62997">1 - Concepts</h1>
    <div class="lead">Core concepts in Fleet</div>
	

<div class="pageinfo pageinfo-primary">
<p>The documentation in this section explains core Fleet concepts. Pick one below to proceed.</p>

</div>


</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-2ecea0175c088acdaad228a415895bd0">1.1 - ClusterResourcePlacement</h1>
    <div class="lead">Concept about the ClusterResourcePlacement API</div>
	<h2 id="overview">Overview</h2>
<p><code>ClusterResourcePlacement</code> concept is used to dynamically select cluster scoped resources (especially namespaces and all
objects within it) and control how they are propagated to all or a subset of the member clusters.
A <code>ClusterResourcePlacement</code> mainly consists of three parts:</p>
<ul>
<li>
<p><strong>Resource selection</strong>: select which cluster-scoped Kubernetes
resource objects need to be propagated from the hub cluster to selected member clusters.</p>
<p>It supports the following forms of resource selection:</p>
<ul>
<li>Select resources by specifying just the &lt;group, version, kind&gt;. This selection propagates all resources with matching &lt;group, version, kind&gt;.</li>
<li>Select resources by specifying the &lt;group, version, kind&gt; and name. This selection propagates only one resource that matches the &lt;group, version, kind&gt; and name.</li>
<li>Select resources by specifying the &lt;group, version, kind&gt; and a set of labels using ClusterResourcePlacement -&gt; LabelSelector.
This selection propagates all resources that match the &lt;group, version, kind&gt; and label specified.</li>
</ul>
<p><strong>Note:</strong> When a namespace is selected, all the namespace-scoped objects under this namespace are propagated to the
selected member clusters along with this namespace.</p>
</li>
<li>
<p><strong>Placement policy</strong>: limit propagation of selected resources to a specific subset of member clusters.
The following types of target cluster selection are supported:</p>
<ul>
<li><strong>PickAll (Default)</strong>: select any member clusters with matching cluster <code>Affinity</code> scheduling rules. If the <code>Affinity</code>
is not specified, it will select all joined and healthy member clusters.</li>
<li><strong>PickFixed</strong>: select a fixed list of member clusters defined in the <code>ClusterNames</code>.</li>
<li><strong>PickN</strong>: select a <code>NumberOfClusters</code> of member clusters with optional matching cluster <code>Affinity</code> scheduling rules or topology spread constraints <code>TopologySpreadConstraints</code>.</li>
</ul>
</li>
<li>
<p><strong>Rollout strategy</strong>: how to propagate new changes to the selected member clusters.</p>
</li>
</ul>
<p>A simple <code>ClusterResourcePlacement</code> looks like this:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacement</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">crp-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">placementType</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">PickN</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">numberOfClusters</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">topologySpreadConstraints</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">maxSkew</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">topologyKey</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;env&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">whenUnsatisfiable</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">DoNotSchedule</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">group</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Namespace</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test-deployment</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">revisionHistoryLimit</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">100</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">strategy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">rollingUpdate</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">maxSurge</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">25</span><span style="color:#000">%</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">maxUnavailable</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">25</span><span style="color:#000">%</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">unavailablePeriodSeconds</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">RollingUpdate</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h2 id="when-to-use-clusterresourceplacement">When To Use <code>ClusterResourcePlacement</code></h2>
<p><code>ClusterResourcePlacement</code> is useful when you want for a general way of managing and running workloads across multiple clusters.
Some example scenarios include the following:</p>
<ul>
<li>As a platform operator, I want to place my cluster-scoped resources (especially namespaces and all objects within it)
to a cluster that resides in the us-east-1.</li>
<li>As a platform operator, I want to spread my cluster-scoped resources (especially namespaces and all objects within it)
evenly across the different regions/zones.</li>
<li>As a platform operator, I prefer to place my test resources into the staging AKS cluster.</li>
<li>As a platform operator, I would like to separate the workloads for compliance or policy reasons.</li>
<li>As a developer, I want to run my cluster-scoped resources (especially namespaces and all objects within it) on 3 clusters.
In addition, each time I update my workloads, the updates take place with zero downtime by rolling out to these three clusters incrementally.</li>
</ul>
<h2 id="placement-workflow">Placement Workflow</h2>
<p><img src="/images/en/docs/concepts/crpc/placement-concept-overview.jpg" alt=""></p>
<p>The placement controller will create <code>ClusterSchedulingPolicySnapshot</code> and <code>ClusterResourceSnapshot</code> snapshots by watching
the <code>ClusterResourcePlacement</code> object. So that it can trigger the scheduling and resource rollout process whenever needed.</p>
<p>The override controller will create the corresponding snapshots by watching the <code>ClusterResourceOverride</code> and <code>ResourceOverride</code>
which captures the snapshot of the overrides.</p>
<p>The placement workflow will be divided into several stages:</p>
<ol>
<li>Scheduling: multi-cluster scheduler makes the schedule decision by creating  the <code>clusterResourceBinding</code> for a bundle
of resources based on the latest <code>ClusterSchedulingPolicySnapshot</code>generated by the <code>ClusterResourcePlacement</code>.</li>
<li>Rolling out resources: rollout controller applies the resources to the selected member clusters based on the rollout strategy.</li>
<li>Overriding: work generator applies the override rules defined by <code>ClusterResourceOverride</code> and <code>ResourceOverride</code> to
the selected resources on the target clusters.</li>
<li>Creating or updating works:  work generator creates the work on the corresponding member cluster namespace. Each work
contains the (overridden) manifest workload to be deployed on the member clusters.</li>
<li>Applying resources on target clusters: apply work controller applies the manifest workload on the member clusters.</li>
<li>Checking resource availability: apply work controller checks the resource availability on the target clusters.</li>
</ol>
<h2 id="resource-selection">Resource Selection</h2>
<p>Resource selectors identify cluster-scoped objects to include based on standard Kubernetes identifiers - namely, the <code>group</code>,
<code>kind</code>, <code>version</code>, and <code>name</code> of the object. Namespace-scoped objects are included automatically when the namespace they
are part of is selected. The example <code>ClusterResourcePlacement</code> above would include the <code>test-deployment</code> namespace and
any objects that were created in that namespace.</p>
<p>The clusterResourcePlacement controller creates the <code>ClusterResourceSnapshot</code> to store a snapshot of selected resources
selected by the placement. The <code>ClusterResourceSnapshot</code> spec is immutable. Each time when the selected resources are updated,
the clusterResourcePlacement controller will detect the resource changes and create a new <code>ClusterResourceSnapshot</code>. It implies
that resources can change independently of any modifications to the <code>ClusterResourceSnapshot</code>. In other words, resource
changes can occur without directly affecting the <code>ClusterResourceSnapshot</code> itself.</p>
<p>The total amount of selected resources may exceed the 1MB limit for a single Kubernetes object. As a result, the controller
may produce more than one <code>ClusterResourceSnapshot</code>s for all the selected resources.</p>
<p><code>ClusterResourceSnapshot</code> sample:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourceSnapshot</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">annotations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kubernetes-fleet.io/number-of-enveloped-object</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;0&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kubernetes-fleet.io/number-of-resource-snapshots</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;1&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kubernetes-fleet.io/resource-hash</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">e0927e7d75c7f52542a6d4299855995018f4a6de46edf0f814cfaa6e806543f3</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">creationTimestamp</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2023-11-10T08:23:38Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">generation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">labels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kubernetes-fleet.io/is-latest-snapshot</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;true&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kubernetes-fleet.io/parent-CRP</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">crp-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kubernetes-fleet.io/resource-index</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;4&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">crp-1-4-snapshot</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">ownerReferences</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">blockOwnerDeletion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">controller</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacement</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">crp-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">uid</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">757f2d2c-682f-433f-b85c-265b74c3090b</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;1641940&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">uid</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">d6e2108b-882b-4f6c-bb5e-c5ec5491dd20</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">selectedResources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Namespace</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">labels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">kubernetes.io/metadata.name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">finalizers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">kubernetes</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">data</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">key1</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">value1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">key2</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">value2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">key3</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">value3</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ConfigMap</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h2 id="placement-policy">Placement Policy</h2>
<p><code>ClusterResourcePlacement</code> supports three types of policy as mentioned above. <code>ClusterSchedulingPolicySnapshot</code> will be
generated whenever policy changes are made to the <code>ClusterResourcePlacement</code> that require a new scheduling. Similar to
<code>ClusterResourceSnapshot</code>, its spec is immutable.</p>
<p><code>ClusterSchedulingPolicySnapshot</code> sample:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterSchedulingPolicySnapshot</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">annotations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kubernetes-fleet.io/CRP-generation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;5&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kubernetes-fleet.io/number-of-clusters</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">creationTimestamp</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2023-11-06T10:22:56Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">generation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">labels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kubernetes-fleet.io/is-latest-snapshot</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;true&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kubernetes-fleet.io/parent-CRP</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">crp-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kubernetes-fleet.io/policy-index</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;1&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">crp-1-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">ownerReferences</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">blockOwnerDeletion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">controller</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacement</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">crp-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">uid</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">757f2d2c-682f-433f-b85c-265b74c3090b</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;1639412&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">uid</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">768606f2-aa5a-481a-aa12-6e01e6adbea2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">placementType</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">PickN</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policyHash</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">NDc5ZjQwNWViNzgwOGNmYzU4MzY2YjI2NDg2ODBhM2E4MTVlZjkxNGZlNjc1NmFlOGRmMGQ2Zjc0ODg1NDE2YQ==</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">conditions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">lastTransitionTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2023-11-06T10:22:56Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">found all the clusters needed as specified by the scheduling policy</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">observedGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">SchedulingPolicyFulfilled</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;True&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Scheduled</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">observedCRPGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">targetClusters</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">clusterName</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">aks-member-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">clusterScore</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">affinityScore</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">priorityScore</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">picked by scheduling policy</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">selected</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">clusterName</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">aks-member-2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">clusterScore</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">affinityScore</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">priorityScore</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">picked by scheduling policy</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">selected</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p><img src="/images/en/docs/concepts/crpc/scheduling.jpg" alt=""></p>
<p>In contrast to the original scheduler framework in Kubernetes, the multi-cluster scheduling process involves selecting a cluster for placement through a structured 5-step operation:</p>
<ol>
<li>Batch &amp; PostBatch</li>
<li>Filter</li>
<li>Score</li>
<li>Sort</li>
<li>Bind</li>
</ol>
<p>The <em>batch &amp; postBatch</em> step is to define the batch size according to the desired and current <code>ClusterResourceBinding</code>.
The postBatch is to adjust the batch size if needed.</p>
<p>The <em>filter</em> step finds the set of clusters where it&rsquo;s feasible to schedule the placement, for example, whether the cluster
is matching required <code>Affinity</code> scheduling rules specified in the <code>Policy</code>. It also filters out any clusters which are
leaving the fleet or no longer connected to the fleet, for example, its heartbeat has been stopped for a prolonged period of time.</p>
<p>In the <em>score</em> step (only applied to the pickN type), the scheduler assigns a score to each cluster that survived filtering.
Each cluster is given a topology spread score (how much a cluster would satisfy the topology spread
constraints specified by the user), and an affinity score (how much a cluster would satisfy the preferred affinity terms
specified by the user).</p>
<p>In the <em>sort</em> step (only applied to the pickN type), it sorts all eligible clusters by their scores, sorting first by topology
spread score and breaking ties based on the affinity score.</p>
<p>The <em>bind</em> step is to create/update/delete the <code>ClusterResourceBinding</code> based on the desired and current member cluster list.</p>
<h2 id="rollout-strategy">Rollout Strategy</h2>
<p>Update strategy determines how changes to the <code>ClusterWorkloadPlacement</code> will be rolled out across member clusters.
The only supported update strategy is <code>RollingUpdate</code> and it replaces the old placed resource using rolling update, i.e.
gradually create the new one while replace the old ones.</p>
<h2 id="placement-status">Placement status</h2>
<p>After a <code>ClusterResourcePlacement</code> is created, details on current status can be seen by performing a <code>kubectl describe crp &lt;name&gt;</code>.
The status output will indicate both placement conditions and individual placement statuses on each member cluster that was selected.
The list of resources that are selected for placement will also be included in the describe output.</p>
<p>Sample output:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">Name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">         </span><span style="color:#000">crp-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">Namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">Labels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#000">&lt;none&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">Annotations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">&lt;none&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">API Version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">placement.kubernetes-fleet.io/v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">Kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">         </span><span style="color:#000">ClusterResourcePlacement</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">Metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">Spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">Policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Placement Type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">PickAll</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">Resource Selectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Group</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#000">Namespace</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#000">application-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">               </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">Revision History Limit</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">Strategy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Rolling Update</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Max Surge</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                   </span><span style="color:#0000cf;font-weight:bold">25</span><span style="color:#000">%</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Max Unavailable</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">             </span><span style="color:#0000cf;font-weight:bold">25</span><span style="color:#000">%</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Unavailable Period Seconds</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                          </span><span style="color:#000">RollingUpdate</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">Status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">Conditions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Last Transition Time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">2024-04-29T09:58:20Z</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">found all the clusters needed as specified by the scheduling policy</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Observed Generation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                 </span><span style="color:#000">SchedulingPolicyFulfilled</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                 </span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                   </span><span style="color:#000">ClusterResourcePlacementScheduled</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Last Transition Time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">2024-04-29T09:58:20Z</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">All 3 cluster(s) start rolling out the latest resource</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Observed Generation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                 </span><span style="color:#000">RolloutStarted</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                 </span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                   </span><span style="color:#000">ClusterResourcePlacementRolloutStarted</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Last Transition Time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">2024-04-29T09:58:20Z</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">No</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">override rules are configured for the selected resources</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Observed Generation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                 </span><span style="color:#000">NoOverrideSpecified</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                 </span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                   </span><span style="color:#000">ClusterResourcePlacementOverridden</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Last Transition Time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">2024-04-29T09:58:20Z</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">Works(s) are succcesfully created or updated in the 3 target clusters&#39; namespaces</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Observed Generation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                 </span><span style="color:#000">WorkSynchronized</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                 </span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                   </span><span style="color:#000">ClusterResourcePlacementWorkSynchronized</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Last Transition Time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">2024-04-29T09:58:20Z</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">The selected resources are successfully applied to 3 clusters</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Observed Generation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                 </span><span style="color:#000">ApplySucceeded</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                 </span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                   </span><span style="color:#000">ClusterResourcePlacementApplied</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Last Transition Time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">2024-04-29T09:58:20Z</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">The selected resources in 3 cluster are available now</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Observed Generation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                 </span><span style="color:#000">ResourceAvailable</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                 </span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                   </span><span style="color:#000">ClusterResourcePlacementAvailable</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">Observed Resource Index</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">Placement Statuses</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Cluster Name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">kind-cluster-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Conditions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Last Transition Time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">2024-04-29T09:58:20Z</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Message:               Successfully scheduled resources for placement in kind-cluster-1 (affinity score: 0, topology spread score: 0)</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">picked by scheduling policy</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Observed Generation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">Scheduled</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#000">Scheduled</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Last Transition Time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">2024-04-29T09:58:20Z</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">               </span><span style="color:#000">Detected the new changes on the resources and started the rollout process</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Observed Generation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">RolloutStarted</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#000">RolloutStarted</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Last Transition Time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">2024-04-29T09:58:20Z</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">               </span><span style="color:#204a87;font-weight:bold">No</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">override rules are configured for the selected resources</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Observed Generation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">NoOverrideSpecified</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#000">Overridden</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Last Transition Time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">2024-04-29T09:58:20Z</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">               </span><span style="color:#000">All of the works are synchronized to the latest</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Observed Generation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">AllWorkSynced</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#000">WorkSynchronized</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Last Transition Time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">2024-04-29T09:58:20Z</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">               </span><span style="color:#000">All corresponding work objects are applied</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Observed Generation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">AllWorkHaveBeenApplied</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#000">Applied</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Last Transition Time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">2024-04-29T09:58:20Z</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">               </span><span style="color:#000">The availability of work object crp-1-work is not trackable</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Observed Generation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">WorkNotTrackable</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#000">Available</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Cluster Name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#000">kind-cluster-2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Conditions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Last Transition Time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">2024-04-29T09:58:20Z</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Message:               Successfully scheduled resources for placement in kind-cluster-2 (affinity score: 0, topology spread score: 0)</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">picked by scheduling policy</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Observed Generation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">Scheduled</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#000">Scheduled</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Last Transition Time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">2024-04-29T09:58:20Z</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">               </span><span style="color:#000">Detected the new changes on the resources and started the rollout process</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Observed Generation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">RolloutStarted</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#000">RolloutStarted</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Last Transition Time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">2024-04-29T09:58:20Z</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">               </span><span style="color:#204a87;font-weight:bold">No</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">override rules are configured for the selected resources</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Observed Generation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">NoOverrideSpecified</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#000">Overridden</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Last Transition Time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">2024-04-29T09:58:20Z</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">               </span><span style="color:#000">All of the works are synchronized to the latest</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Observed Generation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">AllWorkSynced</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#000">WorkSynchronized</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Last Transition Time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">2024-04-29T09:58:20Z</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">               </span><span style="color:#000">All corresponding work objects are applied</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Observed Generation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">AllWorkHaveBeenApplied</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#000">Applied</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Last Transition Time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">2024-04-29T09:58:20Z</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">               </span><span style="color:#000">The availability of work object crp-1-work is not trackable</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Observed Generation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">WorkNotTrackable</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#000">Available</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Cluster Name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#000">kind-cluster-3</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Conditions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Last Transition Time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">2024-04-29T09:58:20Z</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Message:               Successfully scheduled resources for placement in kind-cluster-3 (affinity score: 0, topology spread score: 0)</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">picked by scheduling policy</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Observed Generation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">Scheduled</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#000">Scheduled</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Last Transition Time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">2024-04-29T09:58:20Z</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">               </span><span style="color:#000">Detected the new changes on the resources and started the rollout process</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Observed Generation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">RolloutStarted</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#000">RolloutStarted</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Last Transition Time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">2024-04-29T09:58:20Z</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">               </span><span style="color:#204a87;font-weight:bold">No</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">override rules are configured for the selected resources</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Observed Generation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">NoOverrideSpecified</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#000">Overridden</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Last Transition Time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">2024-04-29T09:58:20Z</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">               </span><span style="color:#000">All of the works are synchronized to the latest</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Observed Generation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">AllWorkSynced</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#000">WorkSynchronized</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Last Transition Time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">2024-04-29T09:58:20Z</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">               </span><span style="color:#000">All corresponding work objects are applied</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Observed Generation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">AllWorkHaveBeenApplied</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#000">Applied</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Last Transition Time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">2024-04-29T09:58:20Z</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">               </span><span style="color:#000">The availability of work object crp-1-work is not trackable</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Observed Generation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">WorkNotTrackable</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">Type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#000">Available</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">Selected Resources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#000">Namespace</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#000">application-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#000">ConfigMap</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#000">app-config-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">application-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">Events</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">Type    Reason                        Age    From                                   Message</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>---- <span style="color:#f8f8f8;text-decoration:underline">   </span>------ <span style="color:#f8f8f8;text-decoration:underline">                       </span>---- <span style="color:#f8f8f8;text-decoration:underline">  </span>---- <span style="color:#f8f8f8;text-decoration:underline">                                  </span>-------<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">Normal  PlacementRolloutStarted       3m46s  cluster-resource-placement-controller  Started rolling out the latest resources</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">Normal  PlacementOverriddenSucceeded  3m46s  cluster-resource-placement-controller  Placement has been successfully overridden</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">Normal  PlacementWorkSynchronized     3m46s  cluster-resource-placement-controller  Work(s) have been created or updated successfully for the selected cluster(s)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">Normal  PlacementApplied              3m46s  cluster-resource-placement-controller  Resources have been applied to the selected cluster(s)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">Normal  PlacementRolloutCompleted     3m46s  cluster-resource-placement-controller  Resources are available in the selected clusters</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h2 id="tolerations">Tolerations</h2>
<p>Tolerations are a mechanism to allow the Fleet Scheduler to schedule resources to a <code>MemberCluster</code> that has taints specified on it.
We adopt the concept of <a href="https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/">taints &amp; tolerations</a>
introduced in Kubernetes to the multi-cluster use case.</p>
<p>The <code>ClusterResourcePlacement</code> CR supports the specification of list of tolerations, which are applied to the <code>ClusterResourcePlacement</code>
object. Each Toleration object comprises the following fields:</p>
<ul>
<li><code>key</code>: The key of the toleration.</li>
<li><code>value</code>: The value of the toleration.</li>
<li><code>effect</code>: The effect of the toleration, which can be <code>NoSchedule</code> for now.</li>
<li><code>operator</code>: The operator of the toleration, which can be <code>Exists</code> or <code>Equal</code>.</li>
</ul>
<p>Each toleration is used to tolerate one or more specific taints applied on the <code>MemberCluster</code>. Once all taints on a <code>MemberCluster</code>
are tolerated by tolerations on a <code>ClusterResourcePlacement</code>, resources can be propagated to the <code>MemberCluster</code> by the scheduler for that
<code>ClusterResourcePlacement</code> resource.</p>
<p>Tolerations cannot be updated or removed from a <code>ClusterResourcePlacement</code>. If there is a need to update toleration a better approach is to
add another toleration. If we absolutely need to update or remove existing tolerations, the only option is to delete the existing <code>ClusterResourcePlacement</code>
and create a new object with the updated tolerations.</p>
<p>For detailed instructions, please refer to this <a href="/website/docs/how-tos/taints-tolerations/">document</a>.</p>
<h2 id="envelope-object">Envelope Object</h2>
<p>The <code>ClusterResourcePlacement</code> leverages the fleet hub cluster as a staging environment for customer resources. These resources are then propagated to member clusters that are part of the fleet, based on the <code>ClusterResourcePlacement</code> spec.</p>
<p>In essence, the objective is not to apply or create resources on the hub cluster for local use but to propagate these resources to other member clusters within the fleet.</p>
<p>Certain resources, when created or applied on the hub cluster, may lead to unintended side effects. These include:</p>
<ul>
<li>Validating/Mutating Webhook Configurations</li>
<li>Cluster Role Bindings</li>
<li>Resource Quotas</li>
<li>Storage Classes</li>
<li>Flow Schemas</li>
<li>Priority Classes</li>
<li>Ingress Classes</li>
<li>Ingresses</li>
<li>Network Policies</li>
</ul>
<p>To address this, we support the use of <code>ConfigMap</code> with a fleet-reserved annotation. This allows users to encapsulate resources that might have side effects on the hub cluster within the <code>ConfigMap</code>. For detailed instructions, please refer to this <a href="/website/docs/how-tos/envelope-object/">document</a>.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-490f2b78db8fecdc0bed1e8d68c8c706">1.2 - Fleet components</h1>
    <div class="lead">Concept about the Fleet components</div>
	<h1 id="components">Components</h1>
<p>This document provides an overview of the components required for a fully functional and operational Fleet setup.</p>
<p><img src="/images/en/docs/concepts/components/architecture.jpg" alt=""></p>
<p>The fleet consists of the following components:</p>
<ul>
<li>fleet-hub-agent is a Kubernetes controller that creates and reconciles all the fleet related CRs in the hub cluster.</li>
<li>fleet-member-agent is a Kubernetes controller that creates and reconciles all the fleet related CRs in the member cluster.
The fleet-member-agent is pulling the latest CRs from the hub cluster and consistently reconciles the member clusters to
the desired state.</li>
</ul>
<p>The fleet implements agent-based pull mode. So that the working pressure can be distributed to the member clusters, and it
helps to breach the bottleneck of scalability, by dividing the load into each member cluster. On the other hand, hub
cluster does not need to directly access to the member clusters. Fleet can support the member clusters which only have
the outbound network and no inbound network access.</p>
<p>To allow multiple clusters to run securely, fleet will create a reserved namespace on the hub cluster to isolate the access permissions and
resources across multiple clusters.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-b62b5665dfb021b8bec0a6ab728a3a54">1.3 - MemberCluster</h1>
    <div class="lead">Concept about the MemberCluster API</div>
	<h2 id="overview">Overview</h2>
<p>The fleet constitutes an implementation of a <a href="https://multicluster.sigs.k8s.io/api-types/cluster-set/"><code>ClusterSet</code></a> and
encompasses the following attributes:</p>
<ul>
<li>A collective of clusters managed by a centralized authority.</li>
<li>Typically characterized by a high level of mutual trust within the cluster set.</li>
<li>Embraces the principle of Namespace Sameness across clusters:
<ul>
<li>Ensures uniform permissions and characteristics for a given namespace across all clusters.</li>
<li>While not mandatory for every cluster, namespaces exhibit consistent behavior across those where they are present.</li>
</ul>
</li>
</ul>
<p>The <code>MemberCluster</code> represents a cluster-scoped API established within the hub cluster, serving as a representation of
a cluster within the fleet. This API offers a dependable, uniform, and automated approach for multi-cluster applications
(frameworks, toolsets) to identify registered clusters within a fleet. Additionally, it facilitates applications in querying
a list of clusters managed by the fleet or observing cluster statuses for subsequent actions.</p>
<p>Some illustrative use cases encompass:</p>
<ul>
<li>The Fleet Scheduler utilizing managed cluster statuses or specific cluster properties (e.g., labels, taints) of a <code>MemberCluster</code>
for resource scheduling.</li>
<li>Automation tools like GitOps systems (e.g., ArgoCD or Flux) automatically registering/deregistering clusters in compliance
with the <code>MemberCluster</code> API.</li>
<li>The <a href="https://multicluster.sigs.k8s.io/concepts/multicluster-services-api/">MCS API</a> automatically generating <code>ServiceImport</code> CRs
based on the <code>MemberCluster</code> CR defined within a fleet.</li>
</ul>
<p>Moreover, it furnishes a user-friendly interface for human operators to monitor the managed clusters.</p>
<h2 id="membercluster-lifecycle">MemberCluster Lifecycle</h2>
<h3 id="joining-the-fleet">Joining the Fleet</h3>
<p>The process to join the Fleet involves creating a <code>MemberCluster</code>. The <code>MemberCluster</code> controller, a constituent of the
hub-cluster-agent described in the <a href="/website/docs/concepts/components/">Component</a>, watches the <code>MemberCluster</code> CR and generates
a corresponding namespace for the member cluster within the hub cluster. It configures roles and role bindings within the
hub cluster, authorizing the specified member cluster identity (as detailed in the <code>MemberCluster</code> spec) access solely
to resources within that namespace. To collate member cluster status, the controller generates another internal CR named
<code>InternalMemberCluster</code> within the newly formed namespace. Simultaneously, the <code>InternalMemberCluster</code> controller, a component
of the member-cluster-agent situated in the member cluster, gathers statistics on cluster usage, such as capacity utilization,
and reports its status based on the <code>HeartbeatPeriodSeconds</code> specified in the CR. Meanwhile, the <code>MemberCluster</code> controller
consolidates agent statuses and marks the cluster as <code>Joined</code>.</p>
<h3 id="leaving-the-fleet">Leaving the Fleet</h3>
<p>Fleet administrators can deregister a cluster by deleting the <code>MemberCluster</code> CR. Upon detection of deletion events by
the <code>MemberCluster</code> controller within the hub cluster, it removes the corresponding <code>InternalMemberCluster</code> CR in the
reserved namespace of the member cluster. It awaits completion of the &ldquo;leave&rdquo; process by the <code>InternalMemberCluster</code>
controller of member agents, and then deletes role and role bindings and other resources including the member cluster reserved
namespaces on the hub cluster.</p>
<h2 id="taints">Taints</h2>
<p>Taints are a mechanism to prevent the Fleet Scheduler from scheduling resources to a <code>MemberCluster</code>. We adopt the concept of
<a href="https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/">taints and tolerations</a> introduced in Kubernetes to
the multi-cluster use case.</p>
<p>The <code>MemberCluster</code> CR supports the specification of list of taints, which are applied to the <code>MemberCluster</code>. Each Taint object comprises
the following fields:</p>
<ul>
<li><code>key</code>: The key of the taint.</li>
<li><code>value</code>: The value of the taint.</li>
<li><code>effect</code>: The effect of the taint, which can be <code>NoSchedule</code> for now.</li>
</ul>
<p>Once a <code>MemberCluster</code> is tainted with a specific taint, it lets the Fleet Scheduler know that the <code>MemberCluster</code> should not receive resources
as part of the workload propagation from the hub cluster.</p>
<p>The <code>NoSchedule</code> taint is a signal to the Fleet Scheduler to avoid scheduling resources from a <code>ClusterResourcePlacement</code> to the <code>MemberCluster</code>.
Any <code>MemberCluster</code> already selected for resource propagation will continue to receive resources even if a new taint is added.</p>
<p>Taints are only honored by <code>ClusterResourcePlacement</code> with <strong>PickAll</strong>, <strong>PickN</strong> placement policies. In the case of <strong>PickFixed</strong> placement policy
the taints are ignored because the user has explicitly specify the <code>MemberClusters</code> where the resources should be placed.</p>
<p>For detailed instructions, please refer to this <a href="/website/docs/how-tos/taints-tolerations/">document</a>.</p>
<h2 id="whats-next">What&rsquo;s next</h2>
<ul>
<li>Get hands-on experience <a href="/website/docs/how-tos/clusters/">how to add a member cluster to a fleet</a>.</li>
<li>Explore the <a href="/website/docs/concepts/crpc/"><code>ClusterResourcePlacement</code> concept to placement cluster scope resources among managed clusters</a>.</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-bd269a3c0871a350c7f51b81d2a79af9">1.4 - Scheduler</h1>
    <div class="lead">Concept about the Fleet scheduler</div>
	<p>The scheduler component is a vital element in Fleet workload scheduling. Its primary responsibility is to determine the
schedule decision for a bundle of resources based on the latest <code>ClusterSchedulingPolicySnapshot</code>generated by the <code>ClusterResourcePlacement</code>.
By default, the scheduler operates in batch mode, which enhances performance. In this mode, it binds a <code>ClusterResourceBinding</code>
from a <code>ClusterResourcePlacement</code> to multiple clusters whenever possible.</p>
<h2 id="batch-in-nature">Batch in nature</h2>
<p>Scheduling resources within a <code>ClusterResourcePlacement</code> involves more dependencies compared with scheduling pods within
a deployment in Kubernetes. There are two notable distinctions:</p>
<ol>
<li>In a <code>ClusterResourcePlacement</code>, multiple replicas of resources cannot be scheduled on the same cluster, whereas pods
belonging to the same deployment in Kubernetes can run on the same node.</li>
<li>The <code>ClusterResourcePlacement</code> supports different placement types within a single object.</li>
</ol>
<p>These requirements necessitate treating the scheduling policy as a whole and feeding it to the scheduler, as opposed to
handling individual pods like Kubernetes today. Specially:</p>
<ol>
<li>Scheduling the entire <code>ClusterResourcePlacement</code> at once enables us to increase the parallelism of the scheduler if
needed.</li>
<li>Supporting the <code>PickAll</code> mode would require generating the replica for each cluster in the fleet to scheduler. This
approach is not only inefficient but can also result in scheduler repeatedly attempting to schedule unassigned replica when
there are no possibilities of placing them.</li>
<li>To support the <code>PickN</code> mode, the scheduler needs to compute the filtering and scoring for each replica. Conversely,
in batch mode, these calculations are performed once. Scheduler sorts all the eligible clusters and pick the top N clusters.</li>
</ol>
<h2 id="placement-decisions">Placement Decisions</h2>
<p>The output of the scheduler is an array of <code>ClusterResourceBinding</code>s on the hub cluster.</p>
<p><code>ClusterResourceBinding</code> sample:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourceBinding</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">annotations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kubernetes-fleet.io/previous-binding-state</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Bound</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">creationTimestamp</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2023-11-06T09:53:11Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">finalizers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">kubernetes-fleet.io/work-cleanup</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">generation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">8</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">labels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kubernetes-fleet.io/parent-CRP</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">crp-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">crp-1-aks-member-1-2f8fe606</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;1641949&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">uid</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">3a443dec-a5ad-4c15-9c6d-05727b9e1d15</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">clusterDecision</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">clusterName</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">aks-member-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">clusterScore</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">affinityScore</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">priorityScore</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">picked by scheduling policy</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">selected</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceSnapshotName</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">crp-1-4-snapshot</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">schedulingPolicySnapshotName</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">crp-1-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">state</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Bound</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">targetCluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">aks-member-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">conditions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">lastTransitionTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2023-11-06T09:53:11Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">observedGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">8</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">AllWorkSynced</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;True&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Bound</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">lastTransitionTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2023-11-10T08:23:38Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">observedGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">8</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">AllWorkHasBeenApplied</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;True&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Applied</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p><code>ClusterResourceBinding</code> can have three states:</p>
<ul>
<li><em>Scheduled</em>: It indicates that the scheduler has selected this cluster for placing the resources. The resource is waiting
to be picked up by the rollout controller.</li>
<li><em>Bound</em>: It indicates that the rollout controller has initiated the placement of resources on the target cluster. The
resources are actively being deployed.</li>
<li><em>Unscheduled</em>: This states signifies that the target cluster is no longer selected by the scheduler for the placement.
The resource associated with this cluster are in the process of being removed. They are awaiting deletion from the cluster.</li>
</ul>
<p>The scheduler operates by generating scheduling decisions through the creating of new bindings in the &ldquo;scheduled&rdquo; state
and the removal of existing bindings by marking them as &ldquo;unscheduled&rdquo;. There is a separate rollout controller which is
responsible for executing these decisions based on the defined rollout strategy.</p>
<h2 id="enforcing-the-semantics-of-ignoreduringexecutiontime">Enforcing the semantics of &ldquo;IgnoreDuringExecutionTime&rdquo;</h2>
<p>The <code>ClusterResourcePlacement</code> enforces the semantics of &ldquo;IgnoreDuringExecutionTime&rdquo; to prioritize the stability of resources
running in production. Therefore, the resources should not be moved or rescheduled without explicit changes to the scheduling
policy.</p>
<p>Here are some high-level guidelines outlining the actions that trigger scheduling and corresponding behavior:</p>
<ol>
<li>
<p><code>Policy</code> changes trigger scheduling:</p>
<ul>
<li>The scheduler makes the placement decisions based on the latest <code>ClusterSchedulingPolicySnapshot</code>.</li>
<li>When it&rsquo;s just a scale out operation (<code>NumberOfClusters</code> of pickN mode is increased), the <code>ClusterResourcePlacement</code>
controller updates the label of the existing <code>ClusterSchedulingPolicySnapshot</code> instead of creating a new one, so that
the scheduler won&rsquo;t move any existing resources that are already scheduled and just fulfill the new requirement.</li>
</ul>
</li>
<li>
<p>The following cluster changes trigger scheduling:</p>
<ul>
<li>a cluster, originally ineligible for resource placement for some reason, becomes eligible, such as:
<ul>
<li>the cluster setting changes, specifically <code>MemberCluster</code> labels has changed</li>
<li>an unexpected deployment which originally leads the scheduler to discard the cluster (for example, agents not joining,
networking issues, etc.) has been resolved</li>
</ul>
</li>
<li>a cluster, originally eligible for resource placement, is leaving the fleet and becomes ineligible</li>
</ul>
<blockquote>
<p>Note: The scheduler is only going to place the resources on the new cluster and won&rsquo;t touch the existing clusters.</p></blockquote>
</li>
<li>
<p>Resource-only changes <strong>do not</strong> trigger scheduling including:</p>
<ul>
<li><code>ResourceSelectors</code> is updated in the <code>ClusterResourcePlacement</code> spec.</li>
<li>The selected resources is updated without directly affecting the <code>ClusterResourcePlacement</code>.</li>
</ul>
</li>
</ol>
<h2 id="whats-next">What&rsquo;s next</h2>
<ul>
<li>Read about <a href="scheduler-framework">Scheduling Framework</a></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-e149527fa64d0c3eacbb2ff5e7b6ffea">1.5 - Scheduling Framework</h1>
    <div class="lead">Concept about the Fleet scheduling framework</div>
	<p>The fleet scheduling framework closely aligns with the native <a href="https://kubernetes.io/docs/concepts/scheduling-eviction/scheduling-framework/">Kubernetes scheduling framework</a>,
incorporating several modifications and tailored functionalities.</p>
<p><img src="/website/images/en/docs/concepts/scheduling-framework/scheduling-framework.jpg" alt=""></p>
<p>The primary advantage of this framework lies in its capability to compile plugins directly into the scheduler. Its API
facilitates the implementation of diverse scheduling features as plugins, thereby ensuring a lightweight and maintainable
core.</p>
<p>The fleet scheduler integrates three fundamental built-in plugin types:</p>
<ul>
<li><strong>Topology Spread Plugin</strong>: Supports the TopologySpreadConstraints stipulated in the placement policy.</li>
<li><strong>Cluster Affinity Plugin</strong>: Facilitates the Affinity clause of the placement policy.</li>
<li><strong>Same Placement Affinity Plugin</strong>: Uniquely designed for the fleet, preventing multiple replicas (selected resources) from
being placed within the same cluster. This distinguishes it from Kubernetes, which allows multiple pods on a node.</li>
<li><strong>Cluster Eligibility Plugin</strong>: Enables cluster selection based on specific status criteria.</li>
<li>** Taint &amp; Toleration Plugin**: Enables cluster selection based on taints on the cluster &amp; tolerations on the ClusterResourcePlacement.</li>
</ul>
<p>Compared to the Kubernetes scheduling framework, the fleet framework introduces additional stages for the pickN placement type:</p>
<ul>
<li><strong>Batch &amp; PostBatch</strong>:
<ul>
<li>Batch: Defines the batch size based on the desired and current <code>ClusterResourceBinding</code>.</li>
<li>PostBatch: Adjusts the batch size as necessary. Unlike the Kubernetes scheduler, which schedules pods individually (batch size = 1).</li>
</ul>
</li>
<li><strong>Sort</strong>:
<ul>
<li>Fleet&rsquo;s sorting mechanism selects a number of clusters, whereas Kubernetes&rsquo; scheduler prioritizes nodes with the highest scores.</li>
</ul>
</li>
</ul>
<p>To streamline the scheduling framework, certain stages, such as <code>permit</code> and <code>reserve</code>, have been omitted due to the absence
of corresponding plugins or APIs enabling customers to reserve or permit clusters for specific placements. However, the
framework remains designed for easy extension in the future to accommodate these functionalities.</p>
<h2 id="in-tree-plugins">In-tree plugins</h2>
<p>The scheduler includes default plugins, each associated with distinct extension points:</p>
<table>
  <thead>
      <tr>
          <th>Plugin</th>
          <th>PostBatch</th>
          <th>Filter</th>
          <th>Score</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Cluster Affinity</td>
          <td>❌</td>
          <td>✅</td>
          <td>✅</td>
      </tr>
      <tr>
          <td>Same Placement Anti-affinity</td>
          <td>❌</td>
          <td>✅</td>
          <td>❌</td>
      </tr>
      <tr>
          <td>Topology Spread Constraints</td>
          <td>✅</td>
          <td>✅</td>
          <td>✅</td>
      </tr>
      <tr>
          <td>Cluster Eligibility</td>
          <td>❌</td>
          <td>✅</td>
          <td>❌</td>
      </tr>
      <tr>
          <td>Taint &amp; Toleration</td>
          <td>❌</td>
          <td>✅</td>
          <td>❌</td>
      </tr>
  </tbody>
</table>
<p>The Cluster Affinity Plugin serves as an illustrative example and operates within the following extension points:</p>
<ol>
<li><strong>PreFilter</strong>:
Verifies whether the policy contains any required cluster affinity terms. If absent, the plugin bypasses the subsequent
Filter stage.</li>
<li><strong>Filter</strong>:
Filters out clusters that fail to meet the specified required cluster affinity terms outlined in the policy.</li>
<li><strong>PreScore</strong>:
Determines if the policy includes any preferred cluster affinity terms. If none are found, this plugin will be skipped
during the Score stage.</li>
<li><strong>Score</strong>:
Assigns affinity scores to clusters based on compliance with the preferred cluster affinity terms stipulated in the policy.</li>
</ol>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-716d7f944c3423c5dfa17047db699aed">1.6 - Properties and Property Provides</h1>
    <div class="lead">Concept about cluster properties and property provides</div>
	<p>This document explains the concepts of property provider and cluster properties in Fleet.</p>
<p>Fleet allows developers to implement a property provider to expose arbitrary properties about
a member cluster, such as its node count and available resources for workload placement. Platforms
could also enable their property providers to expose platform-specific properties via Fleet.
These properties can be useful in a variety of cases: for example, administrators could monitor the
health of a member cluster using related properties; Fleet also supports making scheduling
decisions based on the property data.</p>
<h2 id="property-provider">Property provider</h2>
<p>A property provider implements Fleet&rsquo;s property provider interface:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">// PropertyProvider is the interface that every property provider must implement.</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">type</span> <span style="color:#000">PropertyProvider</span> <span style="color:#204a87;font-weight:bold">interface</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8f5902;font-style:italic">// Collect is called periodically by the Fleet member agent to collect properties.</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8f5902;font-style:italic">//</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8f5902;font-style:italic">// Note that this call should complete promptly. Fleet member agent will cancel the</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8f5902;font-style:italic">// context if the call does not complete in time.</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">Collect</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ctx</span> <span style="color:#000">context</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Context</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000">PropertyCollectionResponse</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8f5902;font-style:italic">// Start is called when the Fleet member agent starts up to initialize the property provider.</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8f5902;font-style:italic">// This call should not block.</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8f5902;font-style:italic">//</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8f5902;font-style:italic">// Note that Fleet member agent will cancel the context when it exits.</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">Start</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ctx</span> <span style="color:#000">context</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Context</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">config</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">rest</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Config</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">error</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>For the details, see the <a href="../../../pkg/propertyprovider/interface.go">Fleet source code</a>.</p>
<p>A property provider should be shipped as a part of the Fleet member agent and run alongside it.
Refer to the <a href="../../../cmd/memberagent/main.go">Fleet source code</a>
for specifics on how to set it up with the Fleet member agent.
At this moment, only one property provider can be set up with the Fleet member agent at a time.
Once connected, the Fleet member agent will attempt to start it when
the agent itself initializes; the agent will then start collecting properties from the
property provider periodically.</p>
<p>A property provider can expose two types of properties: resource properties, and non-resource
properties. To learn about the two types, see the section below. In addition, the provider can
choose to report its status, such as any errors encountered when preparing the properties,
in the form of Kubernetes conditions.</p>
<p>The Fleet member agent can run with or without a property provider. If a provider is not set up, or
the given provider fails to start properly, the agent will collect limited properties about
the cluster on its own, specifically the node count, plus the total/allocatable
CPU and memory capacities of the host member cluster.</p>
<h2 id="cluster-properties">Cluster properties</h2>
<p>A cluster property is an attribute of a member cluster. There are two types of properties:</p>
<ul>
<li>
<p>Resource property: the usage information of a resource in a member cluster; the
name of the resource should be in the format of
<a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/#syntax-and-character-set">a Kubernetes label key</a>,
such as <code>cpu</code> and <code>memory</code>, and the usage information should consist of:</p>
<ul>
<li>the total capacity of the resource, which is the amount of the resource
installed in the cluster;</li>
<li>the allocatable capacity of the resource, which is the maximum amount of the resource
that can be used for running user workloads, as some amount of the resource might be
reserved by the OS, kubelet, etc.;</li>
<li>the available capacity of the resource, which is the amount of the resource that
is currently free for running user workloads.</li>
</ul>
<p>Note that you may report a virtual resource via the property provider, if applicable.</p>
</li>
<li>
<p>Non-resource property: a metric about a member cluster, in the form of a key/value
pair; the key should be in the format of
<a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/#syntax-and-character-set">a Kubernetes label key</a>,
such as <code>kubernetes-fleet.io/node-count</code>, and the value at this moment should be a sortable
numeric that can be parsed as
<a href="https://kubernetes.io/docs/reference/kubernetes-api/common-definitions/quantity/">a Kubernetes quantity</a>.</p>
</li>
</ul>
<p>Eventually, all cluster properties are exposed via the Fleet <code>MemberCluster</code> API, with the
non-resource properties in the <code>.status.properties</code> field and the resource properties
<code>.status.resourceUsage</code> field:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">cluster.kubernetes-fleet.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">MemberCluster</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">agentStatus</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">conditions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">properties</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kubernetes-fleet.io/node-count</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">observationTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-04-30T14:54:24Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">value</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceUsage</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">allocatable</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">cpu</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">32</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">memory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;16Gi&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">available</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">cpu</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">memory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;800Mi&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">capacity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">cpu</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">40</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">memory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;20Gi&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Note that conditions reported by the property provider (if any), would be available in the
<code>.status.conditions</code> array as well.</p>
<h3 id="core-properties">Core properties</h3>
<p>The following properties are considered core properties in Fleet, which should be supported
in all property provider implementations. Fleet agents will collect them even when no
property provider has been set up.</p>
<table>
  <thead>
      <tr>
          <th>Property Type</th>
          <th>Name</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Non-resource property</td>
          <td><code>kubernetes-fleet.io/node-count</code></td>
          <td>The number of nodes in a cluster.</td>
      </tr>
      <tr>
          <td>Resource property</td>
          <td><code>cpu</code></td>
          <td>The usage information (total, allocatable, and available capacity) of CPU resource in a cluster.</td>
      </tr>
      <tr>
          <td>Resource property</td>
          <td><code>memory</code></td>
          <td>The usage information (total, allocatable, and available capacity) of memory resource in a cluster.</td>
      </tr>
  </tbody>
</table>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-057b31916d61f2f113de30f88397f691">1.7 - Safe Rollout</h1>
    <div class="lead">Concept about rolling out changes safely in Fleet</div>
	<p>One of the most important features of Fleet is the ability to safely rollout changes across multiple clusters. We do
this by rolling out the changes in a controlled manner, ensuring that we only continue to propagate the changes to the
next target clusters if the resources are successfully applied to the previous target clusters.</p>
<h2 id="overview">Overview</h2>
<p>We automatically propagate any resource changes that are selected by a <code>ClusterResourcePlacement</code> from the hub cluster
to the target clusters based on the placement policy defined in the <code>ClusterResourcePlacement</code>. In order to reduce the
blast radius of such operation, we provide users a way to safely rollout the new changes so that a bad release
won&rsquo;t affect all the running instances all at once.</p>
<h2 id="rollout-strategy">Rollout Strategy</h2>
<p>We currently only support the <code>RollingUpdate</code> rollout strategy. It updates the resources in the selected target clusters
gradually based on the <code>maxUnavailable</code> and <code>maxSurge</code> settings.</p>
<h2 id="in-place-update-policy">In place update policy</h2>
<p>We always try to do in-place update by respecting the rollout strategy if there is no change in the placement. This is to avoid unnecessary
interrupts to the running workloads when there is only resource changes. For example, if you only change the tag of the
deployment in the namespace you want to place, we will do an in-place update on the deployments already placed on the
targeted cluster instead of moving the existing deployments to other clusters even if the labels or properties of the
current clusters are not the best to match the current placement policy.</p>
<h2 id="how-to-use-rollingupdateconfig">How To Use RollingUpdateConfig</h2>
<p>RolloutUpdateConfig is used to control behavior of the rolling update strategy.</p>
<h3 id="maxunavailable-and-maxsurge">MaxUnavailable and MaxSurge</h3>
<p><code>MaxUnavailable</code> specifies the maximum number of connected clusters to the fleet compared to <code>target number of clusters</code>
specified in <code>ClusterResourcePlacement</code> policy in which resources propagated by the <code>ClusterResourcePlacement</code> can be
unavailable. Minimum value for <code>MaxUnavailable</code> is set to 1 to avoid stuck rollout during in-place resource update.</p>
<p><code>MaxSurge</code> specifies the maximum number of clusters that can be scheduled with resources above the <code>target number of clusters</code>
specified in <code>ClusterResourcePlacement</code> policy.</p>
<blockquote>
<p><strong>Note:</strong> <code>MaxSurge</code> only applies to rollouts to newly scheduled clusters, and doesn&rsquo;t apply to rollouts of workload triggered by
updates to already propagated resource. For updates to already propagated resources, we always try to do the updates in
place with no surge.</p></blockquote>
<p><code>target number of clusters</code> changes based on the <code>ClusterResourcePlacement</code> policy.</p>
<ul>
<li>For PickAll, it&rsquo;s the number of clusters picked by the scheduler.</li>
<li>For PickN, it&rsquo;s the number of clusters specified in the <code>ClusterResourcePlacement</code> policy.</li>
<li>For PickFixed, it&rsquo;s the length of the list of cluster names specified in the <code>ClusterResourcePlacement</code> policy.</li>
</ul>
<h4 id="example-1">Example 1:</h4>
<p>Consider a fleet with 4 connected member clusters (cluster-1, cluster-2, cluster-3 &amp; cluster-4) where every member
cluster has label <code>env: prod</code>. The hub cluster has a namespace called <code>test-ns</code> with a deployment in it.</p>
<p>The <code>ClusterResourcePlacement</code> spec is defined as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">group</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Namespace</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test-ns</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">placementType</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">PickN</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">numberOfClusters</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">affinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">clusterAffinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">requiredDuringSchedulingIgnoredDuringExecution</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">clusterSelectorTerms</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#204a87;font-weight:bold">labelSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#204a87;font-weight:bold">env</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">prod</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">strategy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">rollingUpdate</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">maxUnavailable</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">maxSurge</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>The rollout will be as follows:</p>
<ul>
<li>
<p>We try to pick 3 clusters out of 4, for this scenario let&rsquo;s say we pick cluster-1, cluster-2 &amp; cluster-3.</p>
</li>
<li>
<p>Since we can&rsquo;t track the initial availability for the deployment, we rollout the namespace with deployment to
cluster-1, cluster-2 &amp; cluster-3.</p>
</li>
<li>
<p>Then we update the deployment with a bad image name to update the resource in place on cluster-1, cluster-2 &amp; cluster-3.</p>
</li>
<li>
<p>But since we have <code>maxUnavailable</code> set to 1, we will rollout the bad image name update for deployment to one of the clusters
(which cluster the resource is rolled out to first is non-deterministic).</p>
</li>
<li>
<p>Once the deployment is updated on the first cluster, we will wait for the deployment&rsquo;s availability to be true before
rolling out to the other clusters</p>
</li>
<li>
<p>And since we rolled out a bad image name update for the deployment it&rsquo;s availability will always be false and hence the
rollout for the other two clusters will be stuck</p>
</li>
<li>
<p>Users might think <code>maxSurge</code> of 1 might be utilized here but in this case since we are updating the resource in place
<code>maxSurge</code> will not be utilized to surge and pick cluster-4.</p>
</li>
</ul>
<blockquote>
<p><strong>Note:</strong> <code>maxSurge</code> will be utilized to pick cluster-4, if we change the policy to pick 4 cluster or change placement
type to <code>PickAll</code>.</p></blockquote>
<h4 id="example-2">Example 2:</h4>
<p>Consider a fleet with 4 connected member clusters (cluster-1, cluster-2, cluster-3 &amp; cluster-4) where,</p>
<ul>
<li>cluster-1 and cluster-2 has label <code>loc: west</code></li>
<li>cluster-3 and cluster-4 has label <code>loc: east</code></li>
</ul>
<p>The hub cluster has a namespace called <code>test-ns</code> with a deployment in it.</p>
<p>Initially, the <code>ClusterResourcePlacement</code> spec is defined as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">group</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Namespace</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1          </span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test-ns</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">placementType</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">PickN</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">numberOfClusters</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">affinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">clusterAffinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">requiredDuringSchedulingIgnoredDuringExecution</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">clusterSelectorTerms</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">              </span>- <span style="color:#204a87;font-weight:bold">labelSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                    </span><span style="color:#204a87;font-weight:bold">loc</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">west</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">strategy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">rollingUpdate</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">maxSurge</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>The rollout will be as follows:</p>
<ul>
<li>We try to pick clusters (cluster-1 and cluster-2) by specifying the label selector <code>loc: west</code>.</li>
<li>Since we can&rsquo;t track the initial availability for the deployment, we rollout the namespace with deployment to cluster-1
and cluster-2 and wait till they become available.</li>
</ul>
<p>Then we update the <code>ClusterResourcePlacement</code> spec to the following:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">group</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Namespace</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1          </span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test-ns</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">placementType</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">PickN</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">numberOfClusters</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">affinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">clusterAffinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">requiredDuringSchedulingIgnoredDuringExecution</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">clusterSelectorTerms</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">              </span>- <span style="color:#204a87;font-weight:bold">labelSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                    </span><span style="color:#204a87;font-weight:bold">loc</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">east</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">strategy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">rollingUpdate</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">maxSurge</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>The rollout will be as follows:</p>
<ul>
<li>We try to pick clusters (cluster-3 and cluster-4) by specifying the label selector <code>loc: east</code>.</li>
<li>But this time around since we have <code>maxSurge</code> set to 2 we are saying we can propagate resources to a maximum of
4 clusters but our target number of clusters specified is 2, we will rollout the namespace with deployment to both
cluster-3 and cluster-4 before removing the deployment from cluster-1 and cluster-2.</li>
<li>And since <code>maxUnavailable</code> is always set to 25% by default which is rounded off to 1, we will remove the
resource from one of the existing clusters (cluster-1 or cluster-2) because when <code>maxUnavailable</code> is 1 the policy
mandates at least one cluster to be available.</li>
</ul>
<h3 id="unavailableperiodseconds">UnavailablePeriodSeconds</h3>
<p><code>UnavailablePeriodSeconds</code> is used to configure the waiting time between rollout phases when we cannot determine if the
resources have rolled out successfully or not. This field is used only if the availability of resources we propagate
are not trackable. Refer to the <a href="/website/docs/concepts/safe-rollout/#data-only-objects">Data only object</a> section for more details.</p>
<h2 id="availability-based-rollout">Availability based Rollout</h2>
<p>We have built-in mechanisms to determine the availability of some common Kubernetes native resources. We only mark them
as available in the target clusters when they meet the criteria we defined.</p>
<h3 id="how-it-works">How It Works</h3>
<p>We have an agent running in the target cluster to check the status of the resources. We have specific criteria for each
of the following resources to determine if they are available or not. Here are the list of resources we support:</p>
<h4 id="deployment">Deployment</h4>
<p>We only mark a <code>Deployment</code> as available when all its pods are running, ready and updated according to the latest spec.</p>
<h4 id="daemonset">DaemonSet</h4>
<p>We only mark a <code>DaemonSet</code> as available when all its pods are available and updated according to the latest spec on all
desired scheduled nodes.</p>
<h4 id="statefulset">StatefulSet</h4>
<p>We only mark a <code>StatefulSet</code> as available when all its pods are running, ready and updated according to the latest revision.</p>
<h4 id="job">Job</h4>
<p>We only mark a <code>Job</code> as available when it has at least one succeeded pod or one ready pod.</p>
<h4 id="service">Service</h4>
<p>For <code>Service</code> based on the service type the availability is determined as follows:</p>
<ul>
<li>For <code>ClusterIP</code> &amp; <code>NodePort</code> service, we mark it as available when a cluster IP is assigned.</li>
<li>For <code>LoadBalancer</code> service, we mark it as available when a <code>LoadBalancerIngress</code> has been assigned along with an IP or Hostname.</li>
<li>For <code>ExternalName</code> service, checking availability is not supported, so it will be marked as available with not trackable reason.</li>
</ul>
<h4 id="data-only-objects">Data only objects</h4>
<p>For the objects described below since they are a data resource we mark them as available immediately after creation,</p>
<ul>
<li>Namespace</li>
<li>Secret</li>
<li>ConfigMap</li>
<li>Role</li>
<li>ClusterRole</li>
<li>RoleBinding</li>
<li>ClusterRoleBinding</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f14a979ac0ba3b2cbfcab451b17d9e7a">1.8 - Override</h1>
    <div class="lead">Concept about the override APIs</div>
	<h2 id="overview">Overview</h2>
<p>The <code>ClusterResourceOverride</code> and <code>ResourceOverride</code> provides a way to customize resource configurations before they are propagated
to the target cluster by the <code>ClusterResourcePlacement</code>.</p>
<h2 id="difference-between-clusterresourceoverride-and-resourceoverride">Difference Between <code>ClusterResourceOverride</code> And <code>ResourceOverride</code></h2>
<p><code>ClusterResourceOverride</code> represents the cluster-wide policy that overrides the cluster scoped resources to one or more
clusters while <code>ResourceOverride</code> will apply to resources in the same namespace as the namespace-wide policy.</p>
<blockquote>
<p><strong>Note:</strong> If a namespace is selected by the <code>ClusterResourceOverride</code>, ALL the resources under the namespace are selected
automatically.</p></blockquote>
<p>If the resource is selected by both <code>ClusterResourceOverride</code> and <code>ResourceOverride</code>, the <code>ResourceOverride</code> will win
when resolving the conflicts.</p>
<h2 id="when-to-use-override">When To Use Override</h2>
<p>Overrides is useful when you want to customize the resources before they are propagated from the hub cluster to the target clusters.
Some example use cases are:</p>
<ul>
<li>As a platform operator, I want to propagate a clusterRoleBinding to cluster-us-east and cluster-us-west and would like to
grant the same role to different groups in each cluster.</li>
<li>As a platform operator, I want to propagate a clusterRole to cluster-staging and cluster-production and would like to
grant more permissions to the cluster-staging cluster than the cluster-production cluster.</li>
<li>As a platform operator, I want to propagate a namespace to all the clusters and would like to customize the labels for
each cluster.</li>
<li>As an application developer, I would like to propagate a deployment to cluster-staging and cluster-production and would
like to always use the latest image in the staging cluster and a specific image in the production cluster.</li>
<li>As an application developer, I would like to propagate a deployment to all the clusters and would like to use different
commands for my container in different regions.</li>
</ul>
<h2 id="limits">Limits</h2>
<ul>
<li>Each resource can be only selected by one override simultaneously. In the case of namespace scoped resources, up to two
overrides will be allowed, considering the potential selection through both <code>ClusterResourceOverride</code> (select its namespace)
and <code>ResourceOverride</code>.</li>
<li>At most 100 <code>ClusterResourceOverride</code> can be created.</li>
<li>At most 100 <code>ResourceOverride</code> can be created.</li>
</ul>
<h2 id="resource-selector">Resource Selector</h2>
<p><code>ClusterResourceSelector</code> of <code>ClusterResourceOverride</code> selects which cluster-scoped resources need to be overridden before
applying to the selected clusters.</p>
<p>It supports the following forms of resource selection:</p>
<ul>
<li>Select resources by specifying the &lt;group, version, kind&gt; and name. This selection propagates only one resource that
matches the &lt;group, version, kind&gt; and name.</li>
</ul>
<blockquote>
<p><strong>Note:</strong> Label selector of <code>ClusterResourceSelector</code> is not supported.</p></blockquote>
<p><code>ResourceSelector</code> of <code>ResourceOverride</code> selects which namespace-scoped resources need to be overridden before applying to
the selected clusters.</p>
<p>It supports the following forms of resource selection:</p>
<ul>
<li>Select resources by specifying the &lt;group, version, kind&gt; and name. This selection propagates only one resource that
matches the &lt;group, version, kind&gt; and name under the <code>ResourceOverride</code> namespace.</li>
</ul>
<h2 id="override-policy">Override Policy</h2>
<p>Override policy defines how to override the selected resources on the target clusters.</p>
<p>It contains an array of override rules and its order determines the override order. For example, when there are two rules
selecting the same fields on the target cluster, the last one will win.</p>
<p>Each override rule contains the following fields:</p>
<ul>
<li><code>ClusterSelector</code>: which cluster(s) the override rule applies to. It supports the following forms of cluster selection:
<ul>
<li>Select clusters by specifying the cluster labels.</li>
<li>An empty selector selects ALL the clusters.</li>
<li>A nil selector selects NO target cluster.</li>
</ul>
</li>
<li><code>JSONPatchOverrides</code>: a list of JSON path override rules applied to the selected resources following <a href="https://datatracker.ietf.org/doc/html/rfc6902">RFC 6902</a>.</li>
</ul>
<blockquote>
<p><strong>Note:</strong> Updating the fields in the TypeMeta (e.g., <code>apiVersion</code>, <code>kind</code>) is not allowed.</p></blockquote>
<blockquote>
<p><strong>Note:</strong> Updating the fields in the ObjectMeta (e.g., <code>name</code>, <code>namespace</code>) excluding annotations and labels is not allowed.</p></blockquote>
<blockquote>
<p><strong>Note:</strong> Updating the fields in the Status (e.g., <code>status</code>) is not allowed.</p></blockquote>
<h2 id="when-to-trigger-rollout">When To Trigger Rollout</h2>
<p>It will take the snapshot of each override change as a result of <code>ClusterResourceOverrideSnapshot</code> and
<code>ResourceOverrideSnapshot</code>. The snapshot will be used to determine whether the override change should be applied to the existing
<code>ClusterResourcePlacement</code> or not. If applicable, it will start rolling out the new resources to the target clusters by
respecting the rollout strategy defined in the <code>ClusterResourcePlacement</code>.</p>
<h2 id="examples">Examples</h2>
<h3 id="add-annotations-to-the-configmap-by-using-clusterresourceoverride">add annotations to the configmap by using clusterResourceOverride</h3>
<p>Suppose we create a configmap named <code>app-config-1</code> under the namespace <code>application-1</code> in the hub cluster, and we want to
add an annotation to it, which is applied to all the member clusters.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">data</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">data</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ConfigMap</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">creationTimestamp</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-05-07T08:06:27Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">app-config-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">application-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;1434&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">uid</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">b4109de8-32f2-4ac8-9e1a-9cb715b3261d</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Create a <code>ClusterResourceOverride</code> named <code>cro-1</code> to add an annotation to the namespace <code>application-1</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1alpha1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourceOverride</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">creationTimestamp</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-05-07T08:06:27Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">finalizers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#000">kubernetes-fleet.io/override-cleanup</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">generation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">cro-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;1436&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">uid</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">32237804</span>-<span style="color:#000">7eb2-4d5f-9996-ff4d8ce778e7</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">clusterResourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">group</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Namespace</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">application-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">overrideRules</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">clusterSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">clusterSelectorTerms</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">jsonPatchOverrides</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#204a87;font-weight:bold">op</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">add</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/metadata/annotations</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">value</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#204a87;font-weight:bold">cro-test-annotation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">cro-test-annotation-val</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Check the configmap on one of the member cluster by running <code>kubectl get configmap app-config-1 -n application-1 -o yaml</code> command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">data</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">data</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ConfigMap</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">annotations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">cro-test-annotation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">cro-test-annotation-val</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kubernetes-fleet.io/last-applied-configuration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;{&#34;apiVersion&#34;:&#34;v1&#34;,&#34;data&#34;:{&#34;data&#34;:&#34;test&#34;},&#34;kind&#34;:&#34;ConfigMap&#34;,&#34;metadata&#34;:{&#34;annotations&#34;:{&#34;cro-test-annotation&#34;:&#34;cro-test-annotation-val&#34;,&#34;kubernetes-fleet.io/spec-hash&#34;:&#34;4dd5a08aed74884de455b03d3b9c48be8278a61841f3b219eca9ed5e8a0af472&#34;},&#34;name&#34;:&#34;app-config-1&#34;,&#34;namespace&#34;:&#34;application-1&#34;,&#34;ownerReferences&#34;:[{&#34;apiVersion&#34;:&#34;placement.kubernetes-fleet.io/v1beta1&#34;,&#34;blockOwnerDeletion&#34;:false,&#34;kind&#34;:&#34;AppliedWork&#34;,&#34;name&#34;:&#34;crp-1-work&#34;,&#34;uid&#34;:&#34;77d804f5-f2f1-440e-8d7e-e9abddacb80c&#34;}]}}&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kubernetes-fleet.io/spec-hash</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">4dd5a08aed74884de455b03d3b9c48be8278a61841f3b219eca9ed5e8a0af472</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">creationTimestamp</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-05-07T08:06:27Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">app-config-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">application-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">ownerReferences</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">blockOwnerDeletion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">AppliedWork</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">crp-1-work</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">uid</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">77d804f5-f2f1-440e-8d7e-e9abddacb80c</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;1449&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">uid</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">a8601007-1e6b-4b64-bc05-1057ea6bd21b</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h3 id="add-annotations-to-the-configmap-by-using-resourceoverride">add annotations to the configmap by using resourceOverride</h3>
<p>You can use the <code>ResourceOverride</code> to add an annotation to the configmap <code>app-config-1</code> explicitly in the namespace <code>application-1</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1alpha1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ResourceOverride</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">creationTimestamp</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-05-07T08:25:31Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">finalizers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">kubernetes-fleet.io/override-cleanup</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">generation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ro-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">application-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;3859&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">uid</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">b4117925-bc3c-438d-a4f6-067bc4577364</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">overrideRules</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">clusterSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">clusterSelectorTerms</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">jsonPatchOverrides</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">op</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">add</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/metadata/annotations</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">value</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">ro-test-annotation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ro-test-annotation-val</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">group</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ConfigMap</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">app-config-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h2 id="how-to-validate-if-overrides-are-applied">How To Validate If Overrides Are Applied</h2>
<p>You can validate if the overrides are applied by checking the <code>ClusterResourcePlacement</code> status. The status output will
indicate both placement conditions and individual placement statuses on each member cluster that was overridden.</p>
<p>Sample output:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">conditions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">lastTransitionTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-05-07T08:06:27Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">found all the clusters needed as specified by the scheduling policy</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">observedGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">SchedulingPolicyFulfilled</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;True&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacementScheduled</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">lastTransitionTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-05-07T08:06:27Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">All 3 cluster(s) start rolling out the latest resource</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">observedGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">RolloutStarted</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;True&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacementRolloutStarted</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">lastTransitionTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-05-07T08:06:27Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">The selected resources are successfully overridden in the 3 clusters</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">observedGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">OverriddenSucceeded</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;True&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacementOverridden</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">lastTransitionTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-05-07T08:06:27Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Works(s) are succcesfully created or updated in the 3 target clusters&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#000">namespaces</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">observedGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">WorkSynchronized</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;True&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacementWorkSynchronized</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">lastTransitionTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-05-07T08:06:27Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">The selected resources are successfully applied to 3 clusters</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">observedGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ApplySucceeded</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;True&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacementApplied</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">lastTransitionTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-05-07T08:06:27Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">The selected resources in 3 cluster are available now</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">observedGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ResourceAvailable</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;True&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacementAvailable</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">observedResourceIndex</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;0&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">placementStatuses</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">applicableClusterResourceOverrides</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#000">cro-1-0</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">clusterName</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">kind-cluster-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">conditions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">lastTransitionTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-05-07T08:06:27Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;Successfully scheduled resources for placement in kind-cluster-1 (affinity
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        score: 0, topology spread score: 0): picked by scheduling policy&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">observedGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Scheduled</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;True&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Scheduled</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">lastTransitionTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-05-07T08:06:27Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Detected the new changes on the resources and started the rollout process</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">observedGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">RolloutStarted</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;True&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">RolloutStarted</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">lastTransitionTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-05-07T08:06:27Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Successfully applied the override rules on the resources</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">observedGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">OverriddenSucceeded</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;True&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Overridden</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">lastTransitionTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-05-07T08:06:27Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">All of the works are synchronized to the latest</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">observedGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">AllWorkSynced</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;True&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">WorkSynchronized</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">lastTransitionTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-05-07T08:06:27Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">All corresponding work objects are applied</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">observedGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">AllWorkHaveBeenApplied</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;True&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Applied</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">lastTransitionTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-05-07T08:06:27Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">The availability of work object crp-1-work is not trackable</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">observedGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">WorkNotTrackable</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;True&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Available</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p><code>applicableClusterResourceOverrides</code> in <code>placementStatuses</code> indicates which <code>ClusterResourceOverrideSnapshot</code> that is applied
to the target cluster. Similarly, <code>applicableResourceOverrides</code> will be set if the <code>ResourceOverrideSnapshot</code> is applied.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-8ddd4e0ab9f151e89ec11f8f8feb3f69">1.9 - Staged Update</h1>
    <div class="lead">Concept about Staged Update</div>
	<p>While users rely on the <code>RollingUpdate</code> rollout strategy to safely roll out their workloads,
there is also a requirement for a staged rollout mechanism at the cluster level to enable more controlled and systematic continuous delivery (CD) across the fleet.
Introducing a staged update run feature would address this need by enabling gradual deployments, reducing risk, and ensuring greater reliability and consistency in workload updates across clusters.</p>
<p><img src="/website/images/en/docs/concepts/staged-update/updaterun.jpg" alt=""></p>
<h2 id="overview">Overview</h2>
<p>We introduce two new Custom Resources, <code>ClusterStagedUpdateStrategy</code> and <code>ClusterStagedUpdateRun</code>.</p>
<p><code>ClusterStagedUpdateStrategy</code> defines a reusable orchestration pattern that organizes member clusters into distinct stages, controlling both the rollout sequence within each stage and incorporating post-stage validation tasks that must succeed before proceeding to subsequent stages. For brevity, we&rsquo;ll refer to <code>ClusterStagedUpdateStrategy</code> as <em>updateRun strategy</em> throughout this document.</p>
<p><code>ClusterStagedUpdateRun</code> orchestrates resource deployment across clusters by executing a <code>ClusterStagedUpdateStrategy</code>. It requires three key inputs: the target <code>ClusterResourcePlacement</code> name, a resource snapshot index specifying the version to deploy, and the strategy name that defines the rollout rules. The term <em>updateRun</em> will be used to represent <code>ClusterStagedUpdateRun</code> in this document.</p>
<h2 id="specify-rollout-strategy-for-clusterresourceplacement">Specify Rollout Strategy for ClusterResourcePlacement</h2>
<p>While <code>ClusterResourcePlacement</code> uses <code>RollingUpdate</code> as its default strategy, switching to staged updates requires setting the rollout strategy to <code>External</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacement</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">example-placement</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">group</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Namespace</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test-namespace</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">placementType</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">PickAll</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">tolerations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">gpu-workload</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">operator</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Exists</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">strategy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">External</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># specify External here to use the stagedUpdateRun strategy.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h2 id="deploy-a-clusterstagedupdatestrategy">Deploy a ClusterStagedUpdateStrategy</h2>
<p>The <code>ClusterStagedUpdateStrategy</code> custom resource enables users to organize member clusters into stages and define their rollout sequence. This strategy is reusable across multiple updateRuns, with each updateRun creating an immutable snapshot of the strategy at startup. This ensures that modifications to the strategy do not impact any in-progress updateRun executions.</p>
<p>An example <code>ClusterStagedUpdateStrategy</code> looks like below:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterStagedUpdateStrategy</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">example-strategy</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">stages</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">staging</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">labelSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">environment</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">staging</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">afterStageTasks</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">TimedWait</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">waitTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">1h</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">canary</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">labelSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">environment</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">canary</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">afterStageTasks</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Approval</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">production</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">labelSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">environment</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">production</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">sortingLabelKey</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">order</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">afterStageTasks</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Approval</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">TimedWait</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">waitTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">1h</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p><code>ClusterStagedUpdateStrategy</code> is cluster-scoped resource. Its spec contains a list of <code>stageConfig</code> entries defining the configuration for each stage.
Stages execute sequentially in the order specified. Each stage must have a unique name and uses a labelSelector to identify member clusters for update. In above example, we define 3 stages: <code>staging</code> selecting member clusters labeled with <code>environment: staging</code>, <code>canary</code> selecting member clusters labeled with <code>environment: canary</code> and <code>production</code> selecting member clusters labeled with <code>environment: production</code>.</p>
<p>Each stage can optionally specify <code>sortingLabelKey</code> and <code>afterStageTasks</code>. <code>sortingLabelKey</code> is used to define a label whose integer value determines update sequence within a stage. With above example, assuming there are 3 clusters selected in the <code>production</code> (all 3 clusters have <code>environment: production</code> label), then the fleet admin can label them with <code>order: 1</code>, <code>order: 2</code>, and <code>order: 3</code> respectively to control the rollout sequence. Without <code>sortingLabelKey</code>, clusters are updated in alphabetical order by name.</p>
<p>By default, the next stage begins immediately after the current stage completes. A user can control this cross-stage behavior by specifying the <code>afterStageTasks</code> in each stage. These tasks execute after all clusters in a stage update successfully. We currently support two types of tasks: <code>Approval</code> and <code>Timedwait</code>. Each stage can include one task of each type (maximum of two tasks). Both tasks must be satisfied before advancing to the next stage.</p>
<p><code>Timedwait</code> task requires a specified waitTime duration. The updateRun waits for the duration to pass before executing the next stage. For <code>Approval</code> task, the controller generates a <code>ClusterApprovalRequest</code> object automatically named as <code>&lt;updateRun name&gt;-&lt;stage name&gt;</code>. The name is also shown in the updateRun status. The <code>ClusterApprovalRequest</code> object is pretty simple:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterApprovalRequest</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">example-run-canary</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">labels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kubernetes-fleet.io/targetupdaterun</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">example-run</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kubernetes-fleet.io/targetUpdatingStage</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">canary</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kubernetes-fleet.io/isLatestUpdateRunApproval</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;true&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">parentStageRollout</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">example-run</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">targetStage</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">canary</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>The user then need to manually approve the task by patching its status:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl patch clusterapprovalrequests example-run-canary --type<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;merge&#39;</span> -p <span style="color:#4e9a06">&#39;{&#34;status&#34;:{&#34;conditions&#34;:[{&#34;type&#34;:&#34;Approved&#34;,&#34;status&#34;:&#34;True&#34;,&#34;reason&#34;:&#34;lgtm&#34;,&#34;message&#34;:&#34;lgtm&#34;,&#34;lastTransitionTime&#34;:&#34;&#39;</span><span style="color:#204a87;font-weight:bold">$(</span>date -u +%Y-%m-%dT%H:%M:%SZ<span style="color:#204a87;font-weight:bold">)</span><span style="color:#4e9a06">&#39;&#34;,&#34;observedGeneration&#34;:1}]}}&#39;</span> --subresource<span style="color:#ce5c00;font-weight:bold">=</span>status
</span></span></code></pre></div><p>The updateRun will only continue to next stage after the <code>ClusterApprovalRequest</code> is approved.</p>
<h2 id="trigger-rollout-with-clusterstagedupdaterun">Trigger rollout with ClusterStagedUpdateRun</h2>
<p>When using <code>External</code> rollout strategy, a <code>ClusterResourcePlacement</code> begins deployment only when triggered by a <code>ClusterStagedUpdateRun</code>. An example <code>ClusterStagedUpdateRun</code> is shown below:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterStagedUpdateRun</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">example-run</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">placementName</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">example-placement</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceSnapshotIndex</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;0&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">stagedRolloutStrategyName</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">example-strategy</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>This cluster-scoped resource requires three key parameters: the <code>placementName</code> specifying the target <code>ClusterResourcePlacement</code>, the <code>resourceSnapshotIndex</code> identifying which version of resources to deploy (learn how to find resourceSnapshotIndex <a href="../howtos/updaterun.md">here</a>), and the <code>stagedRolloutStrategyName</code> indicating the <code>ClusterStagedUpdateStrategy</code> to follow.</p>
<p>An updateRun executes in two phases. During the initialization phase, the controller performs a one-time setup where it captures a snapshot of the updateRun strategy, collects scheduled and to-be-deleted <code>ClusterResourceBindings</code>, generates the cluster update sequence, and records all this information in the updateRun status.</p>
<p>In the execution phase, the controller processes each stage sequentially, updates clusters within each stage one at a time, and enforces completion of after-stage tasks. It then executes a final delete stage to clean up resources from unscheduled clusters. The updateRun succeeds when all stages complete successfully. However, it will fail if any execution-affecting events occur, for example, the target ClusterResourcePlacement being deleted, and member cluster changes triggering new scheduling. In such cases, error details are recorded in the updateRun status. Remember that once initialized, an updateRun operates on its strategy snapshot, making it immune to subsequent strategy modifications.</p>
<h2 id="understand-clusterstagedupdaterun-status">Understand ClusterStagedUpdateRun status</h2>
<p>Let&rsquo;s take a deep look into the status of a completed <code>ClusterStagedUpdateRun</code>. It displays details about the rollout status for every clusters and stages.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ kubectl describe crsur run example-run
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>Status:
</span></span><span style="display:flex;"><span>  Conditions:
</span></span><span style="display:flex;"><span>    Last Transition Time:  2025-03-12T23:21:39Z
</span></span><span style="display:flex;"><span>    Message:               ClusterStagedUpdateRun initialized successfully
</span></span><span style="display:flex;"><span>    Observed Generation:   <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>    Reason:                UpdateRunInitializedSuccessfully
</span></span><span style="display:flex;"><span>    Status:                True
</span></span><span style="display:flex;"><span>    Type:                  Initialized
</span></span><span style="display:flex;"><span>    Last Transition Time:  2025-03-12T23:21:39Z
</span></span><span style="display:flex;"><span>    Message:               
</span></span><span style="display:flex;"><span>    Observed Generation:   <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>    Reason:                UpdateRunStarted
</span></span><span style="display:flex;"><span>    Status:                True
</span></span><span style="display:flex;"><span>    Type:                  Progressing
</span></span><span style="display:flex;"><span>    Last Transition Time:  2025-03-12T23:26:15Z
</span></span><span style="display:flex;"><span>    Message:               
</span></span><span style="display:flex;"><span>    Observed Generation:   <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>    Reason:                UpdateRunSucceeded
</span></span><span style="display:flex;"><span>    Status:                True
</span></span><span style="display:flex;"><span>    Type:                  Succeeded
</span></span><span style="display:flex;"><span>  Deletion Stage Status:
</span></span><span style="display:flex;"><span>    Clusters:
</span></span><span style="display:flex;"><span>    Conditions:
</span></span><span style="display:flex;"><span>      Last Transition Time:       2025-03-12T23:26:15Z
</span></span><span style="display:flex;"><span>      Message:                    
</span></span><span style="display:flex;"><span>      Observed Generation:        <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>      Reason:                     StageUpdatingStarted
</span></span><span style="display:flex;"><span>      Status:                     True
</span></span><span style="display:flex;"><span>      Type:                       Progressing
</span></span><span style="display:flex;"><span>      Last Transition Time:       2025-03-12T23:26:15Z
</span></span><span style="display:flex;"><span>      Message:                    
</span></span><span style="display:flex;"><span>      Observed Generation:        <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>      Reason:                     StageUpdatingSucceeded
</span></span><span style="display:flex;"><span>      Status:                     True
</span></span><span style="display:flex;"><span>      Type:                       Succeeded
</span></span><span style="display:flex;"><span>    End Time:                     2025-03-12T23:26:15Z
</span></span><span style="display:flex;"><span>    Stage Name:                   kubernetes-fleet.io/deleteStage
</span></span><span style="display:flex;"><span>    Start Time:                   2025-03-12T23:26:15Z
</span></span><span style="display:flex;"><span>  Policy Observed Cluster Count:  <span style="color:#0000cf;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>  Policy Snapshot Index Used:     <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>  Staged Update Strategy Snapshot:
</span></span><span style="display:flex;"><span>    Stages:
</span></span><span style="display:flex;"><span>      After Stage Tasks:
</span></span><span style="display:flex;"><span>        Type:       Approval
</span></span><span style="display:flex;"><span>        Wait Time:  0s
</span></span><span style="display:flex;"><span>        Type:       TimedWait
</span></span><span style="display:flex;"><span>        Wait Time:  1m0s
</span></span><span style="display:flex;"><span>      Label Selector:
</span></span><span style="display:flex;"><span>        Match Labels:
</span></span><span style="display:flex;"><span>          Environment:  staging
</span></span><span style="display:flex;"><span>      Name:             staging
</span></span><span style="display:flex;"><span>      After Stage Tasks:
</span></span><span style="display:flex;"><span>        Type:       Approval
</span></span><span style="display:flex;"><span>        Wait Time:  0s
</span></span><span style="display:flex;"><span>      Label Selector:
</span></span><span style="display:flex;"><span>        Match Labels:
</span></span><span style="display:flex;"><span>          Environment:    canary
</span></span><span style="display:flex;"><span>      Name:               canary
</span></span><span style="display:flex;"><span>      Sorting Label Key:  name
</span></span><span style="display:flex;"><span>      After Stage Tasks:
</span></span><span style="display:flex;"><span>        Type:       TimedWait
</span></span><span style="display:flex;"><span>        Wait Time:  1m0s
</span></span><span style="display:flex;"><span>        Type:       Approval
</span></span><span style="display:flex;"><span>        Wait Time:  0s
</span></span><span style="display:flex;"><span>      Label Selector:
</span></span><span style="display:flex;"><span>        Match Labels:
</span></span><span style="display:flex;"><span>          Environment:    production
</span></span><span style="display:flex;"><span>      Name:               production
</span></span><span style="display:flex;"><span>      Sorting Label Key:  order
</span></span><span style="display:flex;"><span>  Stages Status:
</span></span><span style="display:flex;"><span>    After Stage Task Status:
</span></span><span style="display:flex;"><span>      Approval Request Name:  example-run-staging
</span></span><span style="display:flex;"><span>      Conditions:
</span></span><span style="display:flex;"><span>        Last Transition Time:  2025-03-12T23:21:54Z
</span></span><span style="display:flex;"><span>        Message:               
</span></span><span style="display:flex;"><span>        Observed Generation:   <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        Reason:                AfterStageTaskApprovalRequestCreated
</span></span><span style="display:flex;"><span>        Status:                True
</span></span><span style="display:flex;"><span>        Type:                  ApprovalRequestCreated
</span></span><span style="display:flex;"><span>        Last Transition Time:  2025-03-12T23:22:55Z
</span></span><span style="display:flex;"><span>        Message:               
</span></span><span style="display:flex;"><span>        Observed Generation:   <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        Reason:                AfterStageTaskApprovalRequestApproved
</span></span><span style="display:flex;"><span>        Status:                True
</span></span><span style="display:flex;"><span>        Type:                  ApprovalRequestApproved
</span></span><span style="display:flex;"><span>      Type:                    Approval
</span></span><span style="display:flex;"><span>      Conditions:
</span></span><span style="display:flex;"><span>        Last Transition Time:  2025-03-12T23:22:54Z
</span></span><span style="display:flex;"><span>        Message:               
</span></span><span style="display:flex;"><span>        Observed Generation:   <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        Reason:                AfterStageTaskWaitTimeElapsed
</span></span><span style="display:flex;"><span>        Status:                True
</span></span><span style="display:flex;"><span>        Type:                  WaitTimeElapsed
</span></span><span style="display:flex;"><span>      Type:                    TimedWait
</span></span><span style="display:flex;"><span>    Clusters:
</span></span><span style="display:flex;"><span>      Cluster Name:  member1
</span></span><span style="display:flex;"><span>      Conditions:
</span></span><span style="display:flex;"><span>        Last Transition Time:  2025-03-12T23:21:39Z
</span></span><span style="display:flex;"><span>        Message:               
</span></span><span style="display:flex;"><span>        Observed Generation:   <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        Reason:                ClusterUpdatingStarted
</span></span><span style="display:flex;"><span>        Status:                True
</span></span><span style="display:flex;"><span>        Type:                  Started
</span></span><span style="display:flex;"><span>        Last Transition Time:  2025-03-12T23:21:54Z
</span></span><span style="display:flex;"><span>        Message:               
</span></span><span style="display:flex;"><span>        Observed Generation:   <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        Reason:                ClusterUpdatingSucceeded
</span></span><span style="display:flex;"><span>        Status:                True
</span></span><span style="display:flex;"><span>        Type:                  Succeeded
</span></span><span style="display:flex;"><span>    Conditions:
</span></span><span style="display:flex;"><span>      Last Transition Time:  2025-03-12T23:21:54Z
</span></span><span style="display:flex;"><span>      Message:               
</span></span><span style="display:flex;"><span>      Observed Generation:   <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>      Reason:                StageUpdatingWaiting
</span></span><span style="display:flex;"><span>      Status:                False
</span></span><span style="display:flex;"><span>      Type:                  Progressing
</span></span><span style="display:flex;"><span>      Last Transition Time:  2025-03-12T23:22:55Z
</span></span><span style="display:flex;"><span>      Message:               
</span></span><span style="display:flex;"><span>      Observed Generation:   <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>      Reason:                StageUpdatingSucceeded
</span></span><span style="display:flex;"><span>      Status:                True
</span></span><span style="display:flex;"><span>      Type:                  Succeeded
</span></span><span style="display:flex;"><span>    End Time:                2025-03-12T23:22:55Z
</span></span><span style="display:flex;"><span>    Stage Name:              staging
</span></span><span style="display:flex;"><span>    Start Time:              2025-03-12T23:21:39Z
</span></span><span style="display:flex;"><span>    After Stage Task Status:
</span></span><span style="display:flex;"><span>      Approval Request Name:  example-run-canary
</span></span><span style="display:flex;"><span>      Conditions:
</span></span><span style="display:flex;"><span>        Last Transition Time:  2025-03-12T23:23:10Z
</span></span><span style="display:flex;"><span>        Message:               
</span></span><span style="display:flex;"><span>        Observed Generation:   <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        Reason:                AfterStageTaskApprovalRequestCreated
</span></span><span style="display:flex;"><span>        Status:                True
</span></span><span style="display:flex;"><span>        Type:                  ApprovalRequestCreated
</span></span><span style="display:flex;"><span>        Last Transition Time:  2025-03-12T23:25:15Z
</span></span><span style="display:flex;"><span>        Message:               
</span></span><span style="display:flex;"><span>        Observed Generation:   <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        Reason:                AfterStageTaskApprovalRequestApproved
</span></span><span style="display:flex;"><span>        Status:                True
</span></span><span style="display:flex;"><span>        Type:                  ApprovalRequestApproved
</span></span><span style="display:flex;"><span>      Type:                    Approval
</span></span><span style="display:flex;"><span>    Clusters:
</span></span><span style="display:flex;"><span>      Cluster Name:  member2
</span></span><span style="display:flex;"><span>      Conditions:
</span></span><span style="display:flex;"><span>        Last Transition Time:  2025-03-12T23:22:55Z
</span></span><span style="display:flex;"><span>        Message:               
</span></span><span style="display:flex;"><span>        Observed Generation:   <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        Reason:                ClusterUpdatingStarted
</span></span><span style="display:flex;"><span>        Status:                True
</span></span><span style="display:flex;"><span>        Type:                  Started
</span></span><span style="display:flex;"><span>        Last Transition Time:  2025-03-12T23:23:10Z
</span></span><span style="display:flex;"><span>        Message:               
</span></span><span style="display:flex;"><span>        Observed Generation:   <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        Reason:                ClusterUpdatingSucceeded
</span></span><span style="display:flex;"><span>        Status:                True
</span></span><span style="display:flex;"><span>        Type:                  Succeeded
</span></span><span style="display:flex;"><span>    Conditions:
</span></span><span style="display:flex;"><span>      Last Transition Time:  2025-03-12T23:23:10Z
</span></span><span style="display:flex;"><span>      Message:               
</span></span><span style="display:flex;"><span>      Observed Generation:   <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>      Reason:                StageUpdatingWaiting
</span></span><span style="display:flex;"><span>      Status:                False
</span></span><span style="display:flex;"><span>      Type:                  Progressing
</span></span><span style="display:flex;"><span>      Last Transition Time:  2025-03-12T23:25:15Z
</span></span><span style="display:flex;"><span>      Message:               
</span></span><span style="display:flex;"><span>      Observed Generation:   <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>      Reason:                StageUpdatingSucceeded
</span></span><span style="display:flex;"><span>      Status:                True
</span></span><span style="display:flex;"><span>      Type:                  Succeeded
</span></span><span style="display:flex;"><span>    End Time:                2025-03-12T23:25:15Z
</span></span><span style="display:flex;"><span>    Stage Name:              canary
</span></span><span style="display:flex;"><span>    Start Time:              2025-03-12T23:22:55Z
</span></span><span style="display:flex;"><span>    After Stage Task Status:
</span></span><span style="display:flex;"><span>      Conditions:
</span></span><span style="display:flex;"><span>        Last Transition Time:  2025-03-12T23:26:15Z
</span></span><span style="display:flex;"><span>        Message:               
</span></span><span style="display:flex;"><span>        Observed Generation:   <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        Reason:                AfterStageTaskWaitTimeElapsed
</span></span><span style="display:flex;"><span>        Status:                True
</span></span><span style="display:flex;"><span>        Type:                  WaitTimeElapsed
</span></span><span style="display:flex;"><span>      Type:                    TimedWait
</span></span><span style="display:flex;"><span>      Approval Request Name:   example-run-production
</span></span><span style="display:flex;"><span>      Conditions:
</span></span><span style="display:flex;"><span>        Last Transition Time:  2025-03-12T23:25:15Z
</span></span><span style="display:flex;"><span>        Message:               
</span></span><span style="display:flex;"><span>        Observed Generation:   <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        Reason:                AfterStageTaskApprovalRequestCreated
</span></span><span style="display:flex;"><span>        Status:                True
</span></span><span style="display:flex;"><span>        Type:                  ApprovalRequestCreated
</span></span><span style="display:flex;"><span>        Last Transition Time:  2025-03-12T23:25:25Z
</span></span><span style="display:flex;"><span>        Message:               
</span></span><span style="display:flex;"><span>        Observed Generation:   <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        Reason:                AfterStageTaskApprovalRequestApproved
</span></span><span style="display:flex;"><span>        Status:                True
</span></span><span style="display:flex;"><span>        Type:                  ApprovalRequestApproved
</span></span><span style="display:flex;"><span>      Type:                    Approval
</span></span><span style="display:flex;"><span>    Clusters:
</span></span><span style="display:flex;"><span>    Conditions:
</span></span><span style="display:flex;"><span>      Last Transition Time:  2025-03-12T23:25:15Z
</span></span><span style="display:flex;"><span>      Message:               
</span></span><span style="display:flex;"><span>      Observed Generation:   <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>      Reason:                StageUpdatingWaiting
</span></span><span style="display:flex;"><span>      Status:                False
</span></span><span style="display:flex;"><span>      Type:                  Progressing
</span></span><span style="display:flex;"><span>      Last Transition Time:  2025-03-12T23:26:15Z
</span></span><span style="display:flex;"><span>      Message:               
</span></span><span style="display:flex;"><span>      Observed Generation:   <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>      Reason:                StageUpdatingSucceeded
</span></span><span style="display:flex;"><span>      Status:                True
</span></span><span style="display:flex;"><span>      Type:                  Succeeded
</span></span><span style="display:flex;"><span>    End Time:                2025-03-12T23:26:15Z
</span></span><span style="display:flex;"><span>    Stage Name:              production
</span></span><span style="display:flex;"><span>Events:                      &lt;none&gt;
</span></span></code></pre></div><h3 id="updaterun-overall-status">UpdateRun overall status</h3>
<p>At the very top, <code>Status.Conditions</code> gives the overall status of the updateRun. The execution an update run consists of two phases: initialization and execution.
During initialization, the controller performs a one-time setup where it captures a snapshot of the updateRun strategy, collects scheduled and to-be-deleted <code>ClusterResourceBindings</code>,
generates the cluster update sequence, and records all this information in the updateRun status.
The <code>UpdateRunInitializedSuccessfully</code> condition indicates the initialization is successful.</p>
<p>After initialization, the controller starts executing the updateRun. The <code>UpdateRunStarted</code> condition indicates the execution has started.</p>
<p>After all clusters are updated, all after-stage tasks are completed, and thus all stages are finished, the <code>UpdateRunSucceeded</code> condition is set to <code>True</code>, indicating the updateRun has succeeded.</p>
<h3 id="fields-recorded-in-the-updaterun-status-during-initialization">Fields recorded in the updateRun status during initialization</h3>
<p>During initialization, the controller records the following fields in the updateRun status:</p>
<ul>
<li><code>PolicySnapshotIndexUsed</code>: the index of the policy snapshot used for the updateRun, it should be the latest one.</li>
<li><code>PolicyObservedClusterCount</code>: the number of clusters selected by the scheduling policy.</li>
<li><code>StagedUpdateStrategySnapshot</code>: the snapshot of the updateRun strategy, which ensures any strategy changes will not affect executing updateRuns.</li>
</ul>
<h3 id="stages-and-clusters-status">Stages and clusters status</h3>
<p>The <code>Stages Status</code> section displays the status of each stage and cluster. As shown in the strategy snapshot, the updateRun has three stages: <code>staging</code>, <code>canary</code>, and <code>production</code>. During initialization, the controller generates the rollout plan, classifies the scheduled clusters
into these three stages and dumps the plan into the updateRun status. As the execution progresses, the controller updates the status of each stage and cluster. Take the <code>staging</code> stage as an example, <code>member1</code> is included in this stage. <code>ClusterUpdatingStarted</code> condition indicates the cluster is being updated and <code>ClusterUpdatingSucceeded</code> condition shows the cluster is updated successfully.</p>
<p>After all clusters are updated in a stage, the controller executes the specified after-stage tasks. Stage <code>staging</code> has two after-stage tasks: <code>Approval</code> and <code>TimedWait</code>. The <code>Approval</code> task requires the admin to manually approve a <code>ClusterApprovalRequest</code> generated by the controller. The name of the <code>ClusterApprovalRequest</code> is also included in the status, which is <code>example-run-staging</code>. <code>AfterStageTaskApprovalRequestCreated</code> condition indicates the approval request is created and <code>AfterStageTaskApprovalRequestApproved</code> condition indicates the approval request has been approved. The <code>TimedWait</code> task enforces a suspension of the rollout until the specified wait time has elapsed and in this case, the wait time is 1 minute. <code>AfterStageTaskWaitTimeElapsed</code> condition indicates the wait time has elapsed and the rollout can proceed to the next stage.</p>
<p>Each stage also has its own conditions. When a stage starts, the <code>Progressing</code> condition is set to <code>True</code>. When all the cluster updates complete, the <code>Progressing</code> condition is set to <code>False</code> with reason <code>StageUpdatingWaiting</code> as shown above. It means the stage is waiting for
after-stage tasks to pass.
And thus the <code>lastTransitionTime</code> of the <code>Progressing</code> condition also serves as the start time of the wait in case there&rsquo;s a <code>TimedWait</code> task. When all after-stage tasks pass, the <code>Succeeded</code> condition is set to <code>True</code>. Each stage status also has <code>Start Time</code> and <code>End Time</code> fields, making it easier to read.</p>
<p>There&rsquo;s also a <code>Deletion Stage Status</code> section, which displays the status of the deletion stage. The deletion stage is the last stage of the updateRun. It deletes resources from the unscheduled clusters. The status is pretty much the same as a normal update stage, except that there are no after-stage tasks.</p>
<p>Note that all these conditions have <code>lastTransitionTime</code> set to the time when the controller updates the status. It can help debug and check
the progress of the updateRun.</p>
<h2 id="relationship-between-clusterstagedupdaterun-and-clusterresourceplacement">Relationship between ClusterStagedUpdateRun and ClusterResourcePlacement</h2>
<p>A <code>ClusterStagedUpdateRun</code> serves as the trigger mechanism for rolling out a <code>ClusterResourcePlacement</code>. The key points of this relationship are:</p>
<ul>
<li>The <code>ClusterResourcePlacement</code> remains in a scheduled state without being deployed until a corresponding <code>ClusterStagedUpdateRun</code> is created.</li>
<li>During rollout, the <code>ClusterResourcePlacement</code> status is continuously updated with detailed information from each target cluster.</li>
<li>While a <code>ClusterStagedUpdateRun</code> only indicates whether updates have started and completed for each member cluster (as described in <a href="/website/docs/concepts/staged-update/#understand-clusterstagedupdaterun-status">previous section</a>), the <code>ClusterResourcePlacement</code> provides comprehensive details including:
<ul>
<li>Success/failure of resource creation</li>
<li>Application of overrides</li>
<li>Specific error messages</li>
</ul>
</li>
</ul>
<p>For example, below is the status of an in-progress <code>ClusterStagedUpdateRun</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl describe crsur example-run
</span></span><span style="display:flex;"><span>Name:         example-run
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>Status:
</span></span><span style="display:flex;"><span>  Conditions:
</span></span><span style="display:flex;"><span>    Last Transition Time:  2025-03-17T21:37:14Z
</span></span><span style="display:flex;"><span>    Message:               ClusterStagedUpdateRun initialized successfully
</span></span><span style="display:flex;"><span>    Observed Generation:   <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>    Reason:                UpdateRunInitializedSuccessfully
</span></span><span style="display:flex;"><span>    Status:                True
</span></span><span style="display:flex;"><span>    Type:                  Initialized
</span></span><span style="display:flex;"><span>    Last Transition Time:  2025-03-17T21:37:14Z
</span></span><span style="display:flex;"><span>    Message:               
</span></span><span style="display:flex;"><span>    Observed Generation:   <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>    Reason:                UpdateRunStarted <span style="color:#8f5902;font-style:italic"># updateRun started</span>
</span></span><span style="display:flex;"><span>    Status:                True
</span></span><span style="display:flex;"><span>    Type:                  Progressing
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>  Stages Status:
</span></span><span style="display:flex;"><span>    After Stage Task Status:
</span></span><span style="display:flex;"><span>      Approval Request Name:  example-run-staging
</span></span><span style="display:flex;"><span>      Conditions:
</span></span><span style="display:flex;"><span>        Last Transition Time:  2025-03-17T21:37:29Z
</span></span><span style="display:flex;"><span>        Message:               
</span></span><span style="display:flex;"><span>        Observed Generation:   <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        Reason:                AfterStageTaskApprovalRequestCreated
</span></span><span style="display:flex;"><span>        Status:                True
</span></span><span style="display:flex;"><span>        Type:                  ApprovalRequestCreated
</span></span><span style="display:flex;"><span>      Type:                    Approval
</span></span><span style="display:flex;"><span>      Conditions:
</span></span><span style="display:flex;"><span>        Last Transition Time:  2025-03-17T21:38:29Z
</span></span><span style="display:flex;"><span>        Message:               
</span></span><span style="display:flex;"><span>        Observed Generation:   <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        Reason:                AfterStageTaskWaitTimeElapsed
</span></span><span style="display:flex;"><span>        Status:                True
</span></span><span style="display:flex;"><span>        Type:                  WaitTimeElapsed
</span></span><span style="display:flex;"><span>      Type:                    TimedWait
</span></span><span style="display:flex;"><span>    Clusters:
</span></span><span style="display:flex;"><span>      Cluster Name:  member1
</span></span><span style="display:flex;"><span>      Conditions:
</span></span><span style="display:flex;"><span>        Last Transition Time:  2025-03-17T21:37:14Z
</span></span><span style="display:flex;"><span>        Message:               
</span></span><span style="display:flex;"><span>        Observed Generation:   <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        Reason:                ClusterUpdatingStarted
</span></span><span style="display:flex;"><span>        Status:                True
</span></span><span style="display:flex;"><span>        Type:                  Started
</span></span><span style="display:flex;"><span>        Last Transition Time:  2025-03-17T21:37:29Z
</span></span><span style="display:flex;"><span>        Message:               
</span></span><span style="display:flex;"><span>        Observed Generation:   <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        Reason:                ClusterUpdatingSucceeded <span style="color:#8f5902;font-style:italic"># member1 has updated successfully</span>
</span></span><span style="display:flex;"><span>        Status:                True
</span></span><span style="display:flex;"><span>        Type:                  Succeeded
</span></span><span style="display:flex;"><span>    Conditions:
</span></span><span style="display:flex;"><span>      Last Transition Time:  2025-03-17T21:37:29Z
</span></span><span style="display:flex;"><span>      Message:               
</span></span><span style="display:flex;"><span>      Observed Generation:   <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>      Reason:                StageUpdatingWaiting <span style="color:#8f5902;font-style:italic"># waiting for approval</span>
</span></span><span style="display:flex;"><span>      Status:                False
</span></span><span style="display:flex;"><span>      Type:                  Progressing
</span></span><span style="display:flex;"><span>    Stage Name:              staging
</span></span><span style="display:flex;"><span>    Start Time:              2025-03-17T21:37:14Z
</span></span><span style="display:flex;"><span>    After Stage Task Status:
</span></span><span style="display:flex;"><span>      Approval Request Name:  example-run-canary
</span></span><span style="display:flex;"><span>      Type:                   Approval
</span></span><span style="display:flex;"><span>    Clusters:
</span></span><span style="display:flex;"><span>      Cluster Name:  member2
</span></span><span style="display:flex;"><span>    Stage Name:      canary
</span></span><span style="display:flex;"><span>    After Stage Task Status:
</span></span><span style="display:flex;"><span>      Type:                   TimedWait
</span></span><span style="display:flex;"><span>      Approval Request Name:  example-run-production
</span></span><span style="display:flex;"><span>      Type:                   Approval
</span></span><span style="display:flex;"><span>    Clusters:
</span></span><span style="display:flex;"><span>    Stage Name:  production
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>In above status, member1 from stage <code>staging</code> has been updated successfully. The stage is waiting for approval to proceed to the next stage. And member2 from stage <code>canary</code> is not updated yet.</p>
<p>Let&rsquo;s take a look at the status of the <code>ClusterResourcePlacement</code> <code>example-placement</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl describe crp example-placement
</span></span><span style="display:flex;"><span>Name:         example-placement
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>Status:
</span></span><span style="display:flex;"><span>  Conditions:
</span></span><span style="display:flex;"><span>    Last Transition Time:   2025-03-12T23:01:32Z
</span></span><span style="display:flex;"><span>    Message:                found all cluster needed as specified by the scheduling policy, found <span style="color:#0000cf;font-weight:bold">2</span> cluster<span style="color:#ce5c00;font-weight:bold">(</span>s<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    Observed Generation:    <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>    Reason:                 SchedulingPolicyFulfilled
</span></span><span style="display:flex;"><span>    Status:                 True
</span></span><span style="display:flex;"><span>    Type:                   ClusterResourcePlacementScheduled
</span></span><span style="display:flex;"><span>    Last Transition Time:   2025-03-13T07:35:25Z
</span></span><span style="display:flex;"><span>    Message:                There are still <span style="color:#0000cf;font-weight:bold">1</span> cluster<span style="color:#ce5c00;font-weight:bold">(</span>s<span style="color:#ce5c00;font-weight:bold">)</span> in the process of deciding whether to roll out the latest resources or not
</span></span><span style="display:flex;"><span>    Observed Generation:    <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>    Reason:                 RolloutStartedUnknown
</span></span><span style="display:flex;"><span>    Status:                 Unknown
</span></span><span style="display:flex;"><span>    Type:                   ClusterResourcePlacementRolloutStarted
</span></span><span style="display:flex;"><span>  Observed Resource Index:  <span style="color:#0000cf;font-weight:bold">5</span>
</span></span><span style="display:flex;"><span>  Placement Statuses:
</span></span><span style="display:flex;"><span>    Cluster Name:  member1
</span></span><span style="display:flex;"><span>    Conditions:
</span></span><span style="display:flex;"><span>      Last Transition Time:  2025-03-12T23:01:32Z
</span></span><span style="display:flex;"><span>      Message:               Successfully scheduled resources <span style="color:#204a87;font-weight:bold">for</span> placement in <span style="color:#4e9a06">&#34;member1&#34;</span> <span style="color:#ce5c00;font-weight:bold">(</span>affinity score: 0, topology spread score: 0<span style="color:#ce5c00;font-weight:bold">)</span>: picked by scheduling policy
</span></span><span style="display:flex;"><span>      Observed Generation:   <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>      Reason:                Scheduled
</span></span><span style="display:flex;"><span>      Status:                True
</span></span><span style="display:flex;"><span>      Type:                  Scheduled
</span></span><span style="display:flex;"><span>      Last Transition Time:  2025-03-17T21:37:14Z
</span></span><span style="display:flex;"><span>      Message:               Detected the new changes on the resources and started the rollout process, resourceSnapshotIndex: 5, clusterStagedUpdateRun: example-run
</span></span><span style="display:flex;"><span>      Observed Generation:   <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>      Reason:                RolloutStarted
</span></span><span style="display:flex;"><span>      Status:                True
</span></span><span style="display:flex;"><span>      Type:                  RolloutStarted
</span></span><span style="display:flex;"><span>      Last Transition Time:  2025-03-17T21:37:14Z
</span></span><span style="display:flex;"><span>      Message:               No override rules are configured <span style="color:#204a87;font-weight:bold">for</span> the selected resources
</span></span><span style="display:flex;"><span>      Observed Generation:   <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>      Reason:                NoOverrideSpecified
</span></span><span style="display:flex;"><span>      Status:                True
</span></span><span style="display:flex;"><span>      Type:                  Overridden
</span></span><span style="display:flex;"><span>      Last Transition Time:  2025-03-17T21:37:14Z
</span></span><span style="display:flex;"><span>      Message:               All of the works are synchronized to the latest
</span></span><span style="display:flex;"><span>      Observed Generation:   <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>      Reason:                AllWorkSynced
</span></span><span style="display:flex;"><span>      Status:                True
</span></span><span style="display:flex;"><span>      Type:                  WorkSynchronized
</span></span><span style="display:flex;"><span>      Last Transition Time:  2025-03-17T21:37:14Z
</span></span><span style="display:flex;"><span>      Message:               All corresponding work objects are applied
</span></span><span style="display:flex;"><span>      Observed Generation:   <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>      Reason:                AllWorkHaveBeenApplied
</span></span><span style="display:flex;"><span>      Status:                True
</span></span><span style="display:flex;"><span>      Type:                  Applied
</span></span><span style="display:flex;"><span>      Last Transition Time:  2025-03-17T21:37:14Z
</span></span><span style="display:flex;"><span>      Message:               All corresponding work objects are available
</span></span><span style="display:flex;"><span>      Observed Generation:   <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>      Reason:                AllWorkAreAvailable <span style="color:#8f5902;font-style:italic"># member1 is all good</span>
</span></span><span style="display:flex;"><span>      Status:                True
</span></span><span style="display:flex;"><span>      Type:                  Available
</span></span><span style="display:flex;"><span>    Cluster Name:            member2
</span></span><span style="display:flex;"><span>    Conditions:
</span></span><span style="display:flex;"><span>      Last Transition Time:  2025-03-12T23:01:32Z
</span></span><span style="display:flex;"><span>      Message:               Successfully scheduled resources <span style="color:#204a87;font-weight:bold">for</span> placement in <span style="color:#4e9a06">&#34;member2&#34;</span> <span style="color:#ce5c00;font-weight:bold">(</span>affinity score: 0, topology spread score: 0<span style="color:#ce5c00;font-weight:bold">)</span>: picked by scheduling policy
</span></span><span style="display:flex;"><span>      Observed Generation:   <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>      Reason:                Scheduled
</span></span><span style="display:flex;"><span>      Status:                True
</span></span><span style="display:flex;"><span>      Type:                  Scheduled
</span></span><span style="display:flex;"><span>      Last Transition Time:  2025-03-13T07:35:25Z
</span></span><span style="display:flex;"><span>      Message:               In the process of deciding whether to roll out the latest resources or not
</span></span><span style="display:flex;"><span>      Observed Generation:   <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>      Reason:                RolloutStartedUnknown <span style="color:#8f5902;font-style:italic"># member2 is not updated yet</span>
</span></span><span style="display:flex;"><span>      Status:                Unknown
</span></span><span style="display:flex;"><span>      Type:                  RolloutStarted
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>In the <code>Placement Statuses</code> section, we can see the status of each member cluster. For member1, the <code>RolloutStarted</code> condition is set to <code>True</code>, indicating the rollout has started.
In the condition message, we print the <code>ClusterStagedUpdateRun</code> name, which is <code>example-run</code>. This indicates the most recent cluster update is triggered by <code>example-run</code>.
It also displays the detailed update status: the works are synced and applied and are detected available. As a comparison, member2 is still in <code>Scheduled</code> state only.</p>
<p>When troubleshooting a stalled updateRun, examining the <code>ClusterResourcePlacement</code> status offers valuable diagnostic information that can help identify the root cause.
For comprehensive troubleshooting steps, refer to the <a href="../troubleshooting/updaterun.md">troubleshooting guide</a>.</p>
<h2 id="concurrent-updateruns">Concurrent updateRuns</h2>
<p>Multiple concurrent <code>ClusterStagedUpdateRun</code>s can be created for the same <code>ClusterResourcePlacement</code>, allowing fleet administrators to pipeline the rollout of different resource versions. However, to maintain consistency across the fleet and prevent member clusters from running different resource versions simultaneously, we enforce a key constraint: all concurrent <code>ClusterStagedUpdateRun</code>s must use identical <code>ClusterStagedUpdateStrategy</code> settings.</p>
<p>This strategy consistency requirement is validated during the initialization phase of each updateRun. This validation ensures predictable rollout behavior and prevents configuration drift across your cluster fleet, even when multiple updates are in progress.</p>
<h2 id="next-steps">Next Steps</h2>
<ul>
<li>Learn how to <a href="../howtos/updaterun.md">rollout and rollback CRP resources with Staged Update Run</a></li>
<li>Learn how to <a href="../troubleshooting/updaterun.md">troubleshoot a Staged Update Run</a></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-4289eaa321cf089fdf9ee9aab7a3ade8">1.10 - Eviction and Placement Disruption Budget</h1>
    <div class="lead">Concept about Eviction and Placement Disrupiton Budget</div>
	<p>This document explains the concept of <code>Eviction</code> and <code>Placement Disruption Budget</code> in the context of the fleet.</p>
<h2 id="overview">Overview</h2>
<p><code>Eviction</code> provides a way to force remove resources from a target cluster once the resources have already been propagated from the hub cluster by a <code>Placement</code> object.
<code>Eviction</code> is considered as an voluntary disruption triggered by the user. <code>Eviction</code> alone doesn&rsquo;t guarantee that resources won&rsquo;t be propagated to target cluster again by the scheduler.
The users need to use <a href="../howtos/taint-toleration.md">taints</a> in conjunction with <code>Eviction</code> to prevent the scheduler from picking the target cluster again.</p>
<p>The <code>Placement Disruption Budget</code> object protects against voluntary disruptions.</p>
<p>The only voluntary disruption that can occur in the fleet is the eviction of resources from a target cluster which can be achieved by creating the <code>ClusterResourcePlacementEviction</code> object.</p>
<p>Some cases of involuntary disruptions in the context of fleet,</p>
<ul>
<li>The removal of resources from a member cluster by the scheduler due to scheduling policy changes.</li>
<li>Users manually deleting workload resources running on a member cluster.</li>
<li>Users manually deleting the <code>ClusterResourceBinding</code> object which is an internal resource the represents the placement of resources on a member cluster.</li>
<li>Workloads failing to run properly on a member cluster due to misconfiguration or cluster related issues.</li>
</ul>
<p>For all the cases of involuntary disruptions described above, the <code>Placement Disruption Budget</code> object does not protect against them.</p>
<h2 id="clusterresourceplacementeviction">ClusterResourcePlacementEviction</h2>
<p>An eviction object is used to remove resources from a member cluster once the resources have already been propagated from the hub cluster.</p>
<p>The eviction object is only reconciled once after which it reaches a terminal state. Below is the list of terminal states for <code>ClusterResourcePlacementEviction</code>,</p>
<ul>
<li><code>ClusterResourcePlacementEviction</code> is valid and it&rsquo;s executed successfully.</li>
<li><code>ClusterResourcePlacementEviction</code> is invalid.</li>
<li><code>ClusterResourcePlacementEviction</code> is valid but it&rsquo;s not executed.</li>
</ul>
<p>To successfully evict resources from a cluster, the user needs to specify:</p>
<ul>
<li>The name of the <code>ClusterResourcePlacement</code> object which propagated resources to the target cluster.</li>
<li>The name of the target cluster from which we need to evict resources.</li>
</ul>
<p>When specifying the <code>ClusterResourcePlacement</code> object in the eviction&rsquo;s spec, the user needs to consider the following cases:</p>
<ul>
<li>For <code>PickFixed</code> CRP, eviction is not allowed; it is recommended that one directly edit the list of target clusters on the CRP object.</li>
<li>For <code>PickAll</code> &amp; <code>PickN</code> CRPs, eviction is allowed because the users cannot deterministically pick or unpick a cluster based on the placement strategy; it&rsquo;s up to the scheduler.</li>
</ul>
<blockquote>
<p><strong>Note:</strong> After an eviction is executed, there is no guarantee that the cluster won&rsquo;t be picked again by the scheduler to propagate resources for a <code>ClusterResourcePlacement</code> resource.
The user needs to specify a <a href="../howtos/taint-toleration.md">taint</a> on the cluster to prevent the scheduler from picking the cluster again. This is especially true for <code>PickAll ClusterResourcePlacement</code> because
the scheduler will try to propagate resources to all the clusters in the fleet.</p></blockquote>
<h2 id="clusterresourceplacementdisruptionbudget">ClusterResourcePlacementDisruptionBudget</h2>
<p>The <code>ClusterResourcePlacementDisruptionBudget</code> is used to protect resources propagated by a <code>ClusterResourcePlacement</code> to a target cluster from voluntary disruption, i.e., <code>ClusterResourcePlacementEviction</code>.</p>
<blockquote>
<p><strong>Note:</strong> When specifying a <code>ClusterResourcePlacementDisruptionBudget</code>, the name should be the same as the <code>ClusterResourcePlacement</code> that it&rsquo;s trying to protect.</p></blockquote>
<p>Users are allowed to specify one of two fields in the <code>ClusterResourcePlacementDisruptionBudget</code> spec since they are mutually exclusive:</p>
<ul>
<li>MaxUnavailable - specifies the maximum number of clusters in which a placement can be unavailable due to any form of disruptions.</li>
<li>MinAvailable - specifies the minimum number of clusters in which placements are available despite any form of disruptions.</li>
</ul>
<p>for both <code>MaxUnavailable</code> and <code>MinAvailable</code>, the user can specify the number of clusters as an integer or as a percentage of the total number of clusters in the fleet.</p>
<blockquote>
<p><strong>Note:</strong> For both MaxUnavailable and MinAvailable, involuntary disruptions are not subject to the disruption budget but will still count against it.</p></blockquote>
<p>When specifying a disruption budget for a particular <code>ClusterResourcePlacement</code>, the user needs to consider the following cases:</p>
<table>
  <thead>
      <tr>
          <th>CRP type</th>
          <th><code>MinAvailable</code> DB with an integer</th>
          <th><code>MinAvailable</code> DB with a percentage</th>
          <th><code>MaxUnavailable</code> DB with an integer</th>
          <th><code>MaxUnavailable</code> DB with a percentage</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>PickFixed</code></td>
          <td>❌</td>
          <td>❌</td>
          <td>❌</td>
          <td>❌</td>
      </tr>
      <tr>
          <td><code>PickAll</code></td>
          <td>✅</td>
          <td>❌</td>
          <td>❌</td>
          <td>❌</td>
      </tr>
      <tr>
          <td><code>PickN</code></td>
          <td>✅</td>
          <td>✅</td>
          <td>✅</td>
          <td>✅</td>
      </tr>
  </tbody>
</table>
<blockquote>
<p><strong>Note:</strong> We don&rsquo;t allow eviction for <code>PickFixed</code> CRP and hence specifying a <code>ClusterResourcePlacementDisruptionBudget</code> for <code>PickFixed</code> CRP does nothing.
And for <code>PickAll</code> CRP, the user can only specify <code>MinAvailable</code> because total number of clusters selected by a <code>PickAll</code> CRP is non-deterministic.
If the user creates an invalid <code>ClusterResourcePlacementDisruptionBudget</code> object, when an eviction is created, the eviction won&rsquo;t be successfully executed.</p></blockquote>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-17b09a9dc5200475d8a306f18e63a0f9">2 - Getting Started</h1>
    <div class="lead">Getting started with Fleet</div>
	

<div class="pageinfo pageinfo-primary">
<p>Fleet documentation features a number of getting started tutorials to help you learn
about Fleet with an environment of your preference. Pick one below to proceed.</p>
<p>If you are not sure about which one is the best option, for simplicity reasons, it is
recommended that you start with the
<a href="/website/docs/getting-started/kind/">Getting started with Fleet using KinD clusters</a>.</p>

</div>


</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-b2dc1a1b66163662e5965b95ed325462">2.1 - Getting started with Fleet using KinD clusters</h1>
    <div class="lead">Use KinD clusters to learn about Fleet</div>
	<p>In this tutorial, you will try Fleet out using
<a href="https://kind.sigs.k8s.io/">KinD</a> clusters, which are Kubernetes clusters running on your own
local machine via <a href="https://docker.com">Docker</a> containers. This is the easiest way
to get started with Fleet, which can help you understand how Fleet simiplify the day-to-day multi-cluster management experience with very little setup needed.</p>
<blockquote>
<p>Note</p>
<p>kind is a tool for setting up a Kubernetes environment for experimental purposes;
some instructions below for running Fleet in the kind environment may not apply to other
environments, and there might also be some minor differences in the Fleet
experience.</p></blockquote>
<h2 id="before-you-begin">Before you begin</h2>
<p>To complete this tutorial, you will need:</p>
<ul>
<li>The following tools on your local machine:
<ul>
<li><code>kind</code>, for running Kubernetes clusters on your local machine</li>
<li>Docker</li>
<li><code>git</code></li>
<li><code>curl</code></li>
<li><code>helm</code>, the Kubernetes package manager</li>
<li><code>jq</code></li>
<li><code>base64</code></li>
</ul>
</li>
</ul>
<h2 id="spin-up-a-few-kind-clusters">Spin up a few kind clusters</h2>
<p>The Fleet open-source project manages a multi-cluster environment using a hub-spoke pattern,
which consists of one hub cluster and one or more member clusters:</p>
<ul>
<li>The hub cluster is the portal to which every member cluster connects; it also serves as an
interface for centralized management, through which you can perform a number of tasks,
primarily orchestrating workloads across different clusters.</li>
<li>A member cluster connects to the hub cluster and runs your workloads as orchestrated by the
hub cluster.</li>
</ul>
<p>In this tutorial you will create two kind clusters; one of which serves as the Fleet
hub cluster, and the other the Fleet member cluster. Run the commands below to create them:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Replace YOUR-KIND-IMAGE with a kind node image name of your</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># choice. It should match with the version of kind installed</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># on your system; for more information, see</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># [kind releases](https://github.com/kubernetes-sigs/kind/releases).</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">KIND_IMAGE</span><span style="color:#ce5c00;font-weight:bold">=</span>YOUR-KIND-IMAGE
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Replace YOUR-KUBECONFIG-PATH with the path to a Kubernetes</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># configuration file of your own, typically $HOME/.kube/config.</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">KUBECONFIG_PATH</span><span style="color:#ce5c00;font-weight:bold">=</span>YOUR-KUBECONFIG-PATH
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># The names of the kind clusters; you may use values of your own if you&#39;d like to.</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">HUB_CLUSTER</span><span style="color:#ce5c00;font-weight:bold">=</span>hub
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">MEMBER_CLUSTER</span><span style="color:#ce5c00;font-weight:bold">=</span>member-1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kind create cluster --name <span style="color:#000">$HUB_CLUSTER</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --image<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$KIND_IMAGE</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --kubeconfig<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$KUBECONFIG_PATH</span>
</span></span><span style="display:flex;"><span>kind create cluster --name <span style="color:#000">$MEMBER_CLUSTER</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --image<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$KIND_IMAGE</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --kubeconfig<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$KUBECONFIG_PATH</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Export the configurations for the kind clusters.</span>
</span></span><span style="display:flex;"><span>kind <span style="color:#204a87">export</span> kubeconfig -n <span style="color:#000">$HUB_CLUSTER</span>
</span></span><span style="display:flex;"><span>kind <span style="color:#204a87">export</span> kubeconfig -n <span style="color:#000">$MEMBER_CLUSTER</span>
</span></span></code></pre></div><h1 id="set-up-the-fleet-hub-cluster">Set up the Fleet hub cluster</h1>
<p>To set up the hub cluster, run the commands below:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">HUB_CLUSTER_CONTEXT</span><span style="color:#ce5c00;font-weight:bold">=</span>kind-<span style="color:#000">$HUB_CLUSTER</span>
</span></span><span style="display:flex;"><span>kubectl config use-context <span style="color:#000">$HUB_CLUSTER_CONTEXT</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># The variables below uses the Fleet images kept in the Microsoft Container Registry (MCR),</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># and will retrieve the latest version from the Fleet GitHub repository.</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># You can, however, build the Fleet images of your own; see the repository README for</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># more information.</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">REGISTRY</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;mcr.microsoft.com/aks/fleet&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">FLEET_VERSION</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>curl <span style="color:#4e9a06">&#34;https://api.github.com/repos/Azure/fleet/tags&#34;</span> <span style="color:#000;font-weight:bold">|</span> jq -r <span style="color:#4e9a06">&#39;.[0].name&#39;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">HUB_AGENT_IMAGE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;hub-agent&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Clone the Fleet repository from GitHub.</span>
</span></span><span style="display:flex;"><span>git clone https://github.com/Azure/fleet.git
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Install the helm chart for running Fleet agents on the hub cluster.</span>
</span></span><span style="display:flex;"><span>helm install hub-agent fleet/charts/hub-agent/ <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --set image.pullPolicy<span style="color:#ce5c00;font-weight:bold">=</span>Always <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --set image.repository<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$REGISTRY</span>/<span style="color:#000">$HUB_AGENT_IMAGE</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --set image.tag<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$FLEET_VERSION</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --set <span style="color:#000">logVerbosity</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --set <span style="color:#000">namespace</span><span style="color:#ce5c00;font-weight:bold">=</span>fleet-system <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --set <span style="color:#000">enableWebhook</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --set <span style="color:#000">webhookClientConnectionType</span><span style="color:#ce5c00;font-weight:bold">=</span>service <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --set <span style="color:#000">enableV1Alpha1APIs</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --set <span style="color:#000">enableV1Beta1APIs</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span>
</span></span></code></pre></div><p>It may take a few seconds for the installation to complete. Once it finishes, verify that
the Fleet hub agents are up and running with the commands below:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl get pods -n fleet-system
</span></span></code></pre></div><p>You should see that all the pods are in the ready state.</p>
<h2 id="set-up-the-fleet-member-custer">Set up the Fleet member custer</h2>
<p>Next, you will set up the other kind cluster you created earlier as the Fleet
member cluster, which requires that you install the Fleet member agent on
the cluster and connect it to the Fleet hub cluster.</p>
<p>For your convenience, Fleet provides a script that can automate the process of joining a cluster
into a fleet. To use the script, follow the steps below:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Query the API server address of the hub cluster.</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">HUB_CLUSTER_ADDRESS</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;https://</span><span style="color:#204a87;font-weight:bold">$(</span>docker inspect <span style="color:#000">$HUB_CLUSTER</span>-control-plane --format<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}&#39;</span><span style="color:#204a87;font-weight:bold">)</span><span style="color:#4e9a06">:6443&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">MEMBER_CLUSTER_CONTEXT</span><span style="color:#ce5c00;font-weight:bold">=</span>kind-<span style="color:#000">$MEMBER_CLUSTER</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Run the script.</span>
</span></span><span style="display:flex;"><span>chmod +x fleet/hack/membership/join.sh
</span></span><span style="display:flex;"><span>./fleet/hack/membership/join.sh
</span></span></code></pre></div><p>It may take a few minutes for the script to finish running. Once it is completed, verify
that the cluster has joined successfully with the command below:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl config use-context <span style="color:#000">$HUB_CLUSTER_CONTEXT</span>
</span></span><span style="display:flex;"><span>kubectl get membercluster <span style="color:#000">$MEMBER_CLUSTER</span>
</span></span></code></pre></div><p>The newly joined cluster should have the <code>JOINED</code> status field set to <code>True</code>. If you see that
the cluster is still in an unknown state, it might be that the member cluster
is still connecting to the hub cluster. Should this state persist for a prolonged
period, refer to the <a href="/docs/troubleshooting">Troubleshooting Guide</a> for
more information.</p>
<blockquote>
<p>Note</p>
<p>If you would like to know more about the steps the script runs, or would like to join
a cluster into a fleet manually, refer to the <a href="/website/docs/how-tos/clusters/">Managing Clusters</a> How-To
Guide.</p></blockquote>
<h2 id="use-the-clusterresourceplacement-api-to-orchestrate-resources-among-member-clusters">Use the <code>ClusterResourcePlacement</code> API to orchestrate resources among member clusters.</h2>
<p>Fleet offers an API, <code>ClusterResourcePlacement</code>, which helps orchestrate workloads, i.e., any group
Kubernetes resources, among all member clusters. In this last part of the tutorial, you will use
this API to place some Kubernetes resources automatically into the member clusters via the hub
cluster, saving the trouble of having to create them one by one in each member cluster.</p>
<h3 id="create-the-resources-for-placement">Create the resources for placement</h3>
<p>Run the commands below to create a namespace and a config map, which will be placed onto the
member clusters.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl create namespace work
</span></span><span style="display:flex;"><span>kubectl create configmap app -n work --from-literal<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">data</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">test</span>
</span></span></code></pre></div><p>It may take a few seconds for the commands to complete.</p>
<h3 id="create-the-clusterresourceplacement-api-object">Create the <code>ClusterResourcePlacement</code> API object</h3>
<p>Next, create a <code>ClusterResourcePlacement</code> API object in the hub cluster:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl apply -f - <span style="color:#4e9a06">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">apiVersion: placement.kubernetes-fleet.io/v1beta1
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">kind: ClusterResourcePlacement
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  name: crp
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  resourceSelectors:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    - group: &#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      kind: Namespace
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      version: v1          
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      name: work
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  policy:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    placementType: PickAll
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">EOF</span>
</span></span></code></pre></div><p>Note that the CRP object features a resource selector, which targets the <code>work</code> namespace you
just created. This will instruct the CRP to place the namespace itself, and all resources
registered under the namespace, such as the config map, to the target clusters. Also, in the <code>policy</code>
field, a <code>PickAll</code> placement type has been specified. This allows the CRP to automatically perform
the placement on all member clusters in the fleet, including those that join after the CRP object
is created.</p>
<p>It may take a few seconds for Fleet to successfully place the resources. To check up on the
progress, run the commands below:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl get clusterresourceplacement crp
</span></span></code></pre></div><p>Verify that the placement has been completed successfully; you should see that the <code>APPLIED</code> status
field has been set to <code>True</code>. You may need to repeat the commands a few times to wait for
the completion.</p>
<h3 id="confirm-the-placement">Confirm the placement</h3>
<p>Now, log into the member clusters to confirm that the placement has been completed.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl config use-context <span style="color:#000">$MEMBER_CLUSTER_CONTEXT</span>
</span></span><span style="display:flex;"><span>kubectl get ns
</span></span><span style="display:flex;"><span>kubectl get configmap -n work
</span></span></code></pre></div><p>You should see the namespace <code>work</code> and the config map <code>app</code> listed in the output.</p>
<h2 id="clean-things-up">Clean things up</h2>
<p>To remove all the resources you just created, run the commands below:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># This would also remove the namespace and config map placed in all member clusters.</span>
</span></span><span style="display:flex;"><span>kubectl delete crp crp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kubectl delete ns work
</span></span><span style="display:flex;"><span>kubectl delete configmap app -n work
</span></span></code></pre></div><p>To uninstall Fleet, run the commands below:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl config use-context <span style="color:#000">$HUB_CLUSTER_CONTEXT</span>
</span></span><span style="display:flex;"><span>helm uninstall hub-agent
</span></span><span style="display:flex;"><span>kubectl config use-context <span style="color:#000">$MEMBER_CLUSTER_CONTEXT</span>
</span></span><span style="display:flex;"><span>helm uninstall member-agent
</span></span></code></pre></div><h2 id="whats-next">What&rsquo;s next</h2>
<p>Congratulations! You have completed the getting started tutorial for Fleet. To learn more about
Fleet:</p>
<ul>
<li><a href="/website/docs/concepts/">Read about Fleet concepts</a></li>
<li><a href="/website/docs/how-tos/crp/">Read about the ClusterResourcePlacement API</a></li>
<li><a href="/website/docs/api-reference/">Read the Fleet API reference</a></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-7d7f0216d2307a9e20af121afa63dd3e">2.2 - Getting started with Fleet using on-premises clusters</h1>
    <div class="lead">Use on-premises clusters of your own to learn about Fleet</div>
	<p>In this tutorial, you will try Fleet out using a few of your own Kubernetes clusters; Fleet can
help you manage workloads seamlessly across these clusters, greatly simplifying the experience
of day-to-day Kubernetes management.</p>
<blockquote>
<p>Note</p>
<p>This tutorial assumes that you have some experience of performing administrative tasks for
Kubernetes clusters. If you are just gettings started with Kubernetes, or do not have much
experience of setting up a Kubernetes cluster, it is recommended that you follow the
<a href="/website/docs/getting-started/kind/">Getting started with Fleet using Kind clusters</a> tutorial instead.</p></blockquote>
<h2 id="before-you-begin">Before you begin</h2>
<p>To complete this tutorial, you will need:</p>
<ul>
<li>At least two Kubernetes clusters of your own.
<ul>
<li>Note that one of these clusters will serve as your hub cluster; other clusters must be able
to reach it via the network.</li>
</ul>
</li>
<li>The following tools on your local machine:
<ul>
<li><code>kubectl</code>, the Kubernetes CLI tool.</li>
<li><code>git</code></li>
<li><code>curl</code></li>
<li><code>helm</code>, the Kubernetes package manager</li>
<li><code>jq</code></li>
<li><code>base64</code></li>
</ul>
</li>
</ul>
<h2 id="set-up-a-fleet-hub-cluster">Set up a Fleet hub cluster</h2>
<p>The Fleet open-source project manages a multi-cluster environment using a hub-spoke pattern,
which consists of one hub cluster and one or more member clusters:</p>
<ul>
<li>The hub cluster is the portal to which every member cluster connects; it also serves as an
interface for centralized management, through which you can perform a number of tasks,
primarily orchestrating workloads across different clusters.</li>
<li>A member cluster connects to the hub cluster and runs your workloads as orchestrated by the
hub cluster.</li>
</ul>
<p>Any Kubernetes cluster running a supported version of Kubernetes can serve as the hub cluster;
it is recommended that you reserve a cluster
specifically for this responsibility, and do not run other workloads on it. For the best
experience, consider disabling the built-in <code>kube-controller-manager</code> controllers for the
cluster: you could achieve this by setting the <code>--controllers</code> CLI argument; for more information,
see the <a href="https://kubernetes.io/docs/reference/command-line-tools-reference/kube-controller-manager/"><code>kube-controller-manager</code> documentation</a>.</p>
<p>To set up the hub cluster, run the commands below:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Replace YOUR-HUB-CLUSTER-CONTEXT with the name of the kubeconfig context for your hub cluster.</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">HUB_CLUSTER_CONTEXT</span><span style="color:#ce5c00;font-weight:bold">=</span>YOUR-HUB-CLUSTER-CONTEXT
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kubectl config use-context <span style="color:#000">$HUB_CLUSTER_CONTEXT</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># The variables below uses the Fleet images kept in the Microsoft Container Registry (MCR),</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># and will retrieve the latest version from the Fleet GitHub repository.</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># You can, however, build the Fleet images of your own; see the repository README for</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># more information.</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">REGISTRY</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;mcr.microsoft.com/aks/fleet&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">FLEET_VERSION</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>curl <span style="color:#4e9a06">&#34;https://api.github.com/repos/Azure/fleet/tags&#34;</span> <span style="color:#000;font-weight:bold">|</span> jq -r <span style="color:#4e9a06">&#39;.[0].name&#39;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">HUB_AGENT_IMAGE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;hub-agent&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Clone the Fleet repository from GitHub.</span>
</span></span><span style="display:flex;"><span>git clone https://github.com/Azure/fleet.git
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Install the helm chart for running Fleet agents on the hub cluster.</span>
</span></span><span style="display:flex;"><span>helm install hub-agent fleet/charts/hub-agent/ <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --set image.pullPolicy<span style="color:#ce5c00;font-weight:bold">=</span>Always <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --set image.repository<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$REGISTRY</span>/<span style="color:#000">$HUB_AGENT_IMAGE</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --set image.tag<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$FLEET_VERSION</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --set <span style="color:#000">logVerbosity</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --set <span style="color:#000">namespace</span><span style="color:#ce5c00;font-weight:bold">=</span>fleet-system <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --set <span style="color:#000">enableWebhook</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --set <span style="color:#000">webhookClientConnectionType</span><span style="color:#ce5c00;font-weight:bold">=</span>service <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --set <span style="color:#000">enableV1Alpha1APIs</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --set <span style="color:#000">enableV1Beta1APIs</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span>
</span></span></code></pre></div><p>It may take a few seconds for the installation to complete. Once it finishes, verify that
the Fleet hub agents are up and running with the commands below:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl get pods -n fleet-system
</span></span></code></pre></div><p>You should see that all the pods are in the ready state.</p>
<h2 id="connect-a-member-cluster-to-the-hub-cluster">Connect a member cluster to the hub cluster</h2>
<p>Next, you will set up a cluster as the member cluster for your fleet. This cluster should
run a supported version of Kubernetes and be able to connect to the hub cluster via the network.</p>
<p>For your convenience, Fleet provides a script that can automate the process of joining a cluster
into a fleet. To use the script, follow the steps below:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Replace the value of HUB_CLUSTER_ADDRESS with the address of your hub cluster API server.</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">HUB_CLUSTER_ADDRESS</span><span style="color:#ce5c00;font-weight:bold">=</span>YOUR-HUB-CLUSTER-ADDRESS
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Replace the value of MEMBER_CLUSTER with the name you would like to assign to the new member</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># cluster.</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Note that Fleet will recognize your cluster with this name once it joins.</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">MEMBER_CLUSTER</span><span style="color:#ce5c00;font-weight:bold">=</span>YOUR-MEMBER-CLUSTER
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Replace the value of MEMBER_CLUSTER_CONTEXT with the name of the kubeconfig context you use</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># for accessing your member cluster.</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">MEMBER_CLUSTER_CONTEXT</span><span style="color:#ce5c00;font-weight:bold">=</span>YOUR-MEMBER-CLUSTER-CONTEXT
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Run the script.</span>
</span></span><span style="display:flex;"><span>chmod +x fleet/hack/membership/join.sh
</span></span><span style="display:flex;"><span>./fleet/hack/membership/join.sh
</span></span></code></pre></div><p>It may take a few minutes for the script to finish running. Once it is completed, verify
that the cluster has joined successfully with the command below:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl config use-context <span style="color:#000">$HUB_CLUSTER_CONTEXT</span>
</span></span><span style="display:flex;"><span>kubectl get membercluster <span style="color:#000">$MEMBER_CLUSTER</span>
</span></span></code></pre></div><p>The newly joined cluster should have the <code>JOINED</code> status field set to <code>True</code>. If you see that
the cluster is still in an unknown state, it might be that the member cluster
is still connecting to the hub cluster. Should this state persist for a prolonged
period, refer to the <a href="/docs/troubleshooting">Troubleshooting Guide</a> for
more information.</p>
<blockquote>
<p>Note</p>
<p>If you would like to know more about the steps the script runs, or would like to join
a cluster into a fleet manually, refer to the <a href="/dpcs/howtos/clusters">Managing Clusters</a> How-To
Guide.</p></blockquote>
<p>Repeat the steps above to join more clusters into your fleet.</p>
<h2 id="use-the-clusterresourceplacement-api-to-orchestrate-resources-among-member-clusters">Use the <code>ClusterResourcePlacement</code> API to orchestrate resources among member clusters.</h2>
<p>Fleet offers an API, <code>ClusterResourcePlacement</code>, which helps orchestrate workloads, i.e., any group
Kubernetes resources, among all member clusters. In this last part of the tutorial, you will use
this API to place some Kubernetes resources automatically into the member clusters via the hub
cluster, saving the trouble of having to create them one by one in each member cluster.</p>
<h3 id="create-the-resources-for-placement">Create the resources for placement</h3>
<p>Run the commands below to create a namespace and a config map, which will be placed onto the
member clusters.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl create namespace work
</span></span><span style="display:flex;"><span>kubectl create configmap app -n work --from-literal<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">data</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">test</span>
</span></span></code></pre></div><p>It may take a few seconds for the commands to complete.</p>
<h3 id="create-the-clusterresourceplacement-api-object">Create the <code>ClusterResourcePlacement</code> API object</h3>
<p>Next, create a <code>ClusterResourcePlacement</code> API object in the hub cluster:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl apply -f - <span style="color:#4e9a06">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">apiVersion: placement.kubernetes-fleet.io/v1beta1
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">kind: ClusterResourcePlacement
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  name: crp
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  resourceSelectors:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    - group: &#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      kind: Namespace
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      version: v1          
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      name: work
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  policy:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    placementType: PickAll
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">EOF</span>
</span></span></code></pre></div><p>Note that the CRP object features a resource selector, which targets the <code>work</code> namespace you
just created. This will instruct the CRP to place the namespace itself, and all resources
registered under the namespace, such as the config map, to the target clusters. Also, in the <code>policy</code>
field, a <code>PickAll</code> placement type has been specified. This allows the CRP to automatically perform
the placement on all member clusters in the fleet, including those that join after the CRP object
is created.</p>
<p>It may take a few seconds for Fleet to successfully place the resources. To check up on the
progress, run the commands below:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl get clusterresourceplacement crp
</span></span></code></pre></div><p>Verify that the placement has been completed successfully; you should see that the <code>APPLIED</code> status
field has been set to <code>True</code>. You may need to repeat the commands a few times to wait for
the completion.</p>
<h3 id="confirm-the-placement">Confirm the placement</h3>
<p>Now, log into the member clusters to confirm that the placement has been completed.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl config use-context <span style="color:#000">$MEMBER_CLUSTER_CONTEXT</span>
</span></span><span style="display:flex;"><span>kubectl get ns
</span></span><span style="display:flex;"><span>kubectl get configmap -n work
</span></span></code></pre></div><p>You should see the namespace <code>work</code> and the config map <code>app</code> listed in the output.</p>
<h2 id="clean-things-up">Clean things up</h2>
<p>To remove all the resources you just created, run the commands below:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># This would also remove the namespace and config map placed in all member clusters.</span>
</span></span><span style="display:flex;"><span>kubectl delete crp crp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kubectl delete ns work
</span></span><span style="display:flex;"><span>kubectl delete configmap app -n work
</span></span></code></pre></div><p>To uninstall Fleet, run the commands below:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl config use-context <span style="color:#000">$HUB_CLUSTER_CONTEXT</span>
</span></span><span style="display:flex;"><span>helm uninstall hub-agent
</span></span><span style="display:flex;"><span>kubectl config use-context <span style="color:#000">$MEMBER_CLUSTER_CONTEXT</span>
</span></span><span style="display:flex;"><span>helm uninstall member-agent
</span></span></code></pre></div><h2 id="whats-next">What&rsquo;s next</h2>
<p>Congratulations! You have completed the getting started tutorial for Fleet. To learn more about
Fleet:</p>
<ul>
<li><a href="/website/docs/concepts/">Read about Fleet concepts</a></li>
<li><a href="/website/docs/how-tos/crp/">Read about the ClusterResourcePlacement API</a></li>
<li><a href="/website/docs/api-reference/">Read the Fleet API reference</a></li>
</ul>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-8688845c6027fb5b07b8644ad7348d4a">3 - How-To Guides</h1>
    <div class="lead">Guides for completing common Fleet tasks</div>
	

<div class="pageinfo pageinfo-primary">
<p>Fleet documentation features a number of how-to guides to help you complete
common Fleet tasks. Pick one below to proceed.</p>

</div>


</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-4072dca0095c74b9490cd7c99ea027d9">3.1 - Managing clusters</h1>
    <div class="lead">How to join or remove a cluster from a fleet, and how to view the status of and label a member cluster</div>
	<p>This how-to guide discusses how to manage clusters in a fleet, specifically:</p>
<ul>
<li>how to join a cluster into a fleet; and</li>
<li>how to set a cluster to leave a fleet; and</li>
<li>how to add labels to a member cluster</li>
</ul>
<h2 id="joining-a-cluster-into-a-fleet">Joining a cluster into a fleet</h2>
<p>A cluster can join in a fleet if:</p>
<ul>
<li>it runs a supported Kubernetes version; it is recommended that you use Kubernetes 1.24 or later
versions, and</li>
<li>it has network connectivity to the hub cluster of the fleet.</li>
</ul>
<p>For your convenience, Fleet provides a script that can automate the process of joining a cluster
into a fleet. To use the script, run the commands below:</p>
<blockquote>
<p>Note</p>
<p>To run this script, make sure that you have already installed the following tools in your
system:</p>
<ul>
<li><code>kubectl</code>, the Kubernetes CLI</li>
<li><code>helm</code>, a Kubernetes package manager</li>
<li><code>curl</code></li>
<li><code>jq</code></li>
<li><code>base64</code></li>
</ul></blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Replace the value of HUB_CLUSTER_CONTEXT with the name of the kubeconfig context you use for</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># accessing your hub cluster.</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">HUB_CLUSTER_CONTEXT</span><span style="color:#ce5c00;font-weight:bold">=</span>YOUR-HUB-CLUSTER-CONTEXT
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Replace the value of HUB_CLUSTER_ADDRESS with the address of your hub cluster API server.</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">HUB_CLUSTER_ADDRESS</span><span style="color:#ce5c00;font-weight:bold">=</span>YOUR-HUB-CLUSTER-ADDRESS
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Replace the value of MEMBER_CLUSTER with the name you would like to assign to the new member</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># cluster.</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Note that Fleet will recognize your cluster with this name once it joins.</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">MEMBER_CLUSTER</span><span style="color:#ce5c00;font-weight:bold">=</span>YOUR-MEMBER-CLUSTER
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Replace the value of MEMBER_CLUSTER_CONTEXT with the name of the kubeconfig context you use</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># for accessing your member cluster.</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">MEMBER_CLUSTER_CONTEXT</span><span style="color:#ce5c00;font-weight:bold">=</span>YOUR-MEMBER-CLUSTER-CONTEXT
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Clone the Fleet GitHub repository.</span>
</span></span><span style="display:flex;"><span>git clone https://github.com/Azure/fleet.git
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Run the script.</span>
</span></span><span style="display:flex;"><span>chmod +x fleet/hack/membership/join.sh
</span></span><span style="display:flex;"><span>./fleet/hack/membership/join.sh
</span></span></code></pre></div><p>It may take a few minutes for the script to finish running. Once it is completed, verify
that the cluster has joined successfully with the command below:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl config use-context <span style="color:#000">$HUB_CLUSTER_CONTEXT</span>
</span></span><span style="display:flex;"><span>kubectl get membercluster <span style="color:#000">$MEMBER_CLUSTER</span>
</span></span></code></pre></div><p>If you see that the cluster is still in an unknown state, it might be that the member cluster
is still connecting to the hub cluster. Should this state persist for a prolonged
period, refer to the <a href="/docs/troubleshooting">Troubleshooting Guide</a> for
more information.</p>
<p>Alternatively, if you would like to find out the exact steps the script performs, or if you feel
like fine-tuning some of the steps, you may join a cluster manually to your fleet with the
instructions below:</p>
<details>
<summary>Joining a member cluster manually</summary>
<ol>
<li>
<p>Make sure that you have installed <code>kubectl</code>, <code>helm</code>, <code>curl</code>, <code>jq</code>, and <code>base64</code> in your
system.</p>
</li>
<li>
<p>Create a Kubernetes service account in your hub cluster:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Replace the value of HUB_CLUSTER_CONTEXT with the name of the kubeconfig</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># context you use for accessing your hub cluster.</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">HUB_CLUSTER_CONTEXT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;YOUR-HUB-CLUSTER-CONTEXT&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Replace the value of MEMBER_CLUSTER with a name you would like to assign to the new</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># member cluster.</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Note that the value of MEMBER_CLUSTER will be used as the name the member cluster registers</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># with the hub cluster.</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">MEMBER_CLUSTER</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;YOUR-MEMBER-CLUSTER&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">SERVICE_ACCOUNT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$MEMBER_CLUSTER</span><span style="color:#4e9a06">-hub-cluster-access&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kubectl config use-context <span style="color:#000">$HUB_CLUSTER_CONTEXT</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># The service account can, in theory, be created in any namespace; for simplicity reasons,</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># here you will use the namespace reserved by Fleet installation, `fleet-system`.</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Note that if you choose a different value, commands in some steps below need to be</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># modified accordingly.</span>
</span></span><span style="display:flex;"><span>kubectl create serviceaccount <span style="color:#000">$SERVICE_ACCOUNT</span> -n fleet-system
</span></span></code></pre></div></li>
<li>
<p>Create a Kubernetes secret of the service account token type, which the member cluster will
use to access the hub cluster.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">SERVICE_ACCOUNT_SECRET</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$MEMBER_CLUSTER</span><span style="color:#4e9a06">-hub-cluster-access-token&#34;</span>
</span></span><span style="display:flex;"><span>cat <span style="color:#4e9a06">&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">apiVersion: v1
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">kind: Secret
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    name: $SERVICE_ACCOUNT_SECRET
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    namespace: fleet-system
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    annotations:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        kubernetes.io/service-account.name: $SERVICE_ACCOUNT
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">type: kubernetes.io/service-account-token
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">EOF</span>
</span></span></code></pre></div><p>After the secret is created successfully, extract the token from the secret:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">TOKEN</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>kubectl get secret <span style="color:#000">$SERVICE_ACCOUNT_SECRET</span> -n fleet-system -o <span style="color:#000">jsonpath</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;{.data.token}&#39;</span> <span style="color:#000;font-weight:bold">|</span> base64 -d<span style="color:#204a87;font-weight:bold">)</span>
</span></span></code></pre></div><blockquote>
<p>Note</p>
<p>Keep the token in a secure place; anyone with access to this token can access the hub cluster
in the same way as the Fleet member cluster does.</p></blockquote>
<p>You may have noticed that at this moment, no access control has been set on the service
account; Fleet will set things up when the member cluster joins. The service account will be
given the minimally viable set of permissions for the Fleet member cluster to connect to the
hub cluster; its access will be restricted to one namespace, specifically reserved for the
member cluster, as per security best practices.</p>
</li>
<li>
<p>Register the member cluster with the hub cluster; Fleet manages cluster membership using the
<code>MemberCluster</code> API:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cat <span style="color:#4e9a06">&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">apiVersion: cluster.kubernetes-fleet.io/v1beta1
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">kind: MemberCluster
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    name: $MEMBER_CLUSTER
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    identity:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        name: $SERVICE_ACCOUNT
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        kind: ServiceAccount
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        namespace: fleet-system
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        apiGroup: &#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    heartbeatPeriodSeconds: 60
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">EOF</span>
</span></span></code></pre></div></li>
<li>
<p>Set up the member agent, the Fleet component that works on the member cluster end, to enable
Fleet connection:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Clone the Fleet repository from GitHub.</span>
</span></span><span style="display:flex;"><span>git clone https://github.com/Azure/fleet.git
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Install the member agent helm chart on the member cluster.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Replace the value of MEMBER_CLUSTER_CONTEXT with the name of the kubeconfig context you use</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># for member cluster access.</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">MEMBER_CLUSTER_CONTEXT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;YOUR-MEMBER-CLUSTER-CONTEXT&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Replace the value of HUB_CLUSTER_ADDRESS with the address of the hub cluster API server.</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">HUB_CLUSTER_ADDRESS</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;YOUR-HUB-CLUSTER-ADDRESS&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># The variables below uses the Fleet images kept in the Microsoft Container Registry (MCR),</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># and will retrieve the latest version from the Fleet GitHub repository.</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># You can, however, build the Fleet images of your own; see the repository README for</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># more information.</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">REGISTRY</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;mcr.microsoft.com/aks/fleet&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">FLEET_VERSION</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>curl <span style="color:#4e9a06">&#34;https://api.github.com/repos/Azure/fleet/tags&#34;</span> <span style="color:#000;font-weight:bold">|</span> jq -r <span style="color:#4e9a06">&#39;.[0].name&#39;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">MEMBER_AGENT_IMAGE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;member-agent&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">REFRESH_TOKEN_IMAGE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;refresh-token&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kubectl config use-context <span style="color:#000">$MEMBER_CLUSTER_CONTEXT</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Create the secret with the token extracted previously for member agent to use.</span>
</span></span><span style="display:flex;"><span>kubectl create secret generic hub-kubeconfig-secret --from-literal<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">token</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$TOKEN</span>
</span></span><span style="display:flex;"><span>helm install member-agent fleet/charts/member-agent/ <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --set config.hubURL<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$HUB_CLUSTER_ADDRESS</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --set image.repository<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$REGISTRY</span>/<span style="color:#000">$MEMBER_AGENT_IMAGE</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --set image.tag<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$FLEET_VERSION</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --set refreshtoken.repository<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$REGISTRY</span>/<span style="color:#000">$REFRESH_TOKEN_IMAGE</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --set refreshtoken.tag<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$FLEET_VERSION</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --set image.pullPolicy<span style="color:#ce5c00;font-weight:bold">=</span>Always <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --set refreshtoken.pullPolicy<span style="color:#ce5c00;font-weight:bold">=</span>Always <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --set config.memberClusterName<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$MEMBER_CLUSTER</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --set <span style="color:#000">logVerbosity</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">5</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --set <span style="color:#000">namespace</span><span style="color:#ce5c00;font-weight:bold">=</span>fleet-system <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --set <span style="color:#000">enableV1Alpha1APIs</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --set <span style="color:#000">enableV1Beta1APIs</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span>
</span></span></code></pre></div></li>
<li>
<p>Verify that the installation of the member agent is successful:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl get pods -n fleet-system
</span></span></code></pre></div><p>You should see that all the returned pods are up and running. Note that it may take a few
minutes for the member agent to get ready.</p>
</li>
<li>
<p>Verify that the member cluster has joined the fleet successfully:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl config use-context <span style="color:#000">$HUB_CLUSTER_CONTEXT</span>
</span></span><span style="display:flex;"><span>kubectl get membercluster <span style="color:#000">$MEMBER_CLUSTER</span>
</span></span></code></pre></div></li>
</ol>
</details>
<h2 id="setting-a-cluster-to-leave-a-fleet">Setting a cluster to leave a fleet</h2>
<p>Fleet uses the <code>MemberCluster</code> API to manage cluster memberships. To remove a member cluster
from a fleet, simply delete its corresponding <code>MemberCluster</code> object from your hub cluster:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Replace the value of MEMBER-CLUSTER with the name of the member cluster you would like to</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># remove from a fleet.</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">MEMBER_CLUSTER</span><span style="color:#ce5c00;font-weight:bold">=</span>YOUR-MEMBER-CLUSTER
</span></span><span style="display:flex;"><span>kubectl delete membercluster <span style="color:#000">$MEMBER_CLUSTER</span>
</span></span></code></pre></div><p>It may take a while before the member cluster leaves the fleet successfully. Fleet will perform
some cleanup; all the resources placed onto the cluster will be removed.</p>
<p>After the member cluster leaves, you can remove the member agent installation from it using Helm:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Replace the value of MEMBER_CLUSTER_CONTEXT with the name of the kubeconfig context you use</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># for member cluster access.</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">MEMBER_CLUSTER_CONTEXT</span><span style="color:#ce5c00;font-weight:bold">=</span>YOUR-MEMBER-CLUSTER-CONTEXT
</span></span><span style="display:flex;"><span>kubectl config use-context <span style="color:#000">$MEMBER_CLUSTER_CONTEXT</span>
</span></span><span style="display:flex;"><span>helm uninstall member-agent
</span></span></code></pre></div><p>It may take a few moments before the uninstallation completes.</p>
<h2 id="viewing-the-status-of-a-member-cluster">Viewing the status of a member cluster</h2>
<p>Similarly, you can use the <code>MemberCluster</code> API in the hub cluster to view the status of a
member cluster:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Replace the value of MEMBER-CLUSTER with the name of the member cluster of which you would like</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># to view the status.</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">MEMBER_CLUSTER</span><span style="color:#ce5c00;font-weight:bold">=</span>YOUR-MEMBER-CLUSTER
</span></span><span style="display:flex;"><span>kubectl get membercluster <span style="color:#000">$MEMBER_CLUSTER</span> -o <span style="color:#000">jsonpath</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;{.status}&#34;</span>
</span></span></code></pre></div><p>The status consists of:</p>
<ul>
<li>
<p>an array of conditions, including:</p>
<ul>
<li>the <code>ReadyToJoin</code> condition, which signals whether the hub cluster is ready to accept
the member cluster; and</li>
<li>the <code>Joined</code> condition, which signals whether the cluster has joined the fleet; and</li>
<li>the <code>Healthy</code> condition, which signals whether the cluster is in a healthy state.</li>
</ul>
<p>Typically, a member cluster should have all three conditions set to true. Refer to the
<a href="/docs/troubleshooting">Troubleshooting Guide</a> for help if a cluster fails to join
into a fleet.</p>
</li>
<li>
<p>the resource usage of the cluster; at this moment Fleet reports the capacity and
the allocatable amount of each resource in the cluster, summed up from all nodes in the cluster.</p>
</li>
<li>
<p>an array of agent status, which reports the status of specific Fleet agents installed in
the cluster; each entry features:</p>
<ul>
<li>an array of conditions, in which <code>Joined</code> signals whether the specific agent has been
successfully installed in the cluster, and <code>Healthy</code> signals whether the agent is in a
healthy state; and</li>
<li>the timestamp of the last received heartbeat from the agent.</li>
</ul>
</li>
</ul>
<h2 id="adding-labels-to-a-member-cluster">Adding labels to a member cluster</h2>
<p>You can add labels to a <code>MemberCluster</code> object in the same as with any other Kubernetes object.
These labels can then be used for targeting specific clusters in resource placement. To add a label,
run the command below:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Replace the values of MEMBER_CLUSTER, LABEL_KEY, and LABEL_VALUE with those of your own.</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">MEMBER_CLUSTER</span><span style="color:#ce5c00;font-weight:bold">=</span>YOUR-MEMBER-CLUSTER
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">LABEL_KEY</span><span style="color:#ce5c00;font-weight:bold">=</span>YOUR-LABEL-KEY
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">LABEL_VALUE</span><span style="color:#ce5c00;font-weight:bold">=</span>YOUR-LABEL-VALUE
</span></span><span style="display:flex;"><span>kubectl label membercluster <span style="color:#000">$MEMBER_CLUSTER</span> <span style="color:#000">$LABEL_KEY</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$LABEL_VALUE</span>
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-7461dbc76e53ff75d54dd11074048123">3.2 - Using the ClusterResourcePlacement API</h1>
    <div class="lead">How to use the <code>ClusterResourcePlacement</code> API</div>
	<p>This guide provides an overview of how to use the Fleet <code>ClusterResourcePlacement</code> (CRP) API to orchestrate workload distribution across your fleet.</p>
<h2 id="overview">Overview</h2>
<p>The CRP API is a core Fleet API that facilitates the distribution of specific resources from the hub cluster to
member clusters within a fleet. This API offers scheduling capabilities that allow you to target the most suitable
group of clusters for a set of resources using a complex rule set. For example, you can distribute resources to
clusters in specific regions (North America, East Asia, Europe, etc.) and/or release stages (production, canary, etc.).
You can even distribute resources according to certain topology spread constraints.</p>
<h2 id="api-components">API Components</h2>
<p>The CRP API generally consists of the following components:</p>
<ul>
<li><strong>Resource Selectors</strong>: These specify the set of resources selected for placement.</li>
<li><strong>Scheduling Policy</strong>: This determines the set of clusters where the resources will be placed.</li>
<li><strong>Rollout Strategy</strong>: This controls the behavior of resource placement when the resources themselves and/or the
scheduling policy are updated, minimizing interruptions caused by refreshes.</li>
</ul>
<p>The following sections discuss these components in depth.</p>
<h2 id="resource-selectors">Resource selectors</h2>
<p>A <code>ClusterResourcePlacement</code> object may feature one or more resource selectors,
specifying which resources to select for placement. To add a resource selector, edit
the <code>resourceSelectors</code> field in the <code>ClusterResourcePlacement</code> spec:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacement</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">crp</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">group</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;rbac.authorization.k8s.io&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterRole</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1          </span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">secretReader</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>The example above will pick a <code>ClusterRole</code> named <code>secretReader</code> for resource placement.</p>
<p>It is important to note that, as its name implies, <code>ClusterResourcePlacement</code> <strong>selects only
cluster-scoped resources</strong>. However, if you select a namespace, all the resources under the
namespace will also be placed.</p>
<h3 id="different-types-of-resource-selectors">Different types of resource selectors</h3>
<p>You can specify a resource selector in many different ways:</p>
<ul>
<li>
<p>To select <strong>one specific resource</strong>, such as a namespace, specify its API GVK (group, version, and
kind), and its name, in the resource selector:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># As mentioned earlier, all the resources under the namespace will also be selected.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">group</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Namespace</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1          </span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">work</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></li>
<li>
<p>Alternately, you may also select a set of resources of the same API GVK using a label selector;
it also requires that you specify the API GVK and the filtering label(s):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># As mentioned earlier, all the resources under the namespaces will also be selected.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">group</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Namespace</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1          </span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">labelSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">system</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">critical</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>In the example above, all the namespaces in the hub cluster with the label <code>system=critical</code>
will be selected (along with the resources under them).</p>
<p>Fleet uses standard Kubernetes label selectors; for its specification and usage, see the
<a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.26/#labelselector-v1-meta">Kubernetes API reference</a>.</p>
</li>
<li>
<p>Very occasionally, you may need to select all the resources under a specific GVK; to achieve
this, use a resource selector with only the API GVK added:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">group</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;rbac.authorization.k8s.io&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterRole</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1          </span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>In the example above, all the cluster roles in the hub cluster will be picked.</p>
</li>
</ul>
<h3 id="multiple-resource-selectors">Multiple resource selectors</h3>
<p>You may specify up to 100 different resource selectors; Fleet will pick a resource if it matches
any of the resource selectors specified (i.e., all selectors are OR&rsquo;d).</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># As mentioned earlier, all the resources under the namespace will also be selected.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">group</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Namespace</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1          </span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">work</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">group</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;rbac.authorization.k8s.io&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterRole</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">secretReader      </span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>In the example above, Fleet will pick the namespace <code>work</code> (along with all the resources
under it) and the cluster role <code>secretReader</code>.</p>
<blockquote>
<p>Note</p>
<p>You can find the GVKs of built-in Kubernetes API objects in the
<a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.26/">Kubernetes API reference</a>.</p></blockquote>
<h2 id="scheduling-policy">Scheduling policy</h2>
<p>Each scheduling policy is associated with a placement type, which determines how Fleet will
pick clusters. The <code>ClusterResourcePlacement</code> API supports the following placement types:</p>
<table>
  <thead>
      <tr>
          <th>Placement type</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>PickFixed</code></td>
          <td>Pick a specific set of clusters by their names.</td>
      </tr>
      <tr>
          <td><code>PickAll</code></td>
          <td>Pick all the clusters in the fleet, per some standard.</td>
      </tr>
      <tr>
          <td><code>PickN</code></td>
          <td>Pick a count of N clusters in the fleet, per some standard.</td>
      </tr>
  </tbody>
</table>
<blockquote>
<p>Note</p>
<p>Scheduling policy itself is optional. If you do not specify a scheduling policy,
Fleet will assume that you would like to use
a scheduling of the <code>PickAll</code> placement type; it effectively sets Fleet to pick
all the clusters in the fleet.</p></blockquote>
<p>Fleet does not support switching between different placement types; if you need to do
so, re-create a new <code>ClusterResourcePlacement</code> object.</p>
<h3 id="pickfixed-placement-type"><code>PickFixed</code> placement type</h3>
<p><code>PickFixed</code> is the most straightforward placement type, through which you directly tell Fleet
which clusters to place resources at. To use this placement type, specify the target cluster
names in the <code>clusterNames</code> field, such as</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacement</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">crp</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">placementType</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">PickFixed</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">clusterNames</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> 
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">bravelion</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">smartfish </span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>The example above will place resources to two clusters, <code>bravelion</code> and <code>smartfish</code>.</p>
<h3 id="pickall-placement-type"><code>PickAll</code> placement type</h3>
<p><code>PickAll</code> placement type allows you to pick all clusters in the fleet per some standard. With
this placement type, you may use affinity terms to fine-tune which clusters you would like
for Fleet to pick:</p>
<ul>
<li>
<p>An affinity term specifies a requirement that a cluster needs to meet, usually the presence
of a label.</p>
<p>There are two types of affinity terms:</p>
<ul>
<li><code>requiredDuringSchedulingIgnoredDuringExecution</code> terms are requirements that a cluster
must meet before it can be picked; and</li>
<li><code>preferredDuringSchedulingIgnoredDuringExecution</code> terms are requirements that, if a
cluster meets, will set Fleet to prioritize it in scheduling.</li>
</ul>
<p>In the scheduling policy of the <code>PickAll</code> placement type, you may only use the
<code>requiredDuringSchedulingIgnoredDuringExecution</code> terms.</p>
</li>
</ul>
<blockquote>
<p>Note</p>
<p>You can learn more about affinities in <a href="/website/docs/how-tos/affinities/">Using Affinities to Pick Clusters</a> How-To
Guide.</p></blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacement</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">crp</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">placementType</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">PickAll</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">affinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">clusterAffinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">requiredDuringSchedulingIgnoredDuringExecution</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">clusterSelectorTerms</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                    </span>- <span style="color:#204a87;font-weight:bold">labelSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                        </span><span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                            </span><span style="color:#204a87;font-weight:bold">system</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">critical</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>The <code>ClusterResourcePlacement</code> object above will pick all the clusters with the label
<code>system:critical</code> on them; clusters without the label will be ignored.</p>
<p>Fleet is forward-looking with the <code>PickAll</code> placement type: any cluster that satisfies the
affinity terms of a <code>ClusterResourcePlacement</code> object, even if it joins after the
<code>ClsuterResourcePlacement</code> object is created, will be picked.</p>
<blockquote>
<p>Note</p>
<p>You may specify a scheduling policy of the <code>PickAll</code> placement with no affinity; this will set
Fleet to select all clusters currently present in the fleet.</p></blockquote>
<h3 id="pickn-placement-type"><code>PickN</code> placement type</h3>
<p><code>PickN</code> placement type allows you to pick a specific number of clusters in the fleet for resource
placement; with this placement type, you may use affinity terms and topology spread constraints
to fine-tune which clusters you would like Fleet to pick.</p>
<ul>
<li>
<p>An affinity term specifies a requirement that a cluster needs to meet, usually the presence
of a label.</p>
<p>There are two types of affinity terms:</p>
<ul>
<li><code>requiredDuringSchedulingIgnoredDuringExecution</code> terms are requirements that a cluster
must meet before it can be picked; and</li>
<li><code>preferredDuringSchedulingIgnoredDuringExecution</code> terms are requirements that, if a
cluster meets, will set Fleet to prioritize it in scheduling.</li>
</ul>
</li>
<li>
<p>A topology spread constraint can help you spread resources evenly across different groups
of clusters. For example, you may want to have a database replica deployed in each region
to enable high-availability.</p>
</li>
</ul>
<blockquote>
<p>Note</p>
<p>You can learn more about affinities in <a href="/website/docs/how-tos/affinities/">Using Affinities to Pick Clusters</a>
How-To Guide, and more about topology spread constraints in
<a href="/website/docs/how-tos/topology-spread-constraints/">Using Topology Spread Constraints to Pick Clusters</a> How-To Guide.</p></blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacement</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">crp</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">placementType</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">PickN</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">numberOfClusters</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">affinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">clusterAffinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">preferredDuringSchedulingIgnoredDuringExecution</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                </span>- <span style="color:#204a87;font-weight:bold">weight</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">20</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#204a87;font-weight:bold">preference</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                    </span>- <span style="color:#204a87;font-weight:bold">labelSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                        </span><span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                            </span><span style="color:#204a87;font-weight:bold">critical-level</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>The <code>ClusterResourcePlacement</code> object above will pick first clusters with the <code>critical-level=1</code>
on it; if only there are not enough (less than 3) such clusters, will Fleet pick clusters with no
such label.</p>
<p>To be more precise, with this placement type, Fleet scores clusters on how well it satisfies the
affinity terms and the topology spread constraints; Fleet will assign:</p>
<ul>
<li>an affinity score, for how well the cluster satisfies the affinity terms; and</li>
<li>a topology spread score, for how well the cluster satisfies the topology spread constraints.</li>
</ul>
<blockquote>
<p>Note</p>
<p>For more information on the scoring specifics, see
<a href="/website/docs/how-tos/affinities/">Using Affinities to Pick Clusters</a> How-To Guide (for affinity score) and
<a href="/website/docs/how-tos/topology-spread-constraints/">Using Topology Spread Constraints to Pick Clusters</a> How-To
Guide (for topology spread score).</p></blockquote>
<p>After scoring, Fleet ranks the clusters using the rule below and picks the top N clusters:</p>
<ul>
<li>
<p>the cluster with the highest topology spread score ranks the highest;</p>
</li>
<li>
<p>if there are multiple clusters with the same topology spread score, the one with the highest
affinity score ranks the highest;</p>
</li>
<li>
<p>if there are multiple clusters with same topology spread score and affinity score, sort their
names by alphanumeric order; the one with the most significant name ranks the highest.</p>
<p>This helps establish deterministic scheduling behavior.</p>
</li>
</ul>
<p>Both affinity terms and topology spread constraints are optional. If you do not specify
affinity terms or topology spread constraints, all clusters will be assigned 0 in
affinity score or topology spread score respectively. When neither is added in the scheduling
policy, Fleet will simply rank clusters by their names, and pick N out of them, with
most significant names in alphanumeric order.</p>
<h4 id="when-there-are-not-enough-clusters-to-pick">When there are not enough clusters to pick</h4>
<p>It may happen that Fleet cannot find enough clusters to pick. In this situation, Fleet will
keep looking until all N clusters are found.</p>
<p>Note that Fleet will stop looking once all N clusters are found, even if there appears a
cluster that scores higher.</p>
<h4 id="up-scaling-and-downscaling">Up-scaling and downscaling</h4>
<p>You can edit the <code>numberOfClusters</code> field in the scheduling policy to pick more or less clusters.
When up-scaling, Fleet will score all the clusters that have not been picked earlier, and find
the most appropriate ones; for downscaling, Fleet will unpick the clusters that ranks lower
first.</p>
<blockquote>
<p>Note</p>
<p>For downscaling, the ranking Fleet uses for unpicking clusters is composed when the scheduling
is performed, i.e., it may not reflect the latest setup in the Fleet.</p></blockquote>
<h3 id="a-few-more-points-about-scheduling-policies">A few more points about scheduling policies</h3>
<h4 id="responding-to-changes-in-the-fleet">Responding to changes in the fleet</h4>
<p>Generally speaking, once a cluster is picked by Fleet for a <code>ClusterResourcePlacement</code> object,
it will not be unpicked even if you modify the cluster in a way that renders it unfit for
the scheduling policy, e.g., you have removed a label for the cluster, which is required for
some affinity term. Fleet will also not remove resources from the cluster even if the cluster
becomes unhealthy, e.g., it gets disconnected from the hub cluster. This helps reduce service
interruption.</p>
<p>However, Fleet will unpick a cluster if it leaves the fleet. If you are using a scheduling
policy of the <code>PickN</code> placement type, Fleet will attempt to find a new cluster as replacement.</p>
<h4 id="finding-the-scheduling-decisions-fleet-makes">Finding the scheduling decisions Fleet makes</h4>
<p>You can find out why Fleet picks a cluster in the status of a <code>ClusterResourcePlacement</code> object.
For more information, see the
<a href="crp-status">Understanding the Status of a <code>ClusterResourcePlacement</code></a> How-To Guide.</p>
<h4 id="available-fields-for-each-placement-type">Available fields for each placement type</h4>
<p>The table below summarizes the available scheduling policy fields for each placement type:</p>
<table>
  <thead>
      <tr>
          <th></th>
          <th><code>PickFixed</code></th>
          <th><code>PickAll</code></th>
          <th><code>PickN</code></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>placementType</code></td>
          <td>✅</td>
          <td>✅</td>
          <td>✅</td>
      </tr>
      <tr>
          <td><code>numberOfClusters</code></td>
          <td>❌</td>
          <td>❌</td>
          <td>✅</td>
      </tr>
      <tr>
          <td><code>clusterNames</code></td>
          <td>✅</td>
          <td>❌</td>
          <td>❌</td>
      </tr>
      <tr>
          <td><code>affinity</code></td>
          <td>❌</td>
          <td>✅</td>
          <td>✅</td>
      </tr>
      <tr>
          <td><code>topologySpreadConstraints</code></td>
          <td>❌</td>
          <td>❌</td>
          <td>✅</td>
      </tr>
  </tbody>
</table>
<h2 id="rollout-strategy">Rollout strategy</h2>
<p>After a <code>ClusterResourcePlacement</code> is created, you may want to</p>
<ul>
<li>Add, update, or remove the resources that have been selected by the
<code>ClusterResourcePlacement</code> in the hub cluster</li>
<li>Update the resource selectors in the <code>ClusterResourcePlacement</code></li>
<li>Update the scheduling policy in the <code>ClusterResourcePlacement</code></li>
</ul>
<p>These changes may trigger the following outcomes:</p>
<ul>
<li>New resources may need to be placed on all picked clusters</li>
<li>Resources already placed on a picked cluster may get updated or deleted</li>
<li>Some clusters picked previously are now unpicked, and resources must be removed from such clusters</li>
<li>Some clusters are newly picked, and resources must be added to them</li>
</ul>
<p>Most outcomes can lead to service interruptions. Apps running on member clusters may temporarily become
unavailable as Fleet dispatches updated resources. Clusters that are no longer selected will lose all placed resources,
resulting in lost traffic. If too many new clusters are selected and Fleet places resources on them simultaneously,
your backend may become overloaded. The exact interruption pattern may vary depending on the resources you place using Fleet.</p>
<p>To minimize interruption, Fleet allows users to configure the rollout strategy, similar to native Kubernetes deployment,
to transition between changes as smoothly as possible. Currently, Fleet supports only one rollout strategy: rolling update.
This strategy ensures changes, including the addition or removal of selected clusters and resource refreshes,
are applied incrementally in a phased manner at a pace suitable for you. This is the default option and applies to all changes you initiate.</p>
<p>This rollout strategy can be configured with the following parameters:</p>
<ul>
<li>
<p><code>maxUnavailable</code> determines how many clusters may become unavailable during a change for the selected set of resources.
It can be set as an absolute number or a percentage. The default is 25%, and zero should not be used for this value.</p>
<ul>
<li>
<p>Setting this parameter to a lower value will result in less interruption during a change but will lead to slower rollouts.</p>
</li>
<li>
<p>Fleet considers a cluster as unavailable if resources have not been successfully applied to the cluster.</p>
</li>
<li>
<details><summary>How Fleet interprets this value</summary>
Fleet, in actuality, makes sure that at any time, there are **at least** N - `maxUnavailable`
number of clusters available, where N is:
<ul>
<li>for scheduling policies of the <code>PickN</code> placement type, the <code>numberOfClusters</code> value given;</li>
<li>for scheduling policies of the <code>PickFixed</code> placement type, the number of cluster names given;</li>
<li>for scheduling policies of the <code>PickAll</code> placement type, the number of clusters Fleet picks.</li>
</ul>
<p>If you use a percentage for the <code>maxUnavailable</code> parameter, it is calculated against N as
well.</p>
</details>
</li>
</ul>
</li>
<li>
<p><code>maxSurge</code> determines the number of additional clusters, beyond the required number, that will receive resource placements.
It can also be set as an absolute number or a percentage. The default is 25%, and zero should not be used for this value.</p>
<ul>
<li>
<p>Setting this parameter to a lower value will result in fewer resource placements on additional
clusters by Fleet, which may slow down the rollout process.</p>
</li>
<li>
<details><summary>How Fleet interprets this value</summary>
 Fleet, in actuality, makes sure that at any time, there are **at most** N + `maxSurge`
      number of clusters available, where N is:
<ul>
<li>for scheduling policies of the <code>PickN</code> placement type, the <code>numberOfClusters</code> value given;</li>
<li>for scheduling policies of the <code>PickFixed</code> placement type, the number of cluster names given;</li>
<li>for scheduling policies of the <code>PickAll</code> placement type, the number of clusters Fleet picks.</li>
</ul>
<p>If you use a percentage for the <code>maxUnavailable</code> parameter, it is calculated against N as well.</p>
 </details>
</li>
</ul>
</li>
<li>
<p><code>unavailablePeriodSeconds</code> allows users to inform the fleet when the resources are deemed &ldquo;ready&rdquo;.
The default value is 60 seconds.</p>
<ul>
<li>Fleet only considers newly applied resources on a cluster as &ldquo;ready&rdquo; once <code>unavailablePeriodSeconds</code> seconds
have passed <strong>after</strong> the resources have been <strong>successfully</strong> applied to that cluster.</li>
<li>Setting a lower value for this parameter will result in faster rollouts. However, we <strong>strongly</strong>
recommend that users set it to a value that all the initialization/preparation tasks can be completed within
that time frame. This ensures that the resources are typically ready after the <code>unavailablePeriodSeconds</code> have passed.</li>
<li>We are currently designing a generic &ldquo;ready gate&rdquo; for resources being applied to clusters. Please feel free to raise
issues or provide feedback if you have any thoughts on this.</li>
</ul>
</li>
</ul>
<blockquote>
<p>Note</p>
<p>Fleet will round numbers up if you use a percentage for <code>maxUnavailable</code> and/or <code>maxSurge</code>.</p></blockquote>
<p>For example, if you have a <code>ClusterResourcePlacement</code> with a scheduling policy of the <code>PickN</code>
placement type and a target number of clusters of 10, with the default rollout strategy, as
shown in the example below,</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacement</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">crp</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">strategy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">RollingUpdate</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">rollingUpdate</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">maxUnavailable</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">25</span><span style="color:#000">%</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">maxSurge</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">25</span><span style="color:#000">%</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">unavailablePeriodSeconds</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">60</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Every time you initiate a change on selected resources, Fleet will:</p>
<ul>
<li>Find <code>10 * 25% = 2.5, rounded up to 3</code> clusters, which will receive the resource refresh;</li>
<li>Wait for 60 seconds (<code>unavailablePeriodSeconds</code>), and repeat the process;</li>
<li>Stop when all the clusters have received the latest version of resources.</li>
</ul>
<p>The exact period of time it takes for Fleet to complete a rollout depends not only on the
<code>unavailablePeriodSeconds</code>, but also the actual condition of a resource placement; that is,
if it takes longer for a cluster to get the resources applied successfully, Fleet will wait
longer to complete the rollout, in accordance with the rolling update strategy you specified.</p>
<blockquote>
<p>Note</p>
<p>In very extreme circumstances, rollout may get stuck, if Fleet just cannot apply resources
to some clusters. You can identify this behavior if CRP status; for more information, see
<a href="crp-status">Understanding the Status of a <code>ClusterResourcePlacement</code></a> How-To Guide.</p></blockquote>
<h2 id="snapshots-and-revisions">Snapshots and revisions</h2>
<p>Internally, Fleet keeps a history of all the scheduling policies you have used with a
<code>ClusterResourcePlacement</code>, and all the resource versions (snapshots) the
<code>ClusterResourcePlacement</code> has selected. These are kept as <code>ClusterSchedulingPolicySnapshot</code>
and <code>ClusterResourceSnapshot</code> objects respectively.</p>
<p>You can list and view such objects for reference, but you should not modify their contents
(in a typical setup, such requests will be rejected automatically). To control the length
of the history (i.e., how many snapshot objects Fleet will keep for a <code>ClusterResourcePlacement</code>),
configure the <code>revisionHistoryLimit</code> field:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacement</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">crp</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">strategy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">revisionHistoryLimit</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>The default value is 10.</p>
<blockquote>
<p>Note</p>
<p>In this early stage, the history is kept for reference purposes only; in the future, Fleet
may add features to allow rolling back to a specific scheduling policy and/or resource version.</p></blockquote>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-dae736fee36bb429124e070c298551ea">3.3 - Using Affinity to Pick Clusters</h1>
    <div class="lead">How to use affinity settings in the <code>ClusterResourcePlacement</code> API to fine-tune Fleet scheduling decisions</div>
	<p>This how-to guide discusses how to use affinity settings to fine-tune how Fleet picks clusters
for resource placement.</p>
<p>Affinities terms are featured in the <code>ClusterResourcePlacement</code> API, specifically the scheduling
policy section. Each affinity term is a particular requirement that Fleet will check against clusters;
and the fulfillment of this requirement (or the lack of) would have certain effect on whether
Fleet would pick a cluster for resource placement.</p>
<p>Fleet currently supports two types of affinity terms:</p>
<ul>
<li><code>requiredDuringSchedulingIgnoredDuringExecution</code> affinity terms; and</li>
<li><code>perferredDuringSchedulingIgnoredDuringExecution</code> affinity terms</li>
</ul>
<p>Most affinity terms deal with cluster labels. To manage member clusters, specifically
adding/removing labels from a member cluster, see <a href="/website/docs/how-tos/clusters/">Managing Member Clusters</a> How-To
Guide.</p>
<h2 id="requiredduringschedulingignoredduringexecution-affinity-terms"><code>requiredDuringSchedulingIgnoredDuringExecution</code> affinity terms</h2>
<p>The <code>requiredDuringSchedulingIgnoredDuringExecution</code> type of affinity terms serves as a hard
constraint that <strong>a cluster must satisfy</strong> before it can be picked. Each term may feature:</p>
<ul>
<li>a label selector, which specifies a set of labels that a cluster must have or not have before
it can be picked;</li>
<li>a property selector, which specifies a cluster property requirement that a cluster must satisfy
before it can be picked;</li>
<li>a combination of both.</li>
</ul>
<p>For the specifics about property selectors, see the
<a href="/website/docs/how-tos/property-based-scheduling/">How-To Guide: Using Property-Based Scheduling</a>.</p>
<h3 id="matchlabels"><code>matchLabels</code></h3>
<p>The most straightforward way is to specify <code>matchLabels</code> in the label selector, as showcased below:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacement</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">crp</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">placementType</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">PickAll</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">affinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">clusterAffinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">requiredDuringSchedulingIgnoredDuringExecution</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">clusterSelectorTerms</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                </span>- <span style="color:#204a87;font-weight:bold">labelSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                    </span><span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                        </span><span style="color:#204a87;font-weight:bold">system</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">critical</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>The example above includes a <code>requiredDuringSchedulingIgnoredDuringExecution</code> term which requires
that the label <code>system=critical</code> must be present on a cluster before Fleet can pick it for the
<code>ClusterResourcePlacement</code>.</p>
<p>You can add multiple labels to <code>matchLabels</code>; any cluster that satisfy this affinity term would
have <strong>all</strong> the labels present.</p>
<h3 id="matchexpressions"><code>matchExpressions</code></h3>
<p>For more complex logic, consider using <code>matchExpressions</code>, which allow you to use operators to
set rules for validating labels on a member cluster. Each <code>matchExpressions</code> requirement
includes:</p>
<ul>
<li>
<p>a key, which is the key of the label; and</p>
</li>
<li>
<p>a list of values, which are the possible values for the label key; and</p>
</li>
<li>
<p>an operator, which represents the relationship between the key and the list of values.</p>
<p>Supported operators include:</p>
<ul>
<li><code>In</code>: the cluster must have a label key with one of the listed values.</li>
<li><code>NotIn</code>: the cluster must have a label key that is not associated with any of the listed values.</li>
<li><code>Exists</code>: the cluster must have the label key present; any value is acceptable.</li>
<li><code>NotExists</code>: the cluster must not have the label key.</li>
</ul>
<p>If you plan to use <code>Exists</code> and/or <code>NotExists</code>, you must leave the list of values empty.</p>
</li>
</ul>
<p>Below is an example of <code>matchExpressions</code> affinity term using the <code>In</code> operator:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacement</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">crp</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">placementType</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">PickAll</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">affinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">clusterAffinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">requiredDuringSchedulingIgnoredDuringExecution</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">clusterSelectorTerms</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                </span>- <span style="color:#204a87;font-weight:bold">labelSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                    </span><span style="color:#204a87;font-weight:bold">matchExpressions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                    </span>- <span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">system</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                      </span><span style="color:#204a87;font-weight:bold">operator</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">In</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                      </span><span style="color:#204a87;font-weight:bold">values</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                      </span>- <span style="color:#000">critical</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                      </span>- <span style="color:#000">standard</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Any cluster with the label <code>system=critical</code> or <code>system=standard</code> will be picked by Fleet.</p>
<p>Similarly, you can also specify multiple <code>matchExpressions</code> requirements; any cluster that
satisfy this affinity term would meet all the requirements.</p>
<h3 id="using-both-matchlabels-and-matchexpressions-in-one-affinity-term">Using both <code>matchLabels</code> and <code>matchExpressions</code> in one affinity term</h3>
<p>You can specify both <code>matchLabels</code> and <code>matchExpressions</code> in one <code>requiredDuringSchedulingIgnoredDuringExecution</code> affinity term, as showcased below:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacement</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">crp</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">placementType</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">PickAll</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">affinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">clusterAffinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">requiredDuringSchedulingIgnoredDuringExecution</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">clusterSelectorTerms</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                </span>- <span style="color:#204a87;font-weight:bold">labelSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                    </span><span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                      </span><span style="color:#204a87;font-weight:bold">region</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">east</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                    </span><span style="color:#204a87;font-weight:bold">matchExpressions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                    </span>- <span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">system</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                      </span><span style="color:#204a87;font-weight:bold">operator</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Exists</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>With this affinity term, any cluster picked must:</p>
<ul>
<li>have the label <code>region=east</code> present;</li>
<li>have the label <code>system</code> present, any value would do.</li>
</ul>
<h3 id="using-multiple-affinity-terms">Using multiple affinity terms</h3>
<p>You can also specify multiple <code>requiredDuringSchedulingIgnoredDuringExecution</code> affinity terms,
as showcased below; a cluster will be picked if it can satisfy <strong>any</strong> affinity term.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacement</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">crp</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">placementType</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">PickAll</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">affinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">clusterAffinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">requiredDuringSchedulingIgnoredDuringExecution</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">clusterSelectorTerms</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                </span>- <span style="color:#204a87;font-weight:bold">labelSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                    </span><span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                      </span><span style="color:#204a87;font-weight:bold">region</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">west</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                </span>- <span style="color:#204a87;font-weight:bold">labelSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                    </span><span style="color:#204a87;font-weight:bold">matchExpressions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                    </span>- <span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">system</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                      </span><span style="color:#204a87;font-weight:bold">operator</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">DoesNotExist</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>With these two affinity terms, any cluster picked must:</p>
<ul>
<li>have the label <code>region=west</code> present; <strong>or</strong></li>
<li>does not have the label <code>system</code></li>
</ul>
<h2 id="preferredduringschedulingignoredduringexecution-affinity-terms"><code>preferredDuringSchedulingIgnoredDuringExecution</code> affinity terms</h2>
<p>The <code>preferredDuringSchedulingIgnoredDuringExecution</code> type of affinity terms serves as a soft
constraint for clusters; any cluster that satisfy such terms would receive an affinity score,
which Fleet uses to rank clusters when processing <code>ClusterResourcePlacement</code> with scheduling
policy of the <code>PickN</code> placement type.</p>
<p>Each term features:</p>
<ul>
<li>a weight, between -100 and 100, which is the affinity score that Fleet would assign to a
cluster if it satisfies this term; and</li>
<li>a label selector, or a property sorter.</li>
</ul>
<p>Both are required for this type of affinity terms to function.</p>
<p>The label selector is of the same struct as the one used in
<code>requiredDuringSchedulingIgnoredDuringExecution</code> type of affinity terms; see
<a href="/website/docs/how-tos/affinities/#requiredduringschedulingignoredduringexecution-affinity-terms">the documentation above</a> for usage.</p>
<p>For the specifics about property sorters, see the
<a href="/website/docs/how-tos/property-based-scheduling/">How-To Guide: Using Property-Based Scheduling</a>.</p>
<p>Below is an example with a <code>preferredDuringSchedulingIgnoredDuringExecution</code> affinity term:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacement</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">crp</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">placementType</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">PickN</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">numberOfClusters</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">affinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">clusterAffinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">preferredDuringSchedulingIgnoredDuringExecution</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#204a87;font-weight:bold">weight</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">20</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#204a87;font-weight:bold">preference</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">labelSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#204a87;font-weight:bold">region</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">west</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Any cluster with the <code>region=west</code> label would receive an affinity score of 20.</p>
<h3 id="using-multiple-affinity-terms-1">Using multiple affinity terms</h3>
<p>Similarly, you can use multiple <code>preferredDuringSchedulingIgnoredDuringExection</code> affinity terms,
as showcased below:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacement</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">crp</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">placementType</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">PickN</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">numberOfClusters</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">affinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">clusterAffinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">preferredDuringSchedulingIgnoredDuringExecution</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#204a87;font-weight:bold">weight</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">20</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#204a87;font-weight:bold">preference</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">labelSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                   </span><span style="color:#204a87;font-weight:bold">region</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">west</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#204a87;font-weight:bold">weight</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>-<span style="color:#0000cf;font-weight:bold">20</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#204a87;font-weight:bold">preference</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">labelSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                    </span><span style="color:#204a87;font-weight:bold">environment</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">prod</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Cluster will be validated against each affinity term individually; the affinity scores it
receives will be summed up. For example:</p>
<ul>
<li>if a cluster has only the <code>region=west</code> label, it would receive an affinity score of 20; however</li>
<li>if a cluster has both the <code>region=west</code> and <code>environment=prod</code> labels, it would receive an
affinity score of <code>20 + (-20) = 0</code>.</li>
</ul>
<h2 id="use-both-types-of-affinity-terms">Use both types of affinity terms</h2>
<p>You can, if necessary, add both <code>requiredDuringSchedulingIgnoredDuringExecution</code> and
<code>preferredDuringSchedulingIgnoredDuringExection</code> types of affinity terms. Fleet will
first run all clusters against all the <code>requiredDuringSchedulingIgnoredDuringExecution</code> type
of affinity terms, filter out any that does not meet the requirements, and then
assign the rest with affinity scores per <code>preferredDuringSchedulingIgnoredDuringExection</code> type of
affinity terms.</p>
<p>Below is an example with both types of affinity terms:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacement</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">crp</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">placementType</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">PickN</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">numberOfClusters</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">affinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">clusterAffinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">requiredDuringSchedulingIgnoredDuringExecution</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#204a87;font-weight:bold">clusterSelectorTerms</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                </span>- <span style="color:#204a87;font-weight:bold">labelSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                    </span><span style="color:#204a87;font-weight:bold">matchExpressions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                    </span>- <span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">system</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                      </span><span style="color:#204a87;font-weight:bold">operator</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Exists</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">preferredDuringSchedulingIgnoredDuringExecution</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#204a87;font-weight:bold">weight</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">20</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#204a87;font-weight:bold">preference</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">labelSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                   </span><span style="color:#204a87;font-weight:bold">region</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">west</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>With these affinity terms, only clusters with the label <code>system</code> (any value would do) can be
picked; and among them, those with the <code>region=west</code> will be prioritized for resource placement
as they receive an affinity score of 20.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ccbad31a9eb5ff37ffc3f405928edd58">3.4 - Using Topology Spread Constraints to Spread Resources</h1>
    <div class="lead">How to use topology spread constraints in the <code>ClusterResourcePlacement</code> API to fine-tune Fleet scheduling decisions</div>
	<p>This how-to guide discusses how to use topology spread constraints to fine-tune how Fleet picks
clusters for resource placement.</p>
<p>Topology spread constraints are features in the <code>ClusterResourcePlacement</code> API, specifically
the scheduling policy section. Generally speaking, these constraints can help you spread
resources evenly across different groups of clusters in your fleet; or in other words, it
assures that Fleet will not pick too many clusters from one group, and too little from another.
You can use topology spread constraints to, for example:</p>
<ul>
<li>achieve high-availability for your database backend by making sure that there is at least
one database replica in each region; or</li>
<li>verify if your application can support clusters of different configurations; or</li>
<li>eliminate resource utilization hotspots in your infrastructure through spreading jobs
evenly across sections.</li>
</ul>
<h2 id="specifying-a-topology-spread-constraint">Specifying a topology spread constraint</h2>
<p>A topology spread constraint consists of three fields:</p>
<ul>
<li>
<p><code>topologyKey</code> is a label key which Fleet uses to split your clusters from a fleet into different
groups.</p>
<p>Specifically, clusters are grouped by the label values they have. For example, if you have
three clusters in a fleet:</p>
<ul>
<li>cluster <code>bravelion</code> with the label <code>system=critical</code> and <code>region=east</code>; and</li>
<li>cluster <code>smartfish</code> with the label <code>system=critical</code> and <code>region=west</code>; and</li>
<li>cluster <code>jumpingcat</code> with the label <code>system=normal</code> and <code>region=east</code>,</li>
</ul>
<p>and you use <code>system</code> as the topology key, the clusters will be split into 2 groups:</p>
<ul>
<li>group 1 with cluster <code>bravelion</code> and <code>smartfish</code>, as they both have the value <code>critical</code>
for label <code>system</code>; and</li>
<li>group 2 with cluster <code>jumpingcat</code>, as it has the value <code>normal</code> for label <code>system</code>.</li>
</ul>
<p>Note that the splitting concerns only one label <code>system</code>; other labels,
such as <code>region</code>, do not count.</p>
<p>If a cluster does not have the given topology key, it <strong>does not</strong> belong to any group.
Fleet may still pick this cluster, as placing resources on it does not violate the
associated topology spread constraint.</p>
<p>This is a required field.</p>
</li>
<li>
<p><code>maxSkew</code> specifies how <strong>unevenly</strong> resource placements are spread in your fleet.</p>
<p>The skew of a set of resource placements are defined as the difference in count of
resource placements between the group with the most and the group with
the least, as split by the topology key.</p>
<p>For example, in the fleet described above (3 clusters, 2 groups):</p>
<ul>
<li>if Fleet picks two clusters from group A, but none from group B, the skew would be
<code>2 - 0 = 2</code>; however,</li>
<li>if Fleet picks one cluster from group A and one from group B, the skew would be
<code>1 - 1 = 0</code>.</li>
</ul>
<p>The minimum value of <code>maxSkew</code> is 1. The less you set this value with, the more evenly
resource placements are spread in your fleet.</p>
<p>This is a required field.</p>
<blockquote>
<p>Note</p>
<p>Naturally, <code>maxSkew</code> only makes sense when there are no less than two groups. If you
set a topology key that will not split the Fleet at all (i.e., all clusters with
the given topology key has exactly the same value), the associated topology spread
constraint will take no effect.</p></blockquote>
</li>
<li>
<p><code>whenUnsatisfiable</code> specifies what Fleet would do when it exhausts all options to satisfy the
topology spread constraint; that is, picking any cluster in the fleet would lead to a violation.</p>
<p>Two options are available:</p>
<ul>
<li>
<p><code>DoNotSchedule</code>: with this option, Fleet would guarantee that the topology spread constraint
will be enforced all time; scheduling may fail if there is simply no possible way to satisfy
the topology spread constraint.</p>
</li>
<li>
<p><code>ScheduleAnyway</code>: with this option, Fleet would enforce the topology spread constraint
in a best-effort manner; Fleet may, however, pick clusters that would violate the topology
spread constraint if there is no better option.</p>
</li>
</ul>
<p>This is an optional field; if you do not specify a value, Fleet will use <code>DoNotSchedule</code> by
default.</p>
</li>
</ul>
<p>Below is an example of topology spread constraint, which tells Fleet to pick clusters evenly
from different groups, split based on the value of the label <code>system</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacement</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">crp</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">placementType</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">PickN</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">numberOfClusters</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">topologySpreadConstraints</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">maxSkew</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">topologyKey</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">system</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">whenUnsatisfiable</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">DoNotSchedule</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h2 id="how-fleet-enforces-topology-spread-constraints-topology-spread-scores">How Fleet enforces topology spread constraints: topology spread scores</h2>
<p>When you specify some topology spread constraints in the scheduling policy of
a <code>ClusterResourcePlacement</code> object, Fleet will start picking clusters <strong>one at a time</strong>.
More specifically, Fleet will:</p>
<ul>
<li>
<p>for each cluster in the fleet, evaluate how skew would change if resources were placed on it.</p>
<p>Depending on the current spread of resource placements, there are three possible outcomes:</p>
<ul>
<li>placing resources on the cluster reduces the skew by 1; or</li>
<li>placing resources on the cluster has no effect on the skew; or</li>
<li>placing resources on the cluster increases the skew by 1.</li>
</ul>
<p>Fleet would then assign a topology spread score to the cluster:</p>
<ul>
<li>
<p>if the provisional placement reduces the skew by 1, the cluster receives a topology spread
score of 1; or</p>
</li>
<li>
<p>if the provisional placement has no effect on the skew, the cluster receives a topology
spread score of 0; or</p>
</li>
<li>
<p>if the provisional placement increases the skew by 1, but does not yet exceed the max skew
specified in the constraint, the cluster receives a topology spread score of -1; or</p>
</li>
<li>
<p>if the provisional placement increases the skew by 1, and has exceeded the max skew specified in the constraint,</p>
<ul>
<li>for topology spread constraints with the <code>ScheduleAnyway</code> effect, the cluster receives a topology spread score of -1000; and</li>
<li>for those with the <code>DoNotSchedule</code> effect, the cluster will be removed from
resource placement consideration.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>rank the clusters based on the topology spread score and other factors (e.g., affinity),
pick the one that is most appropriate.</p>
</li>
<li>
<p>repeat the process, until all the needed count of clusters are found.</p>
</li>
</ul>
<p>Below is an example that illustrates the process:</p>
<p>Suppose you have a fleet of 4 clusters:</p>
<ul>
<li>cluster <code>bravelion</code>, with label <code>region=east</code> and <code>system=critical</code>; and</li>
<li>cluster <code>smartfish</code>, with label <code>region=east</code>; and</li>
<li>cluster <code>jumpingcat</code>, with label <code>region=west</code>, and <code>system=critical</code>; and</li>
<li>cluster <code>flyingpenguin</code>, with label <code>region=west</code>,</li>
</ul>
<p>And you have created a <code>ClusterResourcePlacement</code> as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacement</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">crp</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">placementType</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">PickN</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">numberOfClusters</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">topologySpreadConstraints</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">maxSkew</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">topologyKey</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">region</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">whenUnsatisfiable</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">DoNotSchedule</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Fleet will first scan all the 4 clusters in the fleet; they all have the <code>region</code> label, with
two different values <code>east</code> and <code>west</code> (2 cluster in each of them). This divides the clusters
into two groups, the <code>east</code> and the <code>west</code></p>
<p>At this stage, no cluster has been picked yet, so there is no resource placement at all. The
current skew is thus 0, and placing resources on any of them would increase the skew by 1. This
is still below the <code>maxSkew</code> threshold given, so all clusters would receive a topology spread
score of -1.</p>
<p>Fleet could not find the most appropriate cluster based on the topology spread score so far,
so it would resort to other measures for ranking clusters. This would lead Fleet to pick cluster
<code>smartfish</code>.</p>
<blockquote>
<p>Note</p>
<p>See <a href="/website/docs/how-tos/crp/">Using <code>ClusterResourcePlacement</code> to Place Resources</a> How-To Guide for more
information on how Fleet picks clusters.</p></blockquote>
<p>Now, one cluster has been picked, and one more is needed by the <code>ClusterResourcePlacement</code>
object (as the <code>numberOfClusters</code> field is set to 2). Fleet scans the left 3 clusters again,
and this time, since <code>smartfish</code> from group <code>east</code> has been picked, any more resource placement
on clusters from group <code>east</code> would increase the skew by 1 more, and would lead to violation
of the topology spread constraint; Fleet will then assign the topology spread score of -1000 to
cluster <code>bravelion</code>, which is in group <code>east</code>. On the contrary, picking a cluster from any
cluster in group <code>west</code> would reduce the skew by 1, so Fleet assigns the topology spread score
of 1 to cluster <code>jumpingcat</code> and <code>flyingpenguin</code>.</p>
<p>With the higher topology spread score, <code>jumpingcat</code> and <code>flyingpenguin</code> become the leading
candidate in ranking. They have the same topology spread score, and based on the rules Fleet
has for picking clusters, <code>jumpingcat</code> would be picked finally.</p>
<h2 id="using-multiple-topology-spread-constraints">Using multiple topology spread constraints</h2>
<p>You can, if necessary, use multiple topology spread constraints. Fleet will evaluate each of them
separately, and add up topology spread scores for each cluster for the final ranking. A cluster
would be removed from resource placement consideration if placing resources on it would violate
any one of the <code>DoNotSchedule</code> topology spread constraints.</p>
<p>Below is an example where two topology spread constraints are used:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacement</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">crp</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">placementType</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">PickN</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">numberOfClusters</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">topologySpreadConstraints</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">maxSkew</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">topologyKey</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">region</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">whenUnsatisfiable</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">DoNotSchedule</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">maxSkew</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">topologyKey</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">environment</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">whenUnsatisfiable</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ScheduleAnyway</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><blockquote>
<p>Note</p>
<p>It might be very difficult to find candidate clusters when multiple topology spread constraints
are added. Considering using the <code>ScheduleAnyway</code> effect to add some leeway to the scheduling,
if applicable.</p></blockquote>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-8f6885002eeb6f5c362b9414ff970412">3.5 - Using Property-Based Scheduling</h1>
    <div class="lead">How to use property-based scheduling to produce scheduling decisions</div>
	<p>This how-to guide discusses how to use property-based scheduling to produce scheduling decisions
based on cluster properties.</p>
<blockquote>
<p>Note</p>
<p>The availability of properties depend on which (and if) you have a property provider
set up in your Fleet deployment. For more information, see the
<a href="/concepts/properties">Concept: Property Provider and Cluster Properties</a>
documentation.</p>
<p>It is also recommended that you read the
<a href="/website/docs/how-tos/affinities/">How-To Guide: Using Affinity to Pick Clusters</a> first before following
instructions in this document.</p></blockquote>
<p>Fleet allows users to pick clusters based on exposed cluster properties via the affinity
terms in the <code>ClusterResourcePlacement</code> API:</p>
<ul>
<li>for the <code>requiredDuringSchedulingIgnoredDuringExecution</code> affinity terms, you may specify
property selectors to filter clusters based on their properties;</li>
<li>for the <code>preferredDuringSchedulingIgnoredDuringExecution</code> affinity terms, you may specify
property sorters to prefer clusters with a property that ranks higher or lower.</li>
</ul>
<h1 id="property-selectors-in-requiredduringschedulingignoredduringexecution-affinity-terms">Property selectors in <code>requiredDuringSchedulingIgnoredDuringExecution</code> affinity terms</h1>
<p>A property selector is an array of expression matchers against cluster properties.
In each matcher you will specify:</p>
<ul>
<li>
<p>A name, which is the name of the property.</p>
<p>If the property is a non-resource one, you may refer to it directly here; however, if the
property is a resource one, the name here should be of the following format:</p>
<pre tabindex="0"><code>resources.kubernetes-fleet.io/[CAPACITY-TYPE]-[RESOURCE-NAME]
</code></pre><p>where <code>[CAPACITY-TYPE]</code> is one of <code>total</code>, <code>allocatable</code>, or <code>available</code>, depending on
which capacity (usage information) you would like to check against, and <code>[RESOURCE-NAME]</code> is
the name of the resource.</p>
<p>For example, if you would like to select clusters based on the available CPU capacity of
a cluster, the name used in the property selector should be</p>
<pre tabindex="0"><code>resources.kubernetes-fleet.io/available-cpu
</code></pre><p>and for the allocatable memory capacity, use</p>
<pre tabindex="0"><code>resources.kubernetes-fleet.io/allocatable-memory
</code></pre></li>
<li>
<p>A list of values, which are possible values of the property.</p>
</li>
<li>
<p>An operator, which describes the relationship between a cluster&rsquo;s observed value of the given
property and the list of values in the matcher.</p>
<p>Currently, available operators are</p>
<ul>
<li><code>Gt</code> (Greater than): a cluster&rsquo;s observed value of the given property must be greater than
the value in the matcher before it can be picked for resource placement.</li>
<li><code>Ge</code> (Greater than or equal to): a cluster&rsquo;s observed value of the given property must be
greater than or equal to the value in the matcher before it can be picked for resource placement.</li>
<li><code>Lt</code> (Less than): a cluster&rsquo;s observed value of the given property must be less than
the value in the matcher before it can be picked for resource placement.</li>
<li><code>Le</code> (Less than or equal to): a cluster&rsquo;s observed value of the given property must be
less than or equal to the value in the matcher before it can be picked for resource placement.</li>
<li><code>Eq</code> (Equal to): a cluster&rsquo;s observed value of the given property must be equal to
the value in the matcher before it can be picked for resource placement.</li>
<li><code>Ne</code> (Not equal to): a cluster&rsquo;s observed value of the given property must be
not equal to the value in the matcher before it can be picked for resource placement.</li>
</ul>
<p>Note that if you use the operator <code>Gt</code>, <code>Ge</code>, <code>Lt</code>, <code>Le</code>, <code>Eq</code>, or <code>Ne</code>, the list of values
in the matcher should have exactly one value.</p>
</li>
</ul>
<p>Fleet will evaluate each cluster, specifically their exposed properties, against the matchers;
failure to satisfy <strong>any</strong> matcher in the selector will exclude the cluster from resource
placement.</p>
<p>Note that if a cluster does not have the specified property for a matcher, it will automatically
fail the matcher.</p>
<p>Below is an example that uses a property selector to select only clusters with a node count of
at least 5 for resource placement:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacement</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">crp</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">placementType</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">PickAll</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">affinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">clusterAffinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">requiredDuringSchedulingIgnoredDuringExecution</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">clusterSelectorTerms</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                </span>- <span style="color:#204a87;font-weight:bold">propertySelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                    </span><span style="color:#204a87;font-weight:bold">matchExpressions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                    </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;kubernetes-fleet.io/node-count&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                      </span><span style="color:#204a87;font-weight:bold">operator</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Ge</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                      </span><span style="color:#204a87;font-weight:bold">values</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                      </span>- <span style="color:#4e9a06">&#34;5&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>You may use both label selector and property selector in a
<code>requiredDuringSchedulingIgnoredDuringExecution</code> affinity term. Both selectors must be satisfied
before a cluster can be picked for resource placement:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacement</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">crp</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">placementType</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">PickAll</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">affinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">clusterAffinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">requiredDuringSchedulingIgnoredDuringExecution</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">clusterSelectorTerms</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                </span>- <span style="color:#204a87;font-weight:bold">labelSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                    </span><span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                      </span><span style="color:#204a87;font-weight:bold">region</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">east</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#204a87;font-weight:bold">propertySelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                    </span><span style="color:#204a87;font-weight:bold">matchExpressions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                    </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;kubernetes-fleet.io/node-count&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                      </span><span style="color:#204a87;font-weight:bold">operator</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Ge</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                      </span><span style="color:#204a87;font-weight:bold">values</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                      </span>- <span style="color:#4e9a06">&#34;5&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>In the example above, Fleet will only consider a cluster for resource placement if it has the
<code>region=east</code> label and a node count no less than 5.</p>
<h1 id="property-sorters-in-preferredduringschedulingignoredduringexecution-affinity-terms">Property sorters in <code>preferredDuringSchedulingIgnoredDuringExecution</code> affinity terms</h1>
<p>A property sorter ranks all the clusters in the Fleet based on their values of a specified
property in ascending or descending order, then yields weights for the clusters in proportion
to their ranks. The proportional weights are calculated based on the weight value given in the
<code>preferredDuringSchedulingIgnoredDuringExecution</code> term.</p>
<p>A property sorter consists of:</p>
<ul>
<li>
<p>A name, which is the name of the property; see the format in the previous section for more
information.</p>
</li>
<li>
<p>A sort order, which is one of <code>Ascending</code> and <code>Descending</code>, for ranking in ascending and
descending order respectively.</p>
<p>As a rule of thumb, when the <code>Ascending</code> order is used, Fleet will prefer clusters with lower
observed values, and when the <code>Descending</code> order is used, clusters with higher observed values
will be preferred.</p>
</li>
</ul>
<p>When using the sort order <code>Descending</code>, the proportional weight is calculated using the formula:</p>
<pre tabindex="0"><code>((Observed Value - Minimum observed value) / (Maximum observed value - Minimum observed value)) * Weight
</code></pre><p>For example, suppose that you would like to rank clusters based on the property of available CPU
capacity in descending order and currently, you have a fleet of 3 clusters with the available CPU
capacities as follows:</p>
<table>
  <thead>
      <tr>
          <th>Cluster</th>
          <th>Available CPU capacity</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>bravelion</td>
          <td>100</td>
      </tr>
      <tr>
          <td>smartfish</td>
          <td>20</td>
      </tr>
      <tr>
          <td>jumpingcat</td>
          <td>10</td>
      </tr>
  </tbody>
</table>
<p>The sorter would yield the weights below:</p>
<table>
  <thead>
      <tr>
          <th>Cluster</th>
          <th>Available CPU capacity</th>
          <th>Weight</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>bravelion</td>
          <td>100</td>
          <td>(100 - 10) / (100 - 10) = 100% of the weight</td>
      </tr>
      <tr>
          <td>smartfish</td>
          <td>20</td>
          <td>(20 - 10) / (100 - 10) = 11.11% of the weight</td>
      </tr>
      <tr>
          <td>jumpingcat</td>
          <td>10</td>
          <td>(10 - 10) / (100 - 10) = 0% of the weight</td>
      </tr>
  </tbody>
</table>
<p>And when using the sort order <code>Ascending</code>, the proportional weight is calculated using the formula:</p>
<pre tabindex="0"><code>(1 - ((Observed Value - Minimum observed value) / (Maximum observed value - Minimum observed value))) * Weight
</code></pre><p>For example, suppose that you would like to rank clusters based on their per CPU core cost
in ascending order and currently across the fleet, you have a fleet of 3 clusters with the
per CPU core costs as follows:</p>
<table>
  <thead>
      <tr>
          <th>Cluster</th>
          <th>Per CPU core cost</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>bravelion</td>
          <td>1</td>
      </tr>
      <tr>
          <td>smartfish</td>
          <td>0.2</td>
      </tr>
      <tr>
          <td>jumpingcat</td>
          <td>0.1</td>
      </tr>
  </tbody>
</table>
<p>The sorter would yield the weights below:</p>
<table>
  <thead>
      <tr>
          <th>Cluster</th>
          <th>Per CPU core cost</th>
          <th>Weight</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>bravelion</td>
          <td>1</td>
          <td>1 - ((1 - 0.1) / (1 - 0.1)) = 0% of the weight</td>
      </tr>
      <tr>
          <td>smartfish</td>
          <td>0.2</td>
          <td>1 - ((0.2 - 0.1) / (1 - 0.1)) = 88.89% of the weight</td>
      </tr>
      <tr>
          <td>jumpingcat</td>
          <td>0.1</td>
          <td>1 - (0.1 - 0.1) / (1 - 0.1) = 100% of the weight</td>
      </tr>
  </tbody>
</table>
<p>The example below showcases a property sorter using the <code>Descending</code> order:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacement</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">crp</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">placementType</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">PickN</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">numberOfClusters</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">affinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">clusterAffinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">preferredDuringSchedulingIgnoredDuringExecution</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#204a87;font-weight:bold">weight</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">20</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#204a87;font-weight:bold">preference</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">metricSorter</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">kubernetes-fleet.io/node-count</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#204a87;font-weight:bold">sortOrder</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Descending</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>In this example, Fleet will prefer clusters with higher node counts. The cluster with the highest
node count would receive a weight of 20, and the cluster with the lowest would receive 0. Other
clusters receive proportional weights calculated using the formulas above.</p>
<p>You may use both label selector and property sorter in a
<code>preferredDuringSchedulingIgnoredDuringExecution</code> affinity term. A cluster that fails the label
selector would receive no weight, and clusters that pass the label selector receive proportional
weights under the property sorter.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacement</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">crp</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">placementType</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">PickN</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">numberOfClusters</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">affinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">clusterAffinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">preferredDuringSchedulingIgnoredDuringExecution</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#204a87;font-weight:bold">weight</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">20</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#204a87;font-weight:bold">preference</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">labelSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                    </span><span style="color:#204a87;font-weight:bold">env</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">prod</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">metricSorter</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">resources.kubernetes-fleet.io/total-cpu</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#204a87;font-weight:bold">sortOrder</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Descending</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>In the example above, a cluster would only receive additional weight if it has the label
<code>env=prod</code>, and the more total CPU capacity it has, the more weight it will receive, up to the
limit of 20.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-06445baf57d9bbc7fde02bf249b4a0fa">3.6 - Using Taints and Tolerations</h1>
    <div class="lead">How to use taints and tolerations to fine-tune scheduling decisions</div>
	<p>This how-to guide discusses how to add/remove taints on <code>MemberCluster</code> and how to add tolerations on <code>ClusterResourcePlacement</code>.</p>
<h2 id="adding-taint-to-membercluster">Adding taint to MemberCluster</h2>
<p>In this example, we will add a taint to a <code>MemberCluster</code>. Then try to propagate resources to the <code>MemberCluster</code> using a <code>ClusterResourcePlacement</code>
with <strong>PickAll</strong> placement policy. The resources should not be propagated to the <code>MemberCluster</code> because of the taint.</p>
<p>We will first create a namespace that we will propagate to the member cluster,</p>
<pre tabindex="0"><code>kubectl create ns test-ns
</code></pre><p>Then apply the <code>MemberCluster</code> with a taint,</p>
<p>Example <code>MemberCluster</code> with taint:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">cluster.kubernetes-fleet.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">MemberCluster</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">kind-cluster-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">identity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">fleet-member-agent-cluster-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ServiceAccount</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">fleet-system</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">apiGroup</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">taints</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test-key1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">value</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test-value1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">effect</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">NoSchedule</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>After applying the above <code>MemberCluster</code>, we will apply a <code>ClusterResourcePlacement</code> with the following spec:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">group</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Namespace</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1          </span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test-ns</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">placementType</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">PickAll</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>The <code>ClusterResourcePlacement</code> CR should not propagate the <code>test-ns</code> namespace to the member cluster because of the taint,
looking at the status of the CR should show the following:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">conditions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">lastTransitionTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-04-16T19:03:17Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">found all the clusters needed as specified by the scheduling policy</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">observedGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">SchedulingPolicyFulfilled</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;True&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacementScheduled</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">lastTransitionTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-04-16T19:03:17Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">All 0 cluster(s) are synchronized to the latest resources on the hub</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#000">cluster</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">observedGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">SynchronizeSucceeded</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;True&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacementSynchronized</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">lastTransitionTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-04-16T19:03:17Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">There are no clusters selected to place the resources</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">observedGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ApplySucceeded</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;True&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacementApplied</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">observedResourceIndex</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;0&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">selectedResources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Namespace</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test-ns</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Looking at the <code>ClusterResourcePlacementSynchronized</code>, <code>ClusterResourcePlacementApplied</code> conditions and reading the message fields
we can see that no clusters were selected to place the resources.</p>
<h2 id="removing-taint-from-membercluster">Removing taint from MemberCluster</h2>
<p>In this example, we will remove the taint from the <code>MemberCluster</code> from the last section. This should automatically trigger the Fleet scheduler to propagate the resources to the <code>MemberCluster</code>.</p>
<p>After removing the taint from the <code>MemberCluster</code>. Let&rsquo;s take a look at the status of the <code>ClusterResourcePlacement</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">conditions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">lastTransitionTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-04-16T20:00:03Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">found all the clusters needed as specified by the scheduling policy</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">observedGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">SchedulingPolicyFulfilled</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;True&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacementScheduled</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">lastTransitionTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-04-16T20:02:57Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">All 1 cluster(s) are synchronized to the latest resources on the hub</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#000">cluster</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">observedGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">SynchronizeSucceeded</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;True&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacementSynchronized</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">lastTransitionTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-04-16T20:02:57Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Successfully applied resources to 1 member clusters</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">observedGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ApplySucceeded</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;True&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacementApplied</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">observedResourceIndex</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;0&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">placementStatuses</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">clusterName</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">kind-cluster-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">conditions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">lastTransitionTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-04-16T20:02:52Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;Successfully scheduled resources for placement in kind-cluster-1 (affinity
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        score: 0, topology spread score: 0): picked by scheduling policy&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">observedGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ScheduleSucceeded</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;True&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Scheduled</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">lastTransitionTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-04-16T20:02:57Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Successfully Synchronized work(s) for placement</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">observedGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">WorkSynchronizeSucceeded</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;True&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">WorkSynchronized</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">lastTransitionTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-04-16T20:02:57Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Successfully applied resources</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">observedGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ApplySucceeded</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;True&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Applied</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">selectedResources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Namespace</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test-ns</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>From the status we can clearly see that the resources were propagated to the member cluster after removing the taint.</p>
<h2 id="adding-toleration-to-clusterresourceplacement">Adding toleration to ClusterResourcePlacement</h2>
<p>Adding a toleration to a <code>ClusterResourcePlacement</code> CR allows the Fleet scheduler to tolerate specific taints on the <code>MemberClusters</code>.</p>
<p>For this section we will start from scratch, we will first create a namespace that we will propagate to the <code>MemberCluster</code></p>
<pre tabindex="0"><code>kubectl create ns test-ns
</code></pre><p>Then apply the <code>MemberCluster</code> with a taint,</p>
<p>Example <code>MemberCluster</code> with taint:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">heartbeatPeriodSeconds</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">60</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">identity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">apiGroup</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ServiceAccount</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">fleet-member-agent-cluster-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">fleet-system</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">taints</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">effect</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">NoSchedule</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test-key1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">value</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test-value1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>The <code>ClusterResourcePlacement</code> CR will not propagate the <code>test-ns</code> namespace to the member cluster because of the taint.</p>
<p>Now we will add a toleration to a <code>ClusterResourcePlacement</code> CR as part of the placement policy, which will use the Exists operator to tolerate the taint.</p>
<p>Example <code>ClusterResourcePlacement</code> spec with tolerations after adding new toleration:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">placementType</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">PickAll</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">tolerations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test-key1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">operator</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Exists</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">group</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Namespace</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test-ns</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">revisionHistoryLimit</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">strategy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">RollingUpdate</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Let&rsquo;s take a look at the status of the <code>ClusterResourcePlacement</code> CR after adding the toleration:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">conditions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">lastTransitionTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-04-16T20:16:10Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">found all the clusters needed as specified by the scheduling policy</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">observedGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">SchedulingPolicyFulfilled</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;True&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacementScheduled</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">lastTransitionTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-04-16T20:16:15Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">All 1 cluster(s) are synchronized to the latest resources on the hub</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#000">cluster</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">observedGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">SynchronizeSucceeded</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;True&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacementSynchronized</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">lastTransitionTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-04-16T20:16:15Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Successfully applied resources to 1 member clusters</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">observedGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ApplySucceeded</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;True&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacementApplied</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">observedResourceIndex</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;0&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">placementStatuses</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">clusterName</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">kind-cluster-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">conditions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">lastTransitionTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-04-16T20:16:10Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;Successfully scheduled resources for placement in kind-cluster-1 (affinity
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        score: 0, topology spread score: 0): picked by scheduling policy&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">observedGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ScheduleSucceeded</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;True&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Scheduled</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">lastTransitionTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-04-16T20:16:15Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Successfully Synchronized work(s) for placement</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">observedGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">WorkSynchronizeSucceeded</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;True&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">WorkSynchronized</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">lastTransitionTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-04-16T20:16:15Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Successfully applied resources</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">observedGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ApplySucceeded</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;True&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Applied</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">selectedResources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Namespace</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test-ns</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>From the status we can see that the resources were propagated to the <code>MemberCluster</code> after adding the toleration.</p>
<p>Now let&rsquo;s try adding a new taint to the member cluster CR and see if the resources are still propagated to the <code>MemberCluster</code>,</p>
<p>Example <code>MemberCluster</code> CR with new taint:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">heartbeatPeriodSeconds</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">60</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">identity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">apiGroup</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ServiceAccount</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">fleet-member-agent-cluster-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">fleet-system</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">taints</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">effect</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">NoSchedule</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test-key1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">value</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test-value1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">effect</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">NoSchedule</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test-key2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">value</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test-value2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Let&rsquo;s take a look at the <code>ClusterResourcePlacement</code> CR status after adding the new taint:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">conditions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">lastTransitionTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-04-16T20:27:44Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">found all the clusters needed as specified by the scheduling policy</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">observedGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">SchedulingPolicyFulfilled</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;True&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacementScheduled</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">lastTransitionTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-04-16T20:27:49Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">All 1 cluster(s) are synchronized to the latest resources on the hub</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#000">cluster</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">observedGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">SynchronizeSucceeded</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;True&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacementSynchronized</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">lastTransitionTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-04-16T20:27:49Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Successfully applied resources to 1 member clusters</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">observedGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ApplySucceeded</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;True&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacementApplied</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">observedResourceIndex</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;0&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">placementStatuses</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">clusterName</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">kind-cluster-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">conditions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">lastTransitionTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-04-16T20:27:44Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;Successfully scheduled resources for placement in kind-cluster-1 (affinity
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        score: 0, topology spread score: 0): picked by scheduling policy&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">observedGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ScheduleSucceeded</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;True&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Scheduled</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">lastTransitionTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-04-16T20:27:49Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Successfully Synchronized work(s) for placement</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">observedGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">WorkSynchronizeSucceeded</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;True&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">WorkSynchronized</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">lastTransitionTime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2024-04-16T20:27:49Z&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">message</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Successfully applied resources</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">observedGeneration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">reason</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ApplySucceeded</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;True&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Applied</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">selectedResources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Namespace</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test-ns</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Nothing changes in the status because even if the new taint is not tolerated, the exising resources on the <code>MemberCluster</code>
will continue to run because the taint effect is <code>NoSchedule</code> and the cluster was already selected for resource propagation in a
previous scheduling cycle.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f53861fa149aba83d55219c600a493a6">3.7 - Using the ClusterResourceOverride API</h1>
    <div class="lead">How to use the <code>ClusterResourceOverride</code> API to override cluster-scoped resources</div>
	<p>This guide provides an overview of how to use the Fleet <code>ClusterResourceOverride</code> API to override cluster resources.</p>
<h2 id="overview">Overview</h2>
<p><code>ClusterResourceOverride</code> is a feature within Fleet that allows for the modification or override of specific attributes
across cluster-wide resources. With ClusterResourceOverride, you can define rules based on cluster labels or other
criteria, specifying changes to be applied to various cluster-wide resources such as namespaces, roles, role bindings,
or custom resource definitions. These modifications may include updates to permissions, configurations, or other
parameters, ensuring consistent management and enforcement of configurations across your Fleet-managed Kubernetes clusters.</p>
<h2 id="api-components">API Components</h2>
<p>The ClusterResourceOverride API consists of the following components:</p>
<ul>
<li><strong>Cluster Resource Selectors</strong>: These specify the set of cluster resources selected for overriding.</li>
<li><strong>Policy</strong>: This specifies the policy to be applied to the selected resources.</li>
</ul>
<p>The following sections discuss these components in depth.</p>
<h2 id="cluster-resource-selectors">Cluster Resource Selectors</h2>
<p>A <code>ClusterResourceOverride</code> object may feature one or more cluster resource selectors, specifying which resources to select to be overridden.</p>
<p>The <code>ClusterResourceSelector</code> object supports the following fields:</p>
<ul>
<li><code>group</code>: The API group of the resource</li>
<li><code>version</code>: The API version of the resource</li>
<li><code>kind</code>: The kind of the resource</li>
<li><code>name</code>: The name of the resource</li>
</ul>
<blockquote>
<p>Note: The resource can only be selected by name.</p></blockquote>
<p>To add a resource selector, edit the <code>clusterResourceSelectors</code> field in the <code>ClusterResourceOverride</code> spec:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1alpha1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourceOverride</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">example-cro</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">clusterResourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">group</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">rbac.authorization.k8s.io</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterRole</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">secret-reader</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>The example above will pick the <code>ClusterRole</code> named <code>secret-reader</code>, as shown below, to be overridden.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">rbac.authorization.k8s.io/v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterRole</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">secret-reader</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">rules</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">apiGroups</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;secrets&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">verbs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;get&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;watch&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;list&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h2 id="policy">Policy</h2>
<p>The <code>Policy</code> is made up of a set of rules (<code>OverrideRules</code>) that specify the changes to be applied to the selected
resources on selected clusters.</p>
<p>Each <code>OverrideRule</code> supports the following fields:</p>
<ul>
<li><strong>Cluster Selector</strong>: This specifies the set of clusters to which the override applies.</li>
<li><strong>JSON Patch Override</strong>: This specifies the changes to be applied to the selected resources.</li>
</ul>
<p>To add an override rule, edit the <code>policy</code> field in the <code>ClusterResourceOverride</code> spec:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1alpha1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourceOverride</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">example-cro</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">clusterResourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">group</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">rbac.authorization.k8s.io</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterRole</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">secret-reader</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">overrideRules</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">clusterSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">clusterSelectorTerms</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#204a87;font-weight:bold">labelSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#204a87;font-weight:bold">env</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">prod</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">jsonPatchOverrides</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#204a87;font-weight:bold">op</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">remove</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/rules/0/verbs/2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>The <code>ClusterResourceOverride</code> object above will remove the verb &ldquo;list&rdquo; in the <code>ClusterRole</code> named <code>secret-reader</code> on
clusters with the label <code>env: prod</code>.</p>
<blockquote>
<p>The ClusterResourceOverride mentioned above utilizes the cluster role displayed below:</p>
<pre tabindex="0"><code>Name:         secret-reader
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
PolicyRule:
Resources  Non-Resource URLs  Resource Names  Verbs
---------  -----------------  --------------  -----
secrets    []                 []              [get watch list]
</code></pre></blockquote>
<h3 id="cluster-selector">Cluster Selector</h3>
<p>To specify the clusters to which the override applies, you can use the <code>clusterSelector</code> field in the <code>OverrideRule</code> spec.
The <code>clusterSelector</code> field supports the following fields:</p>
<ul>
<li><code>clusterSelectorTerms</code>: A list of terms that are used to select clusters.
<ul>
<li>Each term in the list is used to select clusters based on the label selector.</li>
</ul>
</li>
</ul>
<h3 id="json-patch-override">JSON Patch Override</h3>
<p>To specify the changes to be applied to the selected resources, you can use the jsonPatchOverrides field in the OverrideRule spec.
The jsonPatchOverrides field supports the following fields:</p>
<blockquote>
<p>JSONPatchOverride applies a JSON patch on the selected resources following <a href="https://datatracker.ietf.org/doc/html/rfc6902">RFC 6902</a>.
All the fields defined follow this RFC.</p></blockquote>
<ul>
<li>
<p><code>op</code>: The operation to be performed. The supported operations are <code>add</code>, <code>remove</code>, and <code>replace</code>.</p>
<ul>
<li><code>add</code>: Adds a new value to the specified path.</li>
<li><code>remove</code>: Removes the value at the specified path.</li>
<li><code>replace</code>: Replaces the value at the specified path.</li>
</ul>
</li>
<li>
<p><code>path</code>: The path to the field to be modified.</p>
<ul>
<li>Some guidelines for the path are as follows:
<ul>
<li>Must start with a <code>/</code> character.</li>
<li>Cannot be empty.</li>
<li>Cannot contain an empty string (&quot;///&quot;).</li>
<li>Cannot be a TypeMeta Field (&quot;/kind&quot;, &ldquo;/apiVersion&rdquo;).</li>
<li>Cannot be a Metadata Field (&quot;/metadata/name&quot;, &ldquo;/metadata/namespace&rdquo;), except the fields &ldquo;/metadata/annotations&rdquo; and &ldquo;metadata/labels&rdquo;.</li>
<li>Cannot be any field in the status of the resource.</li>
</ul>
</li>
<li>Some examples of valid paths are:
<ul>
<li><code>/metadata/labels/new-label</code></li>
<li><code>/metadata/annotations/new-annotation</code></li>
<li><code>/spec/template/spec/containers/0/resources/limits/cpu</code></li>
<li><code>/spec/template/spec/containers/0/resources/requests/memory</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>value</code>: The value to be set.</p>
<ul>
<li>If the <code>op</code> is <code>remove</code>, the value cannot be set.</li>
</ul>
</li>
</ul>
<h3 id="multiple-override-patches">Multiple Override Patches</h3>
<p>You may add multiple <code>JSONPatchOverride</code> to an <code>OverrideRule</code> to apply multiple changes to the selected cluster resources.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1alpha1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourceOverride</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">example-cro</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">clusterResourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">group</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">rbac.authorization.k8s.io</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterRole</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">secret-reader</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">overrideRules</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">clusterSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">clusterSelectorTerms</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#204a87;font-weight:bold">labelSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#204a87;font-weight:bold">env</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">prod</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">jsonPatchOverrides</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#204a87;font-weight:bold">op</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">remove</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/rules/0/verbs/2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#204a87;font-weight:bold">op</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">remove</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/rules/0/verbs/1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>The <code>ClusterResourceOverride</code> object above will remove the verbs &ldquo;list&rdquo; and &ldquo;watch&rdquo; in the <code>ClusterRole</code> named
<code>secret-reader</code> on clusters with the label <code>env: prod</code>.</p>
<h4 id="breaking-down-the-paths">Breaking down the paths:</h4>
<ul>
<li>First <code>JSONPatchOverride</code>:
<ul>
<li><code>/rules/0</code>: This denotes the first rule in the rules array of the ClusterRole. In the provided ClusterRole definition,
there&rsquo;s only one rule defined (&ldquo;secrets&rdquo;), so this corresponds to the first (and only) rule.</li>
<li><code>/verbs/2</code>: Within this rule, the third element of the verbs array is targeted (&ldquo;list&rdquo;).</li>
</ul>
</li>
<li>Second <code>JSONPatchOverride</code>:
<ul>
<li><code>/rules/0</code>: This denotes the first rule in the rules array of the ClusterRole. In the provided ClusterRole definition,
there&rsquo;s only one rule defined (&ldquo;secrets&rdquo;), so this corresponds to the first (and only) rule.</li>
<li><code>/verbs/1</code>: Within this rule, the second element of the verbs array is targeted (&ldquo;watch&rdquo;).</li>
</ul>
</li>
</ul>
<blockquote>
<p>The ClusterResourceOverride mentioned above utilizes the cluster role displayed below:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">Name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">         </span><span style="color:#000">secret-reader</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">Labels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#000">&lt;none&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">Annotations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">&lt;none&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">PolicyRule</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">Resources  Non-Resource URLs  Resource Names  Verbs</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">---</span>------ <span style="color:#f8f8f8;text-decoration:underline"> </span>----------------- <span style="color:#f8f8f8;text-decoration:underline"> </span>-------------- <span style="color:#f8f8f8;text-decoration:underline"> </span>-----<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">secrets    []                 []              [get watch list]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></blockquote>
<h2 id="applying-the-clusterresourceoverride">Applying the ClusterResourceOverride</h2>
<p>Create a ClusterResourcePlacement resource to specify the placement rules for distributing the cluster resource overrides across
the cluster infrastructure. Ensure that you select the appropriate resource.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacement</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">crp-example</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">group</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">rbac.authorization.k8s.io</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterRole</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">secret-reader</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">placementType</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">PickAll</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">affinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">clusterAffinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">requiredDuringSchedulingIgnoredDuringExecution</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">clusterSelectorTerms</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#204a87;font-weight:bold">labelSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#204a87;font-weight:bold">env</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">prod</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>The <code>ClusterResourcePlacement</code> configuration outlined above will disperse resources across all clusters labeled with <code>env: prod</code>.
As the changes are implemented, the corresponding <code>ClusterResourceOverride</code> configurations will be applied to the
designated clusters, triggered by the selection of matching cluster role resource <code>secret-reader</code>.</p>
<h2 id="verifying-the-cluster-resource-is-overridden">Verifying the Cluster Resource is Overridden</h2>
<p>To ensure that the <code>ClusterResourceOverride</code> object is applied to the selected clusters, verify the <code>ClusterResourcePlacement</code>
status by running <code>kubectl describe crp crp-example</code> command:</p>
<pre tabindex="0"><code>Status:
  Conditions:
    ...
    Last Transition Time:   2024-04-27T04:18:00Z
    Message:                The selected resources are successfully overridden in the 10 clusters
    Observed Generation:    1
    Reason:                 OverriddenSucceeded
    Status:                 True
    Type:                   ClusterResourcePlacementOverridden
    ...
  Observed Resource Index:  0
  Placement Statuses:
    Applicable Cluster Resource Overrides:
      example-cro-0
    Cluster Name:  member-50
    Conditions:
      ...
      Message:               Successfully applied the override rules on the resources
      Observed Generation:   1
      Reason:                OverriddenSucceeded
      Status:                True
      Type:                  Overridden
     ...
</code></pre><p>Each cluster maintains its own <code>Applicable Cluster Resource Overrides</code> which contain the cluster resource override snapshot
if relevant. Additionally, individual status messages for each cluster indicates whether the override rules have been
effectively applied.</p>
<p>The <code>ClusterResourcePlacementOverridden</code> condition indicates whether the resource override has been successfully applied
to the selected resources in the selected clusters.</p>
<p>To verify that the <code>ClusterResourceOverride</code> object has been successfully applied to the selected resources,
check resources in the selected clusters:</p>
<ol>
<li>Get cluster credentials:
<code>az aks get-credentials --resource-group &lt;resource-group&gt; --name &lt;cluster-name&gt;</code></li>
<li>Get the <code>ClusterRole</code> object in the selected cluster:
<code>kubectl --context=&lt;member-cluster-context&gt;  get clusterrole secret-reader -o yaml</code></li>
</ol>
<p>Upon inspecting the described ClusterRole object, it becomes apparent that the verbs &ldquo;watch&rdquo; and &ldquo;list&rdquo; have been
removed from the permissions list within the ClusterRole named &ldquo;secret-reader&rdquo; on the selected cluster.</p>
<pre tabindex="0"><code> apiVersion: rbac.authorization.k8s.io/v1
 kind: ClusterRole
 metadata:
  ...
 rules:
 - apiGroups:
   - &#34;&#34;
   resources:
   - secrets
   verbs:
   - get
</code></pre>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-4f07136e38cf9fb330102a16c2742234">3.8 - Using the ResourceOverride API</h1>
    <div class="lead">How to use the <code>ResourceOverride</code> API to override namespace-scoped resources</div>
	<p>This guide provides an overview of how to use the Fleet <code>ResourceOverride</code> API to override resources.</p>
<h2 id="overview">Overview</h2>
<p><code>ResourceOverride</code> is a Fleet API that allows you to modify or override specific attributes of
existing resources within your cluster. With ResourceOverride, you can define rules based on cluster
labels or other criteria, specifying changes to be applied to resources such as Deployments, StatefulSets, ConfigMaps, or Secrets.
These changes can include updates to container images, environment variables, resource limits, or any other configurable parameters.</p>
<h2 id="api-components">API Components</h2>
<p>The ResourceOverride API consists of the following components:</p>
<ul>
<li><strong>Resource Selectors</strong>: These specify the set of resources selected for overriding.</li>
<li><strong>Policy</strong>: This specifies the policy to be applied to the selected resources.</li>
</ul>
<p>The following sections discuss these components in depth.</p>
<h2 id="resource-selectors">Resource Selectors</h2>
<p>A <code>ResourceOverride</code> object may feature one or more resource selectors, specifying which resources to select to be overridden.</p>
<p>The <code>ResourceSelector</code> object supports the following fields:</p>
<ul>
<li><code>group</code>: The API group of the resource</li>
<li><code>version</code>: The API version of the resource</li>
<li><code>kind</code>: The kind of the resource</li>
<li><code>name</code>: The name of the resource</li>
</ul>
<blockquote>
<p>Note: The resource can only be selected by name.</p></blockquote>
<p>To add a resource selector, edit the <code>resourceSelectors</code> field in the <code>ResourceOverride</code> spec:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1alpha1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ResourceOverride</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">example-ro</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test-namespace</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">group</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">apps</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Deployment</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">my-deployment</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><blockquote>
<p>Note: The ResourceOverride needs to be in the same namespace as the resources it is overriding.</p></blockquote>
<p>The example above will pick a <code>Deployment</code> named <code>my-deployment</code> from the namespace <code>test-namespace</code>, as shown below, to be overridden.</p>
<pre tabindex="0"><code>apiVersion: apps/v1
kind: Deployment
metadata:
  ...
  name: my-deployment
  namespace: test-namespace
  ...
spec:
  progressDeadlineSeconds: 600
  replicas: 2
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app: test-nginx
  strategy:
    rollingUpdate:
      maxSurge: 25%
      maxUnavailable: 25%
    type: RollingUpdate
  template:
    metadata:
      creationTimestamp: null
      labels:
        app: test-nginx
    spec:
      containers:
      - image: nginx:1.14.2
        imagePullPolicy: IfNotPresent
        name: nginx
        ports:
        - containerPort: 80
          protocol: TCP
        resources: {}
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
      dnsPolicy: ClusterFirst
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext: {}
      terminationGracePeriodSeconds: 30
status:
  ...
</code></pre><h2 id="policy">Policy</h2>
<p>The <code>Policy</code> is made up of a set of rules (<code>OverrideRules</code>) that specify the changes to be applied to the selected
resources on selected clusters.</p>
<p>Each <code>OverrideRule</code> supports the following fields:</p>
<ul>
<li><strong>Cluster Selector</strong>: This specifies the set of clusters to which the override applies.</li>
<li><strong>JSON Patch Override</strong>: This specifies the changes to be applied to the selected resources.</li>
</ul>
<p>To add an override rule, edit the <code>policy</code> field in the <code>ResourceOverride</code> spec:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1alpha1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ResourceOverride</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">example-ro</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test-namespace</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">group</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">apps</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Deployment</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">my-deployment</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">overrideRules</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">clusterSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">clusterSelectorTerms</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#204a87;font-weight:bold">labelSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#204a87;font-weight:bold">env</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">prod</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">jsonPatchOverrides</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#204a87;font-weight:bold">op</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">replace</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/spec/template/spec/containers/0/image</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">value</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;nginx:1.20.0&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>The <code>ResourceOverride</code> object above will replace the image of the container in the <code>Deployment</code> named <code>my-deployment</code>
with the image <code>nginx:1.20.0</code> on all clusters with the label <code>env: prod</code>.</p>
<blockquote>
<p>The ResourceOverride mentioned above utilizes the deployment displayed below:</p>
<pre tabindex="0"><code>apiVersion: apps/v1
kind: Deployment
metadata:
  ...
  name: my-deployment
  namespace: test-namespace
  ...
spec:
  ...
  template:
    ...
    spec:
      containers:
      - image: nginx:1.14.2
        imagePullPolicy: IfNotPresent
        name: nginx
        ports:
       ...
      ...
  ...
</code></pre></blockquote>
<h3 id="cluster-selector">Cluster Selector</h3>
<p>To specify the clusters to which the override applies, you can use the <code>clusterSelector</code> field in the <code>OverrideRule</code> spec.
The <code>clusterSelector</code> field supports the following fields:</p>
<ul>
<li><code>clusterSelectorTerms</code>: A list of terms that are used to select clusters.
<ul>
<li>Each term in the list is used to select clusters based on the label selector.</li>
</ul>
</li>
</ul>
<h3 id="json-patch-override">JSON Patch Override</h3>
<p>To specify the changes to be applied to the selected resources, you can use the jsonPatchOverrides field in the OverrideRule spec.
The jsonPatchOverrides field supports the following fields:</p>
<blockquote>
<p>JSONPatchOverride applies a JSON patch on the selected resources following <a href="https://datatracker.ietf.org/doc/html/rfc6902">RFC 6902</a>.
All the fields defined follow this RFC.</p></blockquote>
<p>The <code>jsonPatchOverrides</code> field supports the following fields:</p>
<ul>
<li>
<p><code>op</code>: The operation to be performed. The supported operations are <code>add</code>, <code>remove</code>, and <code>replace</code>.</p>
<ul>
<li><code>add</code>: Adds a new value to the specified path.</li>
<li><code>remove</code>: Removes the value at the specified path.</li>
<li><code>replace</code>: Replaces the value at the specified path.</li>
</ul>
</li>
<li>
<p><code>path</code>: The path to the field to be modified.</p>
<ul>
<li>Some guidelines for the path are as follows:
<ul>
<li>Must start with a <code>/</code> character.</li>
<li>Cannot be empty.</li>
<li>Cannot contain an empty string (&quot;///&quot;).</li>
<li>Cannot be a TypeMeta Field (&quot;/kind&quot;, &ldquo;/apiVersion&rdquo;).</li>
<li>Cannot be a Metadata Field (&quot;/metadata/name&quot;, &ldquo;/metadata/namespace&rdquo;), except the fields &ldquo;/metadata/annotations&rdquo; and &ldquo;metadata/labels&rdquo;.</li>
<li>Cannot be any field in the status of the resource.</li>
</ul>
</li>
<li>Some examples of valid paths are:
<ul>
<li><code>/metadata/labels/new-label</code></li>
<li><code>/metadata/annotations/new-annotation</code></li>
<li><code>/spec/template/spec/containers/0/resources/limits/cpu</code></li>
<li><code>/spec/template/spec/containers/0/resources/requests/memory</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>value</code>: The value to be set.</p>
<ul>
<li>If the <code>op</code> is <code>remove</code>, the value cannot be set.</li>
</ul>
</li>
</ul>
<h3 id="multiple-override-rules">Multiple Override Rules</h3>
<p>You may add multiple <code>OverrideRules</code> to a <code>Policy</code> to apply multiple changes to the selected resources.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1alpha1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ResourceOverride</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">example-ro</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test-namespace</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">group</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">apps</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Deployment</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">my-deployment</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">overrideRules</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">clusterSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">clusterSelectorTerms</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#204a87;font-weight:bold">labelSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#204a87;font-weight:bold">env</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">prod</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">jsonPatchOverrides</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#204a87;font-weight:bold">op</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">replace</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/spec/template/spec/containers/0/image</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">value</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;nginx:1.20.0&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">clusterSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">clusterSelectorTerms</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#204a87;font-weight:bold">labelSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#204a87;font-weight:bold">env</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">jsonPatchOverrides</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#204a87;font-weight:bold">op</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">replace</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/spec/template/spec/containers/0/image</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">value</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;nginx:latest&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>The <code>ResourceOverride</code> object above will replace the image of the container in the <code>Deployment</code> named <code>my-deployment</code>
with the image <code>nginx:1.20.0</code> on all clusters with the label <code>env: prod</code> and the image <code>nginx:latest</code> on all clusters with the label <code>env: test</code>.</p>
<blockquote>
<p>The ResourceOverride mentioned above utilizes the deployment displayed below:</p>
<pre tabindex="0"><code>apiVersion: apps/v1
kind: Deployment
metadata:
  ...
  name: my-deployment
  namespace: test-namespace
  ...
spec:
  ...
  template:
    ...
    spec:
      containers:
      - image: nginx:1.14.2
        imagePullPolicy: IfNotPresent
        name: nginx
        ports:
       ...
      ...
  ...
</code></pre></blockquote>
<h2 id="applying-the-resourceoverride">Applying the ResourceOverride</h2>
<p>Create a ClusterResourcePlacement resource to specify the placement rules for distributing the resource overrides across
the cluster infrastructure. Ensure that you select the appropriate namespaces containing the matching resources.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">placement.kubernetes-fleet.io/v1beta1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ClusterResourcePlacement</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">crp-example</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resourceSelectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">group</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Namespace</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test-namespace</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">placementType</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">PickAll</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">affinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">clusterAffinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">requiredDuringSchedulingIgnoredDuringExecution</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">clusterSelectorTerms</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#204a87;font-weight:bold">labelSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#204a87;font-weight:bold">env</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">prod</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#204a87;font-weight:bold">labelSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#204a87;font-weight:bold">env</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>The <code>ClusterResourcePlacement</code> configuration outlined above will disperse resources within <code>test-namespace</code> across all
clusters labeled with <code>env: prod</code> and <code>env: test</code>. As the changes are implemented, the corresponding <code>ResourceOverride</code>
configurations will be applied to the designated clusters, triggered by the selection of matching deployment resource
<code>my-deployment</code>.</p>
<h2 id="verifying-the-cluster-resource-is-overridden">Verifying the Cluster Resource is Overridden</h2>
<p>To ensure that the <code>ResourceOverride</code> object is applied to the selected resources, verify the <code>ClusterResourcePlacement</code>
status by running <code>kubectl describe crp crp-example</code> command:</p>
<pre tabindex="0"><code>Status:
  Conditions:
    ...
    Message:                The selected resources are successfully overridden in the 10 clusters
    Observed Generation:    1
    Reason:                 OverriddenSucceeded
    Status:                 True
    Type:                   ClusterResourcePlacementOverridden
    ...
  Observed Resource Index:  0
  Placement Statuses:
    Applicable Resource Overrides:
      Name:        example-ro-0
      Namespace:   test-namespace
    Cluster Name:  member-50
    Conditions:
      ...
      Last Transition Time:  2024-04-26T22:57:14Z
      Message:               Successfully applied the override rules on the resources
      Observed Generation:   1
      Reason:                OverriddenSucceeded
      Status:                True
      Type:                  Overridden
     ...
</code></pre><p>Each cluster maintains its own <code>Applicable Resource Overrides</code> which contain the resource override snapshot and
the resource override namespace if relevant. Additionally, individual status messages for each cluster indicates
whether the override rules have been effectively applied.</p>
<p>The <code>ClusterResourcePlacementOverridden</code> condition indicates whether the resource override has been successfully applied
to the selected resources in the selected clusters.</p>
<p>To verify that the <code>ResourceOverride</code> object has been successfully applied to the selected resources,
check resources in the selected clusters:</p>
<ol>
<li>Get cluster credentials:
<code>az aks get-credentials --resource-group &lt;resource-group&gt; --name &lt;cluster-name&gt;</code></li>
<li>Get the <code>Deployment</code> object in the selected cluster:
<code>kubectl --context=&lt;member-cluster-context&gt;  get deployment my-deployment -n test-namespace -o yaml</code></li>
</ol>
<p>Upon inspecting the member cluster, it was found that the selected cluster had the label env: prod.
Consequently, the image on deployment <code>my-deployment</code> was modified to be <code>nginx:1.20.0</code> on selected cluster.</p>
<pre tabindex="0"><code>apiVersion: apps/v1
 kind: Deployment
 metadata:
   ...
   name: my-deployment
   namespace: test-namespace
   ...
 spec:
   ...
   template:
     ...
     spec:
       containers:
       - image: nginx:1.20.0
         imagePullPolicy: IfNotPresent
         name: nginx
         ports:
        ...
       ...
 status:
     ...
</code></pre>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-b44fd8dfb69a651370335b35322594c6">3.9 - Using Envelope Objects to Place Resources</h1>
    <div class="lead">How to use envelope objects with the ClusterResourcePlacement API</div>
	<h2 id="propagating-resources-with-envelope-objects">Propagating Resources with Envelope Objects</h2>
<p>This guide provides instructions on propagating a set of resources from the hub cluster to joined member clusters within an envelope object.</p>
<h2 id="envelope-object-with-configmap">Envelope Object with ConfigMap</h2>
<p>Currently, we support using a <code>ConfigMap</code> as an envelope object by leveraging a fleet-reserved annotation.</p>
<p>To designate a <code>ConfigMap</code> as an envelope object, ensure that it contains the following annotation:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">annotations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kubernetes-fleet.io/envelope-configmap</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;true&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h3 id="example-configmap-envelope-object">Example ConfigMap Envelope Object:</h3>
<pre tabindex="0"><code>apiVersion: v1
kind: ConfigMap
metadata:
  name: envelope-configmap
  namespace: app
  annotations:
    kubernetes-fleet.io/envelope-configmap: &#34;true&#34;
data:
  resourceQuota.yaml: |
    apiVersion: v1
    kind: ResourceQuota
    metadata:
      name: mem-cpu-demo
      namespace: app
    spec:
      hard:
        requests.cpu: &#34;1&#34;
        requests.memory: 1Gi
        limits.cpu: &#34;2&#34;
        limits.memory: 2Gi
  webhook.yaml: |
    apiVersion: admissionregistration.k8s.io/v1
    kind: MutatingWebhookConfiguration
    metadata:
      creationTimestamp: null
      labels:
        azure-workload-identity.io/system: &#34;true&#34;
      name: azure-wi-webhook-mutating-webhook-configuration
    webhooks:
    - admissionReviewVersions:
      - v1
      - v1beta1
      clientConfig:
        service:
          name: azure-wi-webhook-webhook-service
          namespace: app
          path: /mutate-v1-pod
      failurePolicy: Fail
      matchPolicy: Equivalent
      name: mutation.azure-workload-identity.io
      rules:
      - apiGroups:
        - &#34;&#34;
        apiVersions:
        - v1
        operations:
        - CREATE
        - UPDATE
        resources:
        - pods
      sideEffects: None
</code></pre><h2 id="propagating-an-envelope-configmap-from-hub-cluster-to-member-cluster">Propagating an Envelope ConfigMap from Hub cluster to Member cluster:</h2>
<p>We will now apply the example envelope object above on our hub cluster. Then we use a <code>ClusterResourcePlacement</code> object to propagate the resource from hub to a member cluster named <code>kind-cluster-1</code>.</p>
<h3 id="crp-spec">CRP spec:</h3>
<pre tabindex="0"><code>spec:
  policy:
    clusterNames:
    - kind-cluster-1
    placementType: PickFixed
  resourceSelectors:
  - group: &#34;&#34;
    kind: Namespace
    name: app
    version: v1
  revisionHistoryLimit: 10
  strategy:
    type: RollingUpdate
</code></pre><h3 id="crp-status">CRP status:</h3>
<pre tabindex="0"><code>status:
  conditions:
  - lastTransitionTime: &#34;2023-11-30T19:54:13Z&#34;
    message: found all the clusters needed as specified by the scheduling policy
    observedGeneration: 2
    reason: SchedulingPolicyFulfilled
    status: &#34;True&#34;
    type: ClusterResourcePlacementScheduled
  - lastTransitionTime: &#34;2023-11-30T19:54:18Z&#34;
    message: All 1 cluster(s) are synchronized to the latest resources on the hub
      cluster
    observedGeneration: 2
    reason: SynchronizeSucceeded
    status: &#34;True&#34;
    type: ClusterResourcePlacementSynchronized
  - lastTransitionTime: &#34;2023-11-30T19:54:18Z&#34;
    message: Successfully applied resources to 1 member clusters
    observedGeneration: 2
    reason: ApplySucceeded
    status: &#34;True&#34;
    type: ClusterResourcePlacementApplied
  placementStatuses:
  - clusterName: kind-cluster-1
    conditions:
    - lastTransitionTime: &#34;2023-11-30T19:54:13Z&#34;
      message: &#39;Successfully scheduled resources for placement in kind-cluster-1:
        picked by scheduling policy&#39;
      observedGeneration: 2
      reason: ScheduleSucceeded
      status: &#34;True&#34;
      type: ResourceScheduled
    - lastTransitionTime: &#34;2023-11-30T19:54:18Z&#34;
      message: Successfully Synchronized work(s) for placement
      observedGeneration: 2
      reason: WorkSynchronizeSucceeded
      status: &#34;True&#34;
      type: WorkSynchronized
    - lastTransitionTime: &#34;2023-11-30T19:54:18Z&#34;
      message: Successfully applied resources
      observedGeneration: 2
      reason: ApplySucceeded
      status: &#34;True&#34;
      type: ResourceApplied
  selectedResources:
  - kind: Namespace
    name: app
    version: v1
  - kind: ConfigMap
    name: envelope-configmap
    namespace: app
    version: v1
</code></pre><blockquote>
<blockquote>
<p>Note: In the <code>selectedResources</code> section, we specifically display the propagated envelope object. Please note that we do not individually list all the resources contained within the envelope object in the status.</p></blockquote></blockquote>
<p>Upon inspection of the <code>selectedResources</code>, it indicates that the namespace <code>app</code> and the configmap <code>envelope-configmap</code> have been successfully propagated. Users can further verify the successful propagation of resources mentioned within the <code>envelope-configmap</code> object by ensuring that the <code>failedPlacements</code> section in the <code>placementStatus</code> for <code>kind-cluster-1</code> does not appear in the status.</p>
<h2 id="example-crp-status-where-resource-within-an-envelope-object-failed-to-apply">Example CRP status where resource within an envelope object failed to apply:</h2>
<h3 id="crp-status-1">CRP status:</h3>
<p>In the example below, within the <code>placementStatus</code> section for <code>kind-cluster-1</code>, the <code>failedPlacements</code> section provides details on resource that failed to apply along with information about the <code>envelope object</code> which contained the resource.</p>
<pre tabindex="0"><code>status:
  conditions:
  - lastTransitionTime: &#34;2023-12-06T00:09:53Z&#34;
    message: found all the clusters needed as specified by the scheduling policy
    observedGeneration: 2
    reason: SchedulingPolicyFulfilled
    status: &#34;True&#34;
    type: ClusterResourcePlacementScheduled
  - lastTransitionTime: &#34;2023-12-06T00:09:58Z&#34;
    message: All 1 cluster(s) are synchronized to the latest resources on the hub
      cluster
    observedGeneration: 2
    reason: SynchronizeSucceeded
    status: &#34;True&#34;
    type: ClusterResourcePlacementSynchronized
  - lastTransitionTime: &#34;2023-12-06T00:09:58Z&#34;
    message: Failed to apply manifests to 1 clusters, please check the `failedPlacements`
      status
    observedGeneration: 2
    reason: ApplyFailed
    status: &#34;False&#34;
    type: ClusterResourcePlacementApplied
  placementStatuses:
  - clusterName: kind-cluster-1
    conditions:
    - lastTransitionTime: &#34;2023-12-06T00:09:53Z&#34;
      message: &#39;Successfully scheduled resources for placement in kind-cluster-1:
        picked by scheduling policy&#39;
      observedGeneration: 2
      reason: ScheduleSucceeded
      status: &#34;True&#34;
      type: ResourceScheduled
    - lastTransitionTime: &#34;2023-12-06T00:09:58Z&#34;
      message: Successfully Synchronized work(s) for placement
      observedGeneration: 2
      reason: WorkSynchronizeSucceeded
      status: &#34;True&#34;
      type: WorkSynchronized
    - lastTransitionTime: &#34;2023-12-06T00:09:58Z&#34;
      message: Failed to apply manifests, please check the `failedPlacements` status
      observedGeneration: 2
      reason: ApplyFailed
      status: &#34;False&#34;
      type: ResourceApplied
    failedPlacements:
    - condition:
        lastTransitionTime: &#34;2023-12-06T00:09:53Z&#34;
        message: &#39;Failed to apply manifest: namespaces &#34;app&#34; not found&#39;
        reason: AppliedManifestFailedReason
        status: &#34;False&#34;
        type: Applied
      envelope:
        name: envelop-configmap
        namespace: test-ns
        type: ConfigMap
      kind: ResourceQuota
      name: mem-cpu-demo
      namespace: app
      version: v1
  selectedResources:
  - kind: Namespace
    name: test-ns
    version: v1
  - kind: ConfigMap
    name: envelop-configmap
    namespace: test-ns
    version: v1
</code></pre>
</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-4588103fb9a692533044ee756a5f863f">4 - Frequently Asked Questions</h1>
    <div class="lead">Frequently Asked Questions about Fleet</div>
	<h2 id="what-are-fleet-owned-resources-on-the-hub-and-member-clusters-can-these-fleet-owned-resources-be-modified-by-the-user">What are fleet-owned resources on the hub and member clusters? Can these fleet-owned resources be modified by the user?</h2>
<p>Majority of the <code>internal</code> resources and fleet reserved namespaces described below are safeguarded by a series of validating webhooks, serving as a preventive measure to restrict users from making modifications to them.</p>
<p>The fleet reserved namespace are <code>fleet-system</code> and <code>fleet-member-{clusterName}</code> where clusterName is the name of each member cluster that has joined the fleet.</p>
<ul>
<li>
<p>Fleet hub cluster internal resources:</p>
<table>
  <thead>
      <tr>
          <th>Resource</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>InternalMemberCluster</code></td>
      </tr>
      <tr>
          <td><code>Work</code></td>
      </tr>
      <tr>
          <td><code>ClusterResourceSnapshot</code></td>
      </tr>
      <tr>
          <td><code>ClusterSchedulingPolicySnapshot</code></td>
      </tr>
      <tr>
          <td><code>ClusterResourceBinding</code></td>
      </tr>
  </tbody>
</table>
</li>
<li>
<p>Fleet member cluster internal resources:</p>
<table>
  <thead>
      <tr>
          <th>Resource</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>InternalMemberCluster</code></td>
      </tr>
      <tr>
          <td><code>AppliedWork</code></td>
      </tr>
  </tbody>
</table>
</li>
</ul>
<p><strong>Fleet APIs</strong> are defined <a href="https://github.com/Azure/fleet/tree/main/apis">here</a>, <strong>Fleet CRDs</strong> are defined <a href="https://github.com/Azure/fleet/tree/main/config/crd/bases">here</a>.</p>
<ul>
<li>Fleet Networking hub cluster internal resources:
<table>
  <thead>
      <tr>
          <th>Resource</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>EndpointSliceExport</code></td>
      </tr>
      <tr>
          <td><code>EndpointSliceImport</code></td>
      </tr>
      <tr>
          <td><code>InternalServiceExport</code></td>
      </tr>
      <tr>
          <td><code>InternalServiceImport</code></td>
      </tr>
      <tr>
          <td><code>ServiceImport</code></td>
      </tr>
  </tbody>
</table>
</li>
</ul>
<p><strong>Fleet Networking APIs</strong> are defined <a href="https://github.com/Azure/fleet-networking/tree/main/api/v1alpha1">here</a>, <strong>Fleet Networking CRDs</strong> are defined <a href="https://github.com/Azure/fleet-networking/tree/main/config/crd/bases">here</a>.</p>
<h2 id="what-kind-of-the-resources-are-allowed-to-be-propagated-from-the-hub-cluster-to-the-member-clusters-how-can-i-control-the-list">What kind of the resources are allowed to be propagated from the hub cluster to the member clusters? How can I control the list?</h2>
<p>The resources to be propagated from the hub cluster to the member clusters can be controlled by either an exclude/skip list or an include/allow list which are mutually exclusive.</p>
<p><code>ClusterResourcePlacement</code> excludes certain groups/resources when propagating the resources by default. They are defined <a href="https://github.com/Azure/fleet/blob/main/pkg/utils/apiresources.go">here</a>.</p>
<ul>
<li><code>k8s.io/api/events/v1</code> (group)</li>
<li><code>k8s.io/api/coordination/v1</code> (group)</li>
<li><code>k8s.io/metrics/pkg/apis/metrics/v1beta1</code> (group)</li>
<li><code>k8s.io/api/core/v1</code> (pod, node)</li>
<li><code>networking.fleet.azure.com</code> (service import resource)</li>
<li>any resources in the &ldquo;default&rdquo; namespace</li>
</ul>
<p>You can use <code>skipped-propagating-apis</code> and <code>skipped-propagating-namespaces</code> flag when installing the hub-agent to skip resources from being propagated by specifying their group/group-version/group-version-kind and namespaces.</p>
<p>You can use <code>allowed-propagating-apis</code> flag on the hub-agent to only allow propagation of desired set of resources specified in the form of group/group-version/group-version-kind. This flag is mutually exclusive with <code>skipped-propagating-apis</code>.</p>
<h2 id="what-happens-to-existing-resources-in-member-clusters-when-their-definitions-conflict-with-the-desired-resources-in-the-hub-cluster">What happens to existing resources in member clusters when their definitions conflict with the desired resources in the hub cluster?</h2>
<p>In case of a conflict, where a resource already exists on the member cluster, the apply operation fails when trying to propagate the same resource from the hub cluster.</p>
<h2 id="what-happens-if-modifies-resources-that-were-placed-from-hub-to-member-clusters">What happens if modifies resources that were placed from hub to member clusters?</h2>
<p>Possible scenarios:</p>
<ul>
<li>If the user <code>updates</code> the resource on the hub cluster, the update is propagated to all member clusters where the resource exists.</li>
<li>If the user <code>deletes</code> the resource on the hub cluster, the resource is deleted on all clusters to which it was propagated.</li>
<li>If the user <code>updates</code> the resource on the member cluster, no automatic action occurs as it&rsquo;s a user-made modification.</li>
<li>If the user <code>deletes</code> the resource on the member cluster, the resource is automatically created again on the member cluster after reconciliation.</li>
</ul>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-b5568d681972077a2a3f45e40a59d61a">5 - API Reference</h1>
    <div class="lead">Reference for Fleet APIs</div>
	<h2 id="packages">Packages</h2>
<ul>
<li><a href="/website/docs/api-reference/#clusterkubernetes-fleetiov1beta1">cluster.kubernetes-fleet.io/v1beta1</a></li>
<li><a href="/website/docs/api-reference/#placementkubernetes-fleetiov1beta1">placement.kubernetes-fleet.io/v1beta1</a></li>
</ul>
<h2 id="clusterkubernetes-fleetiov1beta1">cluster.kubernetes-fleet.io/v1beta1</h2>
<h3 id="resource-types">Resource Types</h3>
<ul>
<li><a href="/website/docs/api-reference/#membercluster">MemberCluster</a></li>
<li><a href="/website/docs/api-reference/#memberclusterlist">MemberClusterList</a></li>
</ul>
<h4 id="agentstatus">AgentStatus</h4>
<p>AgentStatus defines the observed status of the member agent of the given type.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#memberclusterstatus">MemberClusterStatus</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>type</code> <em><a href="/website/docs/api-reference/#agenttype">AgentType</a></em></td>
          <td>Type of the member agent.</td>
      </tr>
      <tr>
          <td><code>conditions</code> <em><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.26/#condition-v1-meta">Condition</a> array</em></td>
          <td>Conditions is an array of current observed conditions for the member agent.</td>
      </tr>
      <tr>
          <td><code>lastReceivedHeartbeat</code> <em><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.26/#time-v1-meta">Time</a></em></td>
          <td>Last time we received a heartbeat from the member agent.</td>
      </tr>
  </tbody>
</table>
<h4 id="agenttype">AgentType</h4>
<p><em>Underlying type:</em> <em>string</em></p>
<p>AgentType defines a type of agent/binary running in a member cluster.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#agentstatus">AgentStatus</a></li>
</ul>
<h4 id="membercluster">MemberCluster</h4>
<p>MemberCluster is a resource created in the hub cluster to represent a member cluster within a fleet.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#memberclusterlist">MemberClusterList</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>apiVersion</code> <em>string</em></td>
          <td><code>cluster.kubernetes-fleet.io/v1beta1</code></td>
      </tr>
      <tr>
          <td><code>kind</code> <em>string</em></td>
          <td><code>MemberCluster</code></td>
      </tr>
      <tr>
          <td><code>kind</code> <em>string</em></td>
          <td>Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: <a href="https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds">https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds</a></td>
      </tr>
      <tr>
          <td><code>apiVersion</code> <em>string</em></td>
          <td>APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: <a href="https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources">https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources</a></td>
      </tr>
      <tr>
          <td><code>metadata</code> <em><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.26/#objectmeta-v1-meta">ObjectMeta</a></em></td>
          <td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td>
      </tr>
      <tr>
          <td><code>spec</code> <em><a href="/website/docs/api-reference/#memberclusterspec">MemberClusterSpec</a></em></td>
          <td>The desired state of MemberCluster.</td>
      </tr>
      <tr>
          <td><code>status</code> <em><a href="/website/docs/api-reference/#memberclusterstatus">MemberClusterStatus</a></em></td>
          <td>The observed status of MemberCluster.</td>
      </tr>
  </tbody>
</table>
<h4 id="memberclusterlist">MemberClusterList</h4>
<p>MemberClusterList contains a list of MemberCluster.</p>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>apiVersion</code> <em>string</em></td>
          <td><code>cluster.kubernetes-fleet.io/v1beta1</code></td>
      </tr>
      <tr>
          <td><code>kind</code> <em>string</em></td>
          <td><code>MemberClusterList</code></td>
      </tr>
      <tr>
          <td><code>kind</code> <em>string</em></td>
          <td>Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: <a href="https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds">https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds</a></td>
      </tr>
      <tr>
          <td><code>apiVersion</code> <em>string</em></td>
          <td>APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: <a href="https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources">https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources</a></td>
      </tr>
      <tr>
          <td><code>metadata</code> <em><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.26/#listmeta-v1-meta">ListMeta</a></em></td>
          <td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td>
      </tr>
      <tr>
          <td><code>items</code> <em><a href="/website/docs/api-reference/#membercluster">MemberCluster</a> array</em></td>
          <td></td>
      </tr>
  </tbody>
</table>
<h4 id="memberclusterspec">MemberClusterSpec</h4>
<p>MemberClusterSpec defines the desired state of MemberCluster.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#membercluster">MemberCluster</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>identity</code> _<a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.26/#subject-v1-rbac">Subject</a></td>
          <td>The identity used by the member cluster to access the hub cluster. The hub agents deployed on the hub cluster will automatically grant the minimal required permissions to this identity for the member agents deployed on the member cluster to access the hub cluster.</td>
      </tr>
      <tr>
          <td><code>heartbeatPeriodSeconds</code> _integer</td>
          <td>How often (in seconds) for the member cluster to send a heartbeat to the hub cluster. Default: 60 seconds. Min: 1 second. Max: 10 minutes.</td>
      </tr>
      <tr>
          <td><code>taints</code> array <a href="/website/docs/api-reference/#taint">Taint</a></td>
          <td>An array of taints where each taint attached to the MemberCluster has that &ldquo;effect&rdquo; on any ClusterResourcePlacement that does not tolerate the taint.</td>
      </tr>
  </tbody>
</table>
<h4 id="memberclusterstatus">MemberClusterStatus</h4>
<p>MemberClusterStatus defines the observed status of MemberCluster.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#membercluster">MemberCluster</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>conditions</code> <em><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.26/#condition-v1-meta">Condition</a> array</em></td>
          <td>Conditions is an array of current observed conditions for the member cluster.</td>
      </tr>
      <tr>
          <td><code>resourceUsage</code> <em><a href="/website/docs/api-reference/#resourceusage">ResourceUsage</a></em></td>
          <td>The current observed resource usage of the member cluster. It is copied from the corresponding InternalMemberCluster object.</td>
      </tr>
      <tr>
          <td><code>agentStatus</code> <em><a href="/website/docs/api-reference/#agentstatus">AgentStatus</a> array</em></td>
          <td>AgentStatus is an array of current observed status, each corresponding to one member agent running in the member cluster.</td>
      </tr>
  </tbody>
</table>
<h4 id="resourceusage">ResourceUsage</h4>
<p>ResourceUsage contains the observed resource usage of a member cluster.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#memberclusterstatus">MemberClusterStatus</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>capacity</code> <em><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.26/#resourcelist-v1-core">ResourceList</a></em></td>
          <td>Capacity represents the total resource capacity of all the nodes on a member cluster.</td>
      </tr>
      <tr>
          <td><code>allocatable</code> <em><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.26/#resourcelist-v1-core">ResourceList</a></em></td>
          <td>Allocatable represents the total resources of all the nodes on a member cluster that are available for scheduling.</td>
      </tr>
      <tr>
          <td><code>observationTime</code> <em><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.26/#time-v1-meta">Time</a></em></td>
          <td>When the resource usage is observed.</td>
      </tr>
  </tbody>
</table>
<h4 id="taint">Taint</h4>
<p>A taint is a &lt;key, value, effect&gt; triple which when attached to the MemberCluster has that &ldquo;effect&rdquo; on any ClusterResourcePlacement that does not tolerate the taint.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#memberclusterspec">MemberClusterSpec</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>key</code> <em>string</em></td>
          <td>The taint key to be applied to the MemberCluster.</td>
      </tr>
      <tr>
          <td><code>value</code> <em>string</em></td>
          <td>The taint value to be applied to the MemberCluster.</td>
      </tr>
      <tr>
          <td><code>effect</code> <em>string</em></td>
          <td>Effect is the effect of the taint on any ClusterResourcePlacement that does not tolerate the taint.</td>
      </tr>
  </tbody>
</table>
<h4 id="effect">Effect</h4>
<p><em>Underlying type:</em> <em>string</em></p>
<p>Effect is the effect of the taint on any ClusterResourcePlacement.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#taint">Taint</a></li>
<li><a href="/website/docs/api-reference/#toleration">Toleration</a></li>
</ul>
<h2 id="placementkubernetes-fleetiov1beta1">placement.kubernetes-fleet.io/v1beta1</h2>
<h3 id="resource-types-1">Resource Types</h3>
<ul>
<li><a href="/website/docs/api-reference/#clusterresourcebinding">ClusterResourceBinding</a></li>
<li><a href="/website/docs/api-reference/#clusterresourceplacement">ClusterResourcePlacement</a></li>
<li><a href="/website/docs/api-reference/#clusterresourcesnapshot">ClusterResourceSnapshot</a></li>
<li><a href="/website/docs/api-reference/#clusterschedulingpolicysnapshot">ClusterSchedulingPolicySnapshot</a></li>
<li><a href="/website/docs/api-reference/#work">Work</a></li>
<li><a href="/website/docs/api-reference/#worklist">WorkList</a></li>
</ul>
<h4 id="affinity">Affinity</h4>
<p>Affinity is a group of cluster affinity scheduling rules. More to be added.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#placementpolicy">PlacementPolicy</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>clusterAffinity</code> <em><a href="/website/docs/api-reference/#clusteraffinity">ClusterAffinity</a></em></td>
          <td>ClusterAffinity contains cluster affinity scheduling rules for the selected resources.</td>
      </tr>
  </tbody>
</table>
<h4 id="bindingstate">BindingState</h4>
<p><em>Underlying type:</em> <em>string</em></p>
<p>BindingState is the state of the binding.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#resourcebindingspec">ResourceBindingSpec</a></li>
</ul>
<h4 id="clusterdecision">ClusterDecision</h4>
<p>ClusterDecision represents a decision from a placement An empty ClusterDecision indicates it is not scheduled yet.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#resourcebindingspec">ResourceBindingSpec</a></li>
<li><a href="/website/docs/api-reference/#schedulingpolicysnapshotstatus">SchedulingPolicySnapshotStatus</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>clusterName</code> <em>string</em></td>
          <td>ClusterName is the name of the ManagedCluster. If it is not empty, its value should be unique cross all placement decisions for the Placement.</td>
      </tr>
      <tr>
          <td><code>selected</code> <em>boolean</em></td>
          <td>Selected indicates if this cluster is selected by the scheduler.</td>
      </tr>
      <tr>
          <td><code>clusterScore</code> <em><a href="/website/docs/api-reference/#clusterscore">ClusterScore</a></em></td>
          <td>ClusterScore represents the score of the cluster calculated by the scheduler.</td>
      </tr>
      <tr>
          <td><code>reason</code> <em>string</em></td>
          <td>Reason represents the reason why the cluster is selected or not.</td>
      </tr>
  </tbody>
</table>
<h4 id="clusterresourcebinding">ClusterResourceBinding</h4>
<p>ClusterResourceBinding represents a scheduling decision that binds a group of resources to a cluster. It MUST have a label named <code>CRPTrackingLabel</code> that points to the cluster resource policy that creates it.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#clusterresourcebindinglist">ClusterResourceBindingList</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>apiVersion</code> <em>string</em></td>
          <td><code>placement.kubernetes-fleet.io/v1beta1</code></td>
      </tr>
      <tr>
          <td><code>kind</code> <em>string</em></td>
          <td><code>ClusterResourceBinding</code></td>
      </tr>
      <tr>
          <td><code>kind</code> <em>string</em></td>
          <td>Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: <a href="https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds">https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds</a></td>
      </tr>
      <tr>
          <td><code>apiVersion</code> <em>string</em></td>
          <td>APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: <a href="https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources">https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources</a></td>
      </tr>
      <tr>
          <td><code>metadata</code> <em><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.26/#objectmeta-v1-meta">ObjectMeta</a></em></td>
          <td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td>
      </tr>
      <tr>
          <td><code>spec</code> <em><a href="/website/docs/api-reference/#resourcebindingspec">ResourceBindingSpec</a></em></td>
          <td>The desired state of ClusterResourceBinding.</td>
      </tr>
      <tr>
          <td><code>status</code> <em><a href="/website/docs/api-reference/#resourcebindingstatus">ResourceBindingStatus</a></em></td>
          <td>The observed status of ClusterResourceBinding.</td>
      </tr>
  </tbody>
</table>
<h4 id="clusterresourceplacement">ClusterResourcePlacement</h4>
<p>ClusterResourcePlacement is used to select cluster scoped resources, including built-in resources and custom resources, and placement them onto selected member clusters in a fleet.
If a namespace is selected, ALL the resources under the namespace are placed to the target clusters unless <code>allowed-propagating-apis</code> flag is configured on hub-agent. Note that you can&rsquo;t select the following resources: - reserved namespaces including: default, kube-* (reserved for Kubernetes system namespaces), fleet-* (reserved for fleet system namespaces). - reserved fleet resource types including: MemberCluster, InternalMemberCluster, ClusterResourcePlacement, ClusterSchedulingPolicySnapshot, ClusterResourceSnapshot, ClusterResourceBinding, etc.
<code>ClusterSchedulingPolicySnapshot</code> and <code>ClusterResourceSnapshot</code> objects are created when there are changes in the system to keep the history of the changes affecting a <code>ClusterResourcePlacement</code>.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#clusterresourceplacementlist">ClusterResourcePlacementList</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>apiVersion</code> <em>string</em></td>
          <td><code>placement.kubernetes-fleet.io/v1beta1</code></td>
      </tr>
      <tr>
          <td><code>kind</code> <em>string</em></td>
          <td><code>ClusterResourcePlacement</code></td>
      </tr>
      <tr>
          <td><code>kind</code> <em>string</em></td>
          <td>Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: <a href="https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds">https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds</a></td>
      </tr>
      <tr>
          <td><code>apiVersion</code> <em>string</em></td>
          <td>APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: <a href="https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources">https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources</a></td>
      </tr>
      <tr>
          <td><code>metadata</code> <em><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.26/#objectmeta-v1-meta">ObjectMeta</a></em></td>
          <td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td>
      </tr>
      <tr>
          <td><code>spec</code> <em><a href="/website/docs/api-reference/#clusterresourceplacementspec">ClusterResourcePlacementSpec</a></em></td>
          <td>The desired state of ClusterResourcePlacement.</td>
      </tr>
      <tr>
          <td><code>status</code> <em><a href="/website/docs/api-reference/#clusterresourceplacementstatus">ClusterResourcePlacementStatus</a></em></td>
          <td>The observed status of ClusterResourcePlacement.</td>
      </tr>
  </tbody>
</table>
<h4 id="clusterresourceplacementspec">ClusterResourcePlacementSpec</h4>
<p>ClusterResourcePlacementSpec defines the desired state of ClusterResourcePlacement.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#clusterresourceplacement">ClusterResourcePlacement</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>resourceSelectors</code> <em><a href="/website/docs/api-reference/#clusterresourceselector">ClusterResourceSelector</a> array</em></td>
          <td>ResourceSelectors is an array of selectors used to select cluster scoped resources. The selectors are <code>ORed</code>. You can have 1-100 selectors.</td>
      </tr>
      <tr>
          <td><code>policy</code> <em><a href="/website/docs/api-reference/#placementpolicy">PlacementPolicy</a></em></td>
          <td>Policy defines how to select member clusters to place the selected resources. If unspecified, all the joined member clusters are selected.</td>
      </tr>
      <tr>
          <td><code>strategy</code> <em><a href="/website/docs/api-reference/#rolloutstrategy">RolloutStrategy</a></em></td>
          <td>The rollout strategy to use to replace existing placement with new ones.</td>
      </tr>
      <tr>
          <td><code>revisionHistoryLimit</code> <em>integer</em></td>
          <td>The number of old ClusterSchedulingPolicySnapshot or ClusterResourceSnapshot resources to retain to allow rollback. This is a pointer to distinguish between explicit zero and not specified. Defaults to 10.</td>
      </tr>
  </tbody>
</table>
<h4 id="clusterresourceplacementstatus">ClusterResourcePlacementStatus</h4>
<p>ClusterResourcePlacementStatus defines the observed state of the ClusterResourcePlacement object.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#clusterresourceplacement">ClusterResourcePlacement</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>selectedResources</code> <em><a href="/website/docs/api-reference/#resourceidentifier">ResourceIdentifier</a> array</em></td>
          <td>SelectedResources contains a list of resources selected by ResourceSelectors.</td>
      </tr>
      <tr>
          <td><code>observedResourceIndex</code> <em>string</em></td>
          <td>Resource index logically represents the generation of the selected resources. We take a new snapshot of the selected resources whenever the selection or their content change. Each snapshot has a different resource index. One resource snapshot can contain multiple clusterResourceSnapshots CRs in order to store large amount of resources. To get clusterResourceSnapshot of a given resource index, use the following command: <code>kubectl get ClusterResourceSnapshot --selector=kubernetes-fleet.io/resource-index=$ObservedResourceIndex </code> ObservedResourceIndex is the resource index that the conditions in the ClusterResourcePlacementStatus observe. For example, a condition of <code>ClusterResourcePlacementSynchronized</code> type is observing the synchronization status of the resource snapshot with the resource index $ObservedResourceIndex.</td>
      </tr>
      <tr>
          <td><code>placementStatuses</code> <em><a href="/website/docs/api-reference/#resourceplacementstatus">ResourcePlacementStatus</a> array</em></td>
          <td>PlacementStatuses contains a list of placement status on the clusters that are selected by PlacementPolicy. Each selected cluster according to the latest resource placement is guaranteed to have a corresponding placementStatuses. In the pickN case, there are N placement statuses where N = NumberOfClusters; Or in the pickFixed case, there are N placement statuses where N = ClusterNames. In these cases, some of them may not have assigned clusters when we cannot fill the required number of clusters. TODO, For pickAll type, considering providing unselected clusters info.</td>
      </tr>
      <tr>
          <td><code>conditions</code> <em><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.26/#condition-v1-meta">Condition</a> array</em></td>
          <td>Conditions is an array of current observed conditions for ClusterResourcePlacement.</td>
      </tr>
  </tbody>
</table>
<h4 id="clusterresourceselector">ClusterResourceSelector</h4>
<p>ClusterResourceSelector is used to select cluster scoped resources as the target resources to be placed. If a namespace is selected, ALL the resources under the namespace are selected automatically. All the fields are <code>ANDed</code>. In other words, a resource must match all the fields to be selected.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#clusterresourceplacementspec">ClusterResourcePlacementSpec</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>group</code> <em>string</em></td>
          <td>Group name of the cluster-scoped resource. Use an empty string to select resources under the core API group (e.g., namespaces).</td>
      </tr>
      <tr>
          <td><code>version</code> <em>string</em></td>
          <td>Version of the cluster-scoped resource.</td>
      </tr>
      <tr>
          <td><code>kind</code> <em>string</em></td>
          <td>Kind of the cluster-scoped resource. Note: When <code>Kind</code> is <code>namespace</code>, ALL the resources under the selected namespaces are selected.</td>
      </tr>
      <tr>
          <td><code>name</code> <em>string</em></td>
          <td>Name of the cluster-scoped resource.</td>
      </tr>
      <tr>
          <td><code>labelSelector</code> <em><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.26/#labelselector-v1-meta">LabelSelector</a></em></td>
          <td>A label query over all the cluster-scoped resources. Resources matching the query are selected. Note that namespace-scoped resources can&rsquo;t be selected even if they match the query.</td>
      </tr>
  </tbody>
</table>
<h4 id="clusterresourcesnapshot">ClusterResourceSnapshot</h4>
<p>ClusterResourceSnapshot is used to store a snapshot of selected resources by a resource placement policy. Its spec is immutable. We may need to produce more than one resourceSnapshot for all the resources a ResourcePlacement selected to get around the 1MB size limit of k8s objects. We assign an ever-increasing index for each such group of resourceSnapshots. The naming convention of a clusterResourceSnapshot is {CRPName}-{resourceIndex}-{subindex} where the name of the first snapshot of a group has no subindex part so its name is {CRPName}-{resourceIndex}-snapshot. resourceIndex will begin with 0. Each snapshot MUST have the following labels: - <code>CRPTrackingLabel</code> which points to its owner CRP. - <code>ResourceIndexLabel</code> which is the index  of the snapshot group. - <code>IsLatestSnapshotLabel</code> which indicates whether the snapshot is the latest one.
All the snapshots within the same index group must have the same ResourceIndexLabel.
The first snapshot of the index group MUST have the following annotations: - <code>NumberOfResourceSnapshotsAnnotation</code> to store the total number of resource snapshots in the index group. - <code>ResourceGroupHashAnnotation</code> whose value is the sha-256 hash of all the snapshots belong to the same snapshot index.
Each snapshot (excluding the first snapshot) MUST have the following annotations: - <code>SubindexOfResourceSnapshotAnnotation</code> to store the subindex of resource snapshot in the group.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#clusterresourcesnapshotlist">ClusterResourceSnapshotList</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>apiVersion</code> <em>string</em></td>
          <td><code>placement.kubernetes-fleet.io/v1beta1</code></td>
      </tr>
      <tr>
          <td><code>kind</code> <em>string</em></td>
          <td><code>ClusterResourceSnapshot</code></td>
      </tr>
      <tr>
          <td><code>kind</code> <em>string</em></td>
          <td>Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: <a href="https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds">https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds</a></td>
      </tr>
      <tr>
          <td><code>apiVersion</code> <em>string</em></td>
          <td>APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: <a href="https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources">https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources</a></td>
      </tr>
      <tr>
          <td><code>metadata</code> <em><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.26/#objectmeta-v1-meta">ObjectMeta</a></em></td>
          <td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td>
      </tr>
      <tr>
          <td><code>spec</code> <em><a href="/website/docs/api-reference/#resourcesnapshotspec">ResourceSnapshotSpec</a></em></td>
          <td>The desired state of ResourceSnapshot.</td>
      </tr>
      <tr>
          <td><code>status</code> <em><a href="/website/docs/api-reference/#resourcesnapshotstatus">ResourceSnapshotStatus</a></em></td>
          <td>The observed status of ResourceSnapshot.</td>
      </tr>
  </tbody>
</table>
<h4 id="clusterschedulingpolicysnapshot">ClusterSchedulingPolicySnapshot</h4>
<p>ClusterSchedulingPolicySnapshot is used to store a snapshot of cluster placement policy. Its spec is immutable. The naming convention of a ClusterSchedulingPolicySnapshot is {CRPName}-{PolicySnapshotIndex}. PolicySnapshotIndex will begin with 0. Each snapshot must have the following labels: - <code>CRPTrackingLabel</code> which points to its owner CRP. - <code>PolicyIndexLabel</code> which is the index of the policy snapshot. - <code>IsLatestSnapshotLabel</code> which indicates whether the snapshot is the latest one.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#clusterschedulingpolicysnapshotlist">ClusterSchedulingPolicySnapshotList</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>apiVersion</code> <em>string</em></td>
          <td><code>placement.kubernetes-fleet.io/v1beta1</code></td>
      </tr>
      <tr>
          <td><code>kind</code> <em>string</em></td>
          <td><code>ClusterSchedulingPolicySnapshot</code></td>
      </tr>
      <tr>
          <td><code>kind</code> <em>string</em></td>
          <td>Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: <a href="https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds">https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds</a></td>
      </tr>
      <tr>
          <td><code>apiVersion</code> <em>string</em></td>
          <td>APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: <a href="https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources">https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources</a></td>
      </tr>
      <tr>
          <td><code>metadata</code> <em><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.26/#objectmeta-v1-meta">ObjectMeta</a></em></td>
          <td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td>
      </tr>
      <tr>
          <td><code>spec</code> <em><a href="/website/docs/api-reference/#schedulingpolicysnapshotspec">SchedulingPolicySnapshotSpec</a></em></td>
          <td>The desired state of SchedulingPolicySnapshot.</td>
      </tr>
      <tr>
          <td><code>status</code> <em><a href="/website/docs/api-reference/#schedulingpolicysnapshotstatus">SchedulingPolicySnapshotStatus</a></em></td>
          <td>The observed status of SchedulingPolicySnapshot.</td>
      </tr>
  </tbody>
</table>
<h4 id="clusterscore">ClusterScore</h4>
<p>ClusterScore represents the score of the cluster calculated by the scheduler.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#clusterdecision">ClusterDecision</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>affinityScore</code> <em>integer</em></td>
          <td>AffinityScore represents the affinity score of the cluster calculated by the last scheduling decision based on the preferred affinity selector. An affinity score may not present if the cluster does not meet the required affinity.</td>
      </tr>
      <tr>
          <td><code>priorityScore</code> <em>integer</em></td>
          <td>TopologySpreadScore represents the priority score of the cluster calculated by the last scheduling decision based on the topology spread applied to the cluster. A priority score may not present if the cluster does not meet the topology spread.</td>
      </tr>
  </tbody>
</table>
<h4 id="clusterselector">ClusterSelector</h4>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#clusteraffinity">ClusterAffinity</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>clusterSelectorTerms</code> <em><a href="/website/docs/api-reference/#clusterselectorterm">ClusterSelectorTerm</a> array</em></td>
          <td>ClusterSelectorTerms is a list of cluster selector terms. The terms are <code>ORed</code>.</td>
      </tr>
  </tbody>
</table>
<h4 id="clusterselectorterm">ClusterSelectorTerm</h4>
<p>ClusterSelectorTerm contains the requirements to select clusters.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#clusterselector">ClusterSelector</a></li>
<li><a href="/website/docs/api-reference/#preferredclusterselector">PreferredClusterSelector</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>labelSelector</code> <em><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.26/#labelselector-v1-meta">LabelSelector</a></em></td>
          <td>LabelSelector is a label query over all the joined member clusters. Clusters matching the query are selected.</td>
      </tr>
  </tbody>
</table>
<h4 id="envelopeidentifier">EnvelopeIdentifier</h4>
<p>EnvelopeIdentifier identifies the envelope object that contains the selected resource.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#failedresourceplacement">FailedResourcePlacement</a></li>
<li><a href="/website/docs/api-reference/#resourceidentifier">ResourceIdentifier</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>name</code> <em>string</em></td>
          <td>Name of the envelope object.</td>
      </tr>
      <tr>
          <td><code>namespace</code> <em>string</em></td>
          <td>Namespace is the namespace of the envelope object. Empty if the envelope object is cluster scoped.</td>
      </tr>
      <tr>
          <td><code>type</code> <em><a href="/website/docs/api-reference/#envelopetype">EnvelopeType</a></em></td>
          <td>Type of the envelope object.</td>
      </tr>
  </tbody>
</table>
<h4 id="envelopetype">EnvelopeType</h4>
<p><em>Underlying type:</em> <em>string</em></p>
<p>EnvelopeType defines the type of the envelope object.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#envelopeidentifier">EnvelopeIdentifier</a></li>
</ul>
<h4 id="failedresourceplacement">FailedResourcePlacement</h4>
<p>FailedResourcePlacement contains the failure details of a failed resource placement.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#resourceplacementstatus">ResourcePlacementStatus</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>group</code> <em>string</em></td>
          <td>Group is the group name of the selected resource.</td>
      </tr>
      <tr>
          <td><code>version</code> <em>string</em></td>
          <td>Version is the version of the selected resource.</td>
      </tr>
      <tr>
          <td><code>kind</code> <em>string</em></td>
          <td>Kind represents the Kind of the selected resources.</td>
      </tr>
      <tr>
          <td><code>name</code> <em>string</em></td>
          <td>Name of the target resource.</td>
      </tr>
      <tr>
          <td><code>namespace</code> <em>string</em></td>
          <td>Namespace is the namespace of the resource. Empty if the resource is cluster scoped.</td>
      </tr>
      <tr>
          <td><code>envelope</code> <em><a href="/website/docs/api-reference/#envelopeidentifier">EnvelopeIdentifier</a></em></td>
          <td>Envelope identifies the envelope object that contains this resource.</td>
      </tr>
      <tr>
          <td><code>condition</code> <em><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.26/#condition-v1-meta">Condition</a></em></td>
          <td>The failed condition status.</td>
      </tr>
  </tbody>
</table>
<h4 id="manifest">Manifest</h4>
<p>Manifest represents a resource to be deployed on spoke cluster.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#workloadtemplate">WorkloadTemplate</a></li>
</ul>
<h4 id="manifestcondition">ManifestCondition</h4>
<p>ManifestCondition represents the conditions of the resources deployed on spoke cluster.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#workstatus">WorkStatus</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>identifier</code> <em><a href="/website/docs/api-reference/#workresourceidentifier">WorkResourceIdentifier</a></em></td>
          <td>resourceId represents a identity of a resource linking to manifests in spec.</td>
      </tr>
      <tr>
          <td><code>conditions</code> <em><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.26/#condition-v1-meta">Condition</a> array</em></td>
          <td>Conditions represents the conditions of this resource on spoke cluster</td>
      </tr>
  </tbody>
</table>
<h4 id="placementpolicy">PlacementPolicy</h4>
<p>PlacementPolicy contains the rules to select target member clusters to place the selected resources. Note that only clusters that are both joined and satisfying the rules will be selected.
You can only specify at most one of the two fields: ClusterNames and Affinity. If none is specified, all the joined clusters are selected.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#clusterresourceplacementspec">ClusterResourcePlacementSpec</a></li>
<li><a href="/website/docs/api-reference/#schedulingpolicysnapshotspec">SchedulingPolicySnapshotSpec</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>placementType</code> <em><a href="/website/docs/api-reference/#placementtype">PlacementType</a></em></td>
          <td>Type of placement. Can be &ldquo;PickAll&rdquo;, &ldquo;PickN&rdquo; or &ldquo;PickFixed&rdquo;. Default is PickAll.</td>
      </tr>
      <tr>
          <td><code>clusterNames</code> <em>string array</em></td>
          <td>ClusterNames contains a list of names of MemberCluster to place the selected resources. Only valid if the placement type is &ldquo;PickFixed&rdquo;</td>
      </tr>
      <tr>
          <td><code>numberOfClusters</code> <em>integer</em></td>
          <td>NumberOfClusters of placement. Only valid if the placement type is &ldquo;PickN&rdquo;.</td>
      </tr>
      <tr>
          <td><code>affinity</code> <em><a href="/website/docs/api-reference/#affinity">Affinity</a></em></td>
          <td>Affinity contains cluster affinity scheduling rules. Defines which member clusters to place the selected resources. Only valid if the placement type is &ldquo;PickAll&rdquo; or &ldquo;PickN&rdquo;.</td>
      </tr>
      <tr>
          <td><code>topologySpreadConstraints</code> <em><a href="/website/docs/api-reference/#topologyspreadconstraint">TopologySpreadConstraint</a> array</em></td>
          <td>TopologySpreadConstraints describes how a group of resources ought to spread across multiple topology domains. Scheduler will schedule resources in a way which abides by the constraints. All topologySpreadConstraints are ANDed. Only valid if the placement type is &ldquo;PickN&rdquo;.</td>
      </tr>
      <tr>
          <td><code>tolerations</code> <a href="/website/docs/api-reference/#toleration">Toleration</a> array</td>
          <td>An array of tolerations where each toleration is used to tolerate one or more taints on the MemberCluster based on key, value, effect and operator.</td>
      </tr>
  </tbody>
</table>
<h4 id="placementtype">PlacementType</h4>
<p><em>Underlying type:</em> <em>string</em></p>
<p>PlacementType identifies the type of placement.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#placementpolicy">PlacementPolicy</a></li>
</ul>
<h4 id="preferredclusterselector">PreferredClusterSelector</h4>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#clusteraffinity">ClusterAffinity</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>weight</code> <em>integer</em></td>
          <td>Weight associated with matching the corresponding clusterSelectorTerm, in the range [-100, 100].</td>
      </tr>
      <tr>
          <td><code>preference</code> <em><a href="/website/docs/api-reference/#clusterselectorterm">ClusterSelectorTerm</a></em></td>
          <td>A cluster selector term, associated with the corresponding weight.</td>
      </tr>
  </tbody>
</table>
<h4 id="resourcebindingspec">ResourceBindingSpec</h4>
<p>ResourceBindingSpec defines the desired state of ClusterResourceBinding.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#clusterresourcebinding">ClusterResourceBinding</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>state</code> <em><a href="/website/docs/api-reference/#bindingstate">BindingState</a></em></td>
          <td>The desired state of the binding. Possible values: Scheduled, Bound, Unscheduled.</td>
      </tr>
      <tr>
          <td><code>resourceSnapshotName</code> <em>string</em></td>
          <td>ResourceSnapshotName is the name of the resource snapshot that this resource binding points to. If the resources are divided into multiple snapshots because of the resource size limit, it points to the name of the leading snapshot of the index group.</td>
      </tr>
      <tr>
          <td><code>schedulingPolicySnapshotName</code> <em>string</em></td>
          <td>SchedulingPolicySnapshotName is the name of the scheduling policy snapshot that this resource binding points to; more specifically, the scheduler creates this bindings in accordance with this scheduling policy snapshot.</td>
      </tr>
      <tr>
          <td><code>targetCluster</code> <em>string</em></td>
          <td>TargetCluster is the name of the cluster that the scheduler assigns the resources to.</td>
      </tr>
      <tr>
          <td><code>clusterDecision</code> <em><a href="/website/docs/api-reference/#clusterdecision">ClusterDecision</a></em></td>
          <td>ClusterDecision explains why the scheduler selected this cluster.</td>
      </tr>
  </tbody>
</table>
<h4 id="resourcebindingstatus">ResourceBindingStatus</h4>
<p>ResourceBindingStatus represents the current status of a ClusterResourceBinding.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#clusterresourcebinding">ClusterResourceBinding</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>conditions</code> <em><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.26/#condition-v1-meta">Condition</a> array</em></td>
          <td>Conditions is an array of current observed conditions for ClusterResourceBinding.</td>
      </tr>
  </tbody>
</table>
<h4 id="resourcecontent">ResourceContent</h4>
<p>ResourceContent contains the content of a resource</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#resourcesnapshotspec">ResourceSnapshotSpec</a></li>
</ul>
<h4 id="resourceidentifier">ResourceIdentifier</h4>
<p>ResourceIdentifier identifies one Kubernetes resource.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#clusterresourceplacementstatus">ClusterResourcePlacementStatus</a></li>
<li><a href="/website/docs/api-reference/#failedresourceplacement">FailedResourcePlacement</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>group</code> <em>string</em></td>
          <td>Group is the group name of the selected resource.</td>
      </tr>
      <tr>
          <td><code>version</code> <em>string</em></td>
          <td>Version is the version of the selected resource.</td>
      </tr>
      <tr>
          <td><code>kind</code> <em>string</em></td>
          <td>Kind represents the Kind of the selected resources.</td>
      </tr>
      <tr>
          <td><code>name</code> <em>string</em></td>
          <td>Name of the target resource.</td>
      </tr>
      <tr>
          <td><code>namespace</code> <em>string</em></td>
          <td>Namespace is the namespace of the resource. Empty if the resource is cluster scoped.</td>
      </tr>
      <tr>
          <td><code>envelope</code> <em><a href="/website/docs/api-reference/#envelopeidentifier">EnvelopeIdentifier</a></em></td>
          <td>Envelope identifies the envelope object that contains this resource.</td>
      </tr>
  </tbody>
</table>
<h4 id="resourceplacementstatus">ResourcePlacementStatus</h4>
<p>ResourcePlacementStatus represents the placement status of selected resources for one target cluster.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#clusterresourceplacementstatus">ClusterResourcePlacementStatus</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>clusterName</code> <em>string</em></td>
          <td>ClusterName is the name of the cluster this resource is assigned to. If it is not empty, its value should be unique cross all placement decisions for the Placement.</td>
      </tr>
      <tr>
          <td><code>failedPlacements</code> <em><a href="/website/docs/api-reference/#failedresourceplacement">FailedResourcePlacement</a> array</em></td>
          <td>FailedResourcePlacements is a list of all the resources failed to be placed to the given cluster. Note that we only include 100 failed resource placements even if there are more than 100. This field is only meaningful if the <code>ClusterName</code> is not empty.</td>
      </tr>
      <tr>
          <td><code>conditions</code> <em><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.26/#condition-v1-meta">Condition</a> array</em></td>
          <td>Conditions is an array of current observed conditions for ResourcePlacementStatus.</td>
      </tr>
  </tbody>
</table>
<h4 id="resourcesnapshotspec">ResourceSnapshotSpec</h4>
<p>ResourceSnapshotSpec	defines the desired state of ResourceSnapshot.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#clusterresourcesnapshot">ClusterResourceSnapshot</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>selectedResources</code> <em><a href="/website/docs/api-reference/#resourcecontent">ResourceContent</a> array</em></td>
          <td>SelectedResources contains a list of resources selected by ResourceSelectors.</td>
      </tr>
  </tbody>
</table>
<h4 id="resourcesnapshotstatus">ResourceSnapshotStatus</h4>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#clusterresourcesnapshot">ClusterResourceSnapshot</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>conditions</code> <em><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.26/#condition-v1-meta">Condition</a> array</em></td>
          <td>Conditions is an array of current observed conditions for ResourceSnapshot.</td>
      </tr>
  </tbody>
</table>
<h4 id="rollingupdateconfig">RollingUpdateConfig</h4>
<p>RollingUpdateConfig contains the config to control the desired behavior of rolling update.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#rolloutstrategy">RolloutStrategy</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>maxUnavailable</code> <em><a href="/website/docs/api-reference/#intorstring">IntOrString</a></em></td>
          <td>The maximum number of clusters that can be unavailable during the rolling update comparing to the desired number of clusters. The desired number equals to the <code>NumberOfClusters</code> field when the placement type is <code>PickN</code>. The desired number equals to the number of clusters scheduler selected when the placement type is <code>PickAll</code>. Value can be an absolute number (ex: 5) or a percentage of the desired number of clusters (ex: 10%). Absolute number is calculated from percentage by rounding up. We consider a resource unavailable when we either remove it from a cluster or in-place upgrade the resources content on the same cluster. This can not be 0 if MaxSurge is 0. Defaults to 25%.</td>
      </tr>
      <tr>
          <td><code>maxSurge</code> <em><a href="/website/docs/api-reference/#intorstring">IntOrString</a></em></td>
          <td>The maximum number of clusters that can be scheduled above the desired number of clusters. The desired number equals to the <code>NumberOfClusters</code> field when the placement type is <code>PickN</code>. The desired number equals to the number of clusters scheduler selected when the placement type is <code>PickAll</code>. Value can be an absolute number (ex: 5) or a percentage of desire (ex: 10%). Absolute number is calculated from percentage by rounding up. This does not apply to the case that we do in-place upgrade of resources on the same cluster. This can not be 0 if MaxUnavailable is 0. Defaults to 25%.</td>
      </tr>
      <tr>
          <td><code>unavailablePeriodSeconds</code> <em>integer</em></td>
          <td>UnavailablePeriodSeconds is used to config the time to wait between rolling out phases. A resource placement is considered available after <code>UnavailablePeriodSeconds</code> seconds has passed after the resources are applied to the target cluster successfully. Default is 60.</td>
      </tr>
  </tbody>
</table>
<h4 id="rolloutstrategy">RolloutStrategy</h4>
<p>RolloutStrategy describes how to roll out a new change in selected resources to target clusters.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#clusterresourceplacementspec">ClusterResourcePlacementSpec</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>type</code> <em><a href="/website/docs/api-reference/#rolloutstrategytype">RolloutStrategyType</a></em></td>
          <td>Type of rollout. The only supported type is &ldquo;RollingUpdate&rdquo;. Default is &ldquo;RollingUpdate&rdquo;.</td>
      </tr>
      <tr>
          <td><code>rollingUpdate</code> <em><a href="/website/docs/api-reference/#rollingupdateconfig">RollingUpdateConfig</a></em></td>
          <td>Rolling update config params. Present only if RolloutStrategyType = RollingUpdate.</td>
      </tr>
  </tbody>
</table>
<h4 id="rolloutstrategytype">RolloutStrategyType</h4>
<p><em>Underlying type:</em> <em>string</em></p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#rolloutstrategy">RolloutStrategy</a></li>
</ul>
<h4 id="schedulingpolicysnapshotspec">SchedulingPolicySnapshotSpec</h4>
<p>SchedulingPolicySnapshotSpec defines the desired state of SchedulingPolicySnapshot.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#clusterschedulingpolicysnapshot">ClusterSchedulingPolicySnapshot</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>policy</code> <em><a href="/website/docs/api-reference/#placementpolicy">PlacementPolicy</a></em></td>
          <td>Policy defines how to select member clusters to place the selected resources. If unspecified, all the joined member clusters are selected.</td>
      </tr>
      <tr>
          <td><code>policyHash</code> <em><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.26/#byte-v1-meta">byte</a> array</em></td>
          <td>PolicyHash is the sha-256 hash value of the Policy field.</td>
      </tr>
  </tbody>
</table>
<h4 id="schedulingpolicysnapshotstatus">SchedulingPolicySnapshotStatus</h4>
<p>SchedulingPolicySnapshotStatus defines the observed state of SchedulingPolicySnapshot.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#clusterschedulingpolicysnapshot">ClusterSchedulingPolicySnapshot</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>observedCRPGeneration</code> <em>integer</em></td>
          <td>ObservedCRPGeneration is the generation of the CRP which the scheduler uses to perform the scheduling cycle and prepare the scheduling status.</td>
      </tr>
      <tr>
          <td><code>conditions</code> <em><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.26/#condition-v1-meta">Condition</a> array</em></td>
          <td>Conditions is an array of current observed conditions for SchedulingPolicySnapshot.</td>
      </tr>
      <tr>
          <td><code>targetClusters</code> <em><a href="/website/docs/api-reference/#clusterdecision">ClusterDecision</a> array</em></td>
          <td>ClusterDecisions contains a list of names of member clusters considered by the scheduler. Note that all the selected clusters must present in the list while not all the member clusters are guaranteed to be listed due to the size limit. We will try to add the clusters that can provide the most insight to the list first.</td>
      </tr>
  </tbody>
</table>
<h4 id="topologyspreadconstraint">TopologySpreadConstraint</h4>
<p>TopologySpreadConstraint specifies how to spread resources among the given cluster topology.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#placementpolicy">PlacementPolicy</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>maxSkew</code> <em>integer</em></td>
          <td>MaxSkew describes the degree to which resources may be unevenly distributed. When <code>whenUnsatisfiable=DoNotSchedule</code>, it is the maximum permitted difference between the number of resource copies in the target topology and the global minimum. The global minimum is the minimum number of resource copies in a domain. When <code>whenUnsatisfiable=ScheduleAnyway</code>, it is used to give higher precedence to topologies that satisfy it. It&rsquo;s an optional field. Default value is 1 and 0 is not allowed.</td>
      </tr>
      <tr>
          <td><code>topologyKey</code> <em>string</em></td>
          <td>TopologyKey is the key of cluster labels. Clusters that have a label with this key and identical values are considered to be in the same topology. We consider each &lt;key, value&gt; as a &ldquo;bucket&rdquo;, and try to put balanced number of replicas of the resource into each bucket honor the <code>MaxSkew</code> value. It&rsquo;s a required field.</td>
      </tr>
      <tr>
          <td><code>whenUnsatisfiable</code> <em><a href="/website/docs/api-reference/#unsatisfiableconstraintaction">UnsatisfiableConstraintAction</a></em></td>
          <td>WhenUnsatisfiable indicates how to deal with the resource if it doesn&rsquo;t satisfy the spread constraint. - DoNotSchedule (default) tells the scheduler not to schedule it. - ScheduleAnyway tells the scheduler to schedule the resource in any cluster, but giving higher precedence to topologies that would help reduce the skew. It&rsquo;s an optional field.</td>
      </tr>
  </tbody>
</table>
<h4 id="unsatisfiableconstraintaction">UnsatisfiableConstraintAction</h4>
<p><em>Underlying type:</em> <em>string</em></p>
<p>UnsatisfiableConstraintAction defines the type of actions that can be taken if a constraint is not satisfied.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#topologyspreadconstraint">TopologySpreadConstraint</a></li>
</ul>
<h4 id="toleration">Toleration</h4>
<p>Toleration is used by ClusterResourcePlacement to tolerate any taint that matches the triple &lt;key,value,effect&gt; using the matching operator <operator>.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#placementpolicy">PlacementPolicy</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>key</code> <em>string</em></td>
          <td>The key refers to the taint key that the toleration applies to.</td>
      </tr>
      <tr>
          <td><code>operator</code> <em>string</em></td>
          <td>Operator represents a key&rsquo;s relationship to the value. Valid operators are Exists and Equal. Defaults to Equal.</td>
      </tr>
      <tr>
          <td><code>value</code> <em>string</em></td>
          <td>The value refers to the taint value that the toleration applies to. If the operator is Exists, the value should be empty.</td>
      </tr>
      <tr>
          <td><code>effect</code> <em>string</em></td>
          <td>Effect is the effect of the taint on any ClusterResourcePlacement that does not tolerate the taint.</td>
      </tr>
  </tbody>
</table>
<h4 id="work">Work</h4>
<p>Work is the Schema for the works API.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#worklist">WorkList</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>apiVersion</code> <em>string</em></td>
          <td><code>placement.kubernetes-fleet.io/v1beta1</code></td>
      </tr>
      <tr>
          <td><code>kind</code> <em>string</em></td>
          <td><code>Work</code></td>
      </tr>
      <tr>
          <td><code>kind</code> <em>string</em></td>
          <td>Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: <a href="https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds">https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds</a></td>
      </tr>
      <tr>
          <td><code>apiVersion</code> <em>string</em></td>
          <td>APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: <a href="https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources">https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources</a></td>
      </tr>
      <tr>
          <td><code>metadata</code> <em><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.26/#objectmeta-v1-meta">ObjectMeta</a></em></td>
          <td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td>
      </tr>
      <tr>
          <td><code>spec</code> <em><a href="/website/docs/api-reference/#workspec">WorkSpec</a></em></td>
          <td>spec defines the workload of a work.</td>
      </tr>
      <tr>
          <td><code>status</code> <em><a href="/website/docs/api-reference/#workstatus">WorkStatus</a></em></td>
          <td>status defines the status of each applied manifest on the spoke cluster.</td>
      </tr>
  </tbody>
</table>
<h4 id="worklist">WorkList</h4>
<p>WorkList contains a list of Work.</p>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>apiVersion</code> <em>string</em></td>
          <td><code>placement.kubernetes-fleet.io/v1beta1</code></td>
      </tr>
      <tr>
          <td><code>kind</code> <em>string</em></td>
          <td><code>WorkList</code></td>
      </tr>
      <tr>
          <td><code>kind</code> <em>string</em></td>
          <td>Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: <a href="https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds">https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds</a></td>
      </tr>
      <tr>
          <td><code>apiVersion</code> <em>string</em></td>
          <td>APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: <a href="https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources">https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources</a></td>
      </tr>
      <tr>
          <td><code>metadata</code> <em><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.26/#listmeta-v1-meta">ListMeta</a></em></td>
          <td>Refer to Kubernetes API documentation for fields of <code>metadata</code>.</td>
      </tr>
      <tr>
          <td><code>items</code> <em><a href="/website/docs/api-reference/#work">Work</a> array</em></td>
          <td>List of works.</td>
      </tr>
  </tbody>
</table>
<h4 id="workresourceidentifier">WorkResourceIdentifier</h4>
<p>WorkResourceIdentifier provides the identifiers needed to interact with any arbitrary object. Renamed original &ldquo;ResourceIdentifier&rdquo; so that it won&rsquo;t conflict with ResourceIdentifier defined in the clusterresourceplacement_types.go.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#appliedresourcemeta">AppliedResourceMeta</a></li>
<li><a href="/website/docs/api-reference/#manifestcondition">ManifestCondition</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>ordinal</code> <em>integer</em></td>
          <td>Ordinal represents an index in manifests list, so the condition can still be linked to a manifest even thougth manifest cannot be parsed successfully.</td>
      </tr>
      <tr>
          <td><code>group</code> <em>string</em></td>
          <td>Group is the group of the resource.</td>
      </tr>
      <tr>
          <td><code>version</code> <em>string</em></td>
          <td>Version is the version of the resource.</td>
      </tr>
      <tr>
          <td><code>kind</code> <em>string</em></td>
          <td>Kind is the kind of the resource.</td>
      </tr>
      <tr>
          <td><code>resource</code> <em>string</em></td>
          <td>Resource is the resource type of the resource</td>
      </tr>
      <tr>
          <td><code>namespace</code> <em>string</em></td>
          <td>Namespace is the namespace of the resource, the resource is cluster scoped if the value is empty</td>
      </tr>
      <tr>
          <td><code>name</code> <em>string</em></td>
          <td>Name is the name of the resource</td>
      </tr>
  </tbody>
</table>
<h4 id="workspec">WorkSpec</h4>
<p>WorkSpec defines the desired state of Work.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#work">Work</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>workload</code> <em><a href="/website/docs/api-reference/#workloadtemplate">WorkloadTemplate</a></em></td>
          <td>Workload represents the manifest workload to be deployed on spoke cluster</td>
      </tr>
  </tbody>
</table>
<h4 id="workstatus">WorkStatus</h4>
<p>WorkStatus defines the observed state of Work.</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#work">Work</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>conditions</code> <em><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.26/#condition-v1-meta">Condition</a> array</em></td>
          <td>Conditions contains the different condition statuses for this work. Valid condition types are: 1. Applied represents workload in Work is applied successfully on the spoke cluster. 2. Progressing represents workload in Work in the trasitioning from one state to another the on the spoke cluster. 3. Available represents workload in Work exists on the spoke cluster. 4. Degraded represents the current state of workload does not match the desired state for a certain period.</td>
      </tr>
      <tr>
          <td><code>manifestConditions</code> <em><a href="/website/docs/api-reference/#manifestcondition">ManifestCondition</a> array</em></td>
          <td>ManifestConditions represents the conditions of each resource in work deployed on spoke cluster.</td>
      </tr>
  </tbody>
</table>
<h4 id="workloadtemplate">WorkloadTemplate</h4>
<p>WorkloadTemplate represents the manifest workload to be deployed on spoke cluster</p>
<p><em>Appears in:</em></p>
<ul>
<li><a href="/website/docs/api-reference/#workspec">WorkSpec</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>manifests</code> <em><a href="/website/docs/api-reference/#manifest">Manifest</a> array</em></td>
          <td>Manifests represents a list of kuberenetes resources to be deployed on the spoke cluster.</td>
      </tr>
  </tbody>
</table>

</div>



    
      
  
  
  
  

  
  

  

    
	
  



          </main>
        </div>
      </div>
      <footer class="td-footer row d-print-none">
  <div class="container-fluid">
    <div class="row mx-md-2">
      <div class="td-footer__left col-6 col-sm-4 order-sm-1">
        
      </div><div class="td-footer__right col-6 col-sm-4 order-sm-3">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="GitHub" aria-label="GitHub">
    <a target="_blank" rel="noopener" href="https://github.com/kubefleet-dev/kubefleet" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2">
        <span class="td-footer__copyright">&copy;
    2025&ndash;2025
    <span class="td-footer__authors">KubeFleet Contributors | The Linux Foundation® (TLF) has registered trademarks and uses trademarks. For a list of TLF trademarks, see <a href="https://www.linuxfoundation.org/trademark-usage/">Trademark Usage</a> | <a href="https://creativecommons.org/licenses/by/4.0">CC BY 4.0</a> |</span></span><span class="td-footer__all_rights_reserved">All Rights Reserved</span><span class="ms-2"><a href="https://github.com/kubefleet-dev/website/blob/main/PRIVACY_POLICY.md" target="_blank" rel="noopener">Privacy Policy</a></span>
      </div>
    </div>
  </div>
</footer>

    </div>
    <script src="/website/js/main.min.8bdc707530d61dee3a6fd659f8a422c05d2e2319377a8710175451ca21fa83b0.js" integrity="sha256-i9xwdTDWHe46b9ZZ&#43;KQiwF0uIxk3eocQF1RRyiH6g7A=" crossorigin="anonymous"></script>
<script defer src="/website/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js" integrity="sha256-c0eKfUgHaYrtfjVesj&#43;YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin="anonymous"></script>
<script src='/website/js/tabpane-persist.js'></script>

  </body>
</html>
